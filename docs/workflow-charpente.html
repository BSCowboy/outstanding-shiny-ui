<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 22 Introduction to {charpente} | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- CSS --><link rel="stylesheet" href="css/style.css">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.2/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.2/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.1.9000/tabs.js"></script><script src="libs/bs3compat-0.2.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">2</span> Discover Shiny dependencies</a></li>
<li class="book-part">From R to HTML: discover and master {htmltools}:</li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">3</span> htmltools overview</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li class="book-part">Beautify with CSS and SASS</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">5</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">6</span> Introduction to SASS</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">7</span> Beautify with fresh</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">8</span> Beautify with bslib</a></li>
<li><a class="" href="beautify-other-tools.html"><span class="header-section-number">9</span> Other tools</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Shiny’s internal: session and websockets</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Hidden gems about inputs</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Template skeleton</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">19</span> Testing and validating templates elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">20</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">21</span> Adding more interactivity</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="active" href="workflow-charpente.html"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source</a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="workflow-charpente" class="section level1">
<h1>
<span class="header-section-number">22</span> Introduction to {charpente}<a class="anchor" aria-label="anchor" href="#workflow-charpente"><i class="fas fa-link"></i></a>
</h1>
<div class="figure" style="text-align: center">
<span id="fig:workflow-charpente-hex"></span>
<img src="images/workflow/charpente-hex.png" alt="The {charpente} package" width="25%"><p class="caption">
FIGURE 22.1: The {charpente} package
</p>
</div>
<div id="motivations-1" class="section level2">
<h2>
<span class="header-section-number">22.1</span> Motivations<a class="anchor" aria-label="anchor" href="#motivations-1"><i class="fas fa-link"></i></a>
</h2>
<p>Translating an HTML template into an R API requires the creation of a package. As stated in Chapter <a href="index.html#welcome-code-structure">0.1</a>, this is not a good practice to proceed as follows:</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shinyWidgets/man/useShinydashboard.html">useShinydashboard</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    <span class="st">[1172 chars quoted with '"']</span>
  <span class="op">)</span>,
  
  <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/box2.html">box2</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/textOutput.html">textOutput</a></span><span class="op">(</span><span class="st">"box_state"</span><span class="op">)</span>,
    <span class="st">"Box body"</span>,
    inputId <span class="op">=</span> <span class="st">"mybox"</span>,
    collapsible <span class="op">=</span> <span class="cn">TRUE</span>,
    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"toggle_box"</span>, <span class="st">"Toggle Box"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
      <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/req.html">req</a></span><span class="op">(</span><span class="op">!</span><span class="va">input</span><span class="op">$</span><span class="va">mybox</span><span class="op">$</span><span class="va">collapsed</span><span class="op">)</span>
      <span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">output</span><span class="op">$</span><span class="va">box_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/renderPrint.html">renderText</a></span><span class="op">(</span><span class="op">{</span>
      <span class="va">state</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">mybox</span><span class="op">$</span><span class="va">collapsed</span><span class="op">)</span> <span class="st">"collapsed"</span> <span class="kw">else</span> <span class="st">"uncollapsed"</span>
      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"My box is"</span>, <span class="va">state</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">toggle_box</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/updateBox2.html">updateBox2</a></span><span class="op">(</span><span class="st">"mybox"</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>Imagine if we had to repeat the process for more than twenty components. The package structure provides many advantages like:</p>
<ul>
<li>Develop a comprehensive documentation of the underlying API</li>
<li>Design unit tests to guaranty code robustness and improve long term plan</li>
<li>Relevant file organization</li>
</ul>
</div>
<div id="general-idea" class="section level2">
<h2>
<span class="header-section-number">22.2</span> General idea<a class="anchor" aria-label="anchor" href="#general-idea"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/RinteRface/charpente">{charpente}</a> is a game changer for custom template creation.
It is not yet on CRAN but has been widely used to help developing RinteRface packages.
<a href="https://github.com/RinteRface/charpente">charpente</a>, it drastically:</p>
<ul>
<li>Eases the import of external dependencies.</li>
<li>Speeds up the HTML to R conversion, which is quite frankly a rather boring process,
allowing to focus on the features rather than the syntax. This feature builds on top of the
<code>{html2R}</code> shiny app by Alan Dipert, already mentioned in Chapter <a href="htmltools-overview.html#htmltools-overview">3</a>.</li>
</ul>
<p>Let’s try below with <code>html_2_R</code>:</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/charpente">charpente</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/html_2_R.html">html_2_R</a></span><span class="op">(</span><span class="st">'&lt;div class="divclass" id = "someid"&gt;&lt;/div&gt;'</span><span class="op">)</span></code></pre></div>
<pre><code>## </code></pre>
<pre><code>## ── Converting code ... ──</code></pre>
<pre><code>## </code></pre>
<pre><code>## ✓ Code converted with success.</code></pre>
<pre><code>## ℹ Copy and paste the following R code</code></pre>
<pre><code>## ────────────────────────────────────────────────────────────────────────────────</code></pre>
<pre><code>## tags$div(
##   class = "divclass",
##   id = "someid"
## )</code></pre>
<p><code>html_2_R</code> has a <strong>prefix</strong> parameter which adds a <code>tags$</code> prefix if TRUE. It is
TRUE by default which prevents errors with unexported Shiny tags like <code>nav</code>.</p>
<p>The second main benefice of <a href="https://github.com/RinteRface/charpente">charpente</a> is the dependency management system.</p>
</div>
<div id="a-case-study-shinybulma" class="section level2">
<h2>
<span class="header-section-number">22.3</span> A case study: <code>{shinybulma}</code><a class="anchor" aria-label="anchor" href="#a-case-study-shinybulma"><i class="fas fa-link"></i></a>
</h2>
<p>In the following, we’ll illustrate <a href="https://github.com/RinteRface/charpente">charpente</a>’s workflow, through the R in Pharma workshop <a href="https://github.com/RinteRface/Unleash-Shiny-Exercise-1">exercises</a> focused on <a href="https://github.com/JohnCoene/shinybulma">shinybulma</a>.</p>
<p><a href="https://bulma.io/">bulma</a> is a more and more popular open source CSS framework for the web.
Importantly, there <strong>isn’t</strong> any JavaScript helper in the bulma core.
We’ll see later that the recent <a href="https://bulmajs.tomerbe.co.uk/">bulma JS</a> provides such feature.
For now, we only focus on HTML and CSS.</p>
<p>To initialize a <a href="https://github.com/RinteRface/charpente">charpente</a> package, we do:</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mypkg"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_charpente.html">create_charpente</a></span><span class="op">(</span><span class="va">path</span>, license <span class="op">=</span> <span class="st">"mit"</span><span class="op">)</span>
<span class="co"># TO FINISH</span></code></pre></div>
<p>This sets up a minimal viable package with git and optionally github remote setup,
Figure <a href="workflow-charpente.html#fig:workflow-charpente-pkg">22.2</a>.</p>
<div class="figure" style="text-align: center">
<span id="fig:workflow-charpente-pkg"></span>
<img src="images/workflow/charpente-pkg.png" alt="Package structure for {charpente}" width="100%"><p class="caption">
FIGURE 22.2: Package structure for {charpente}
</p>
</div>
<div id="build-the-html-dependency" class="section level3">
<h3>
<span class="header-section-number">22.3.1</span> Build the HTML dependency<a class="anchor" aria-label="anchor" href="#build-the-html-dependency"><i class="fas fa-link"></i></a>
</h3>
<p>The interested reader will have a look at the <strong>Getting started <a href="https://bulma.io/documentation/overview/start/">guide</a></strong>,
so as to know more how to get bulma. To install bulma dependencies, there are 3 ways.
For convenience, we’ll choose the CDN method (content delivery network) which consists in getting dependencies from a dedicated server.</p>
<p>We could build the bulma dependency as follows:</p>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools">htmltools</a></span><span class="op">)</span>
<span class="va">bulma_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="va">...</span>,
  version <span class="op">=</span> <span class="va">...</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="va">...</span><span class="op">)</span>,
  stylesheet <span class="op">=</span> <span class="va">...</span>
<span class="op">)</span>

<span class="va">add_bulma_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span><span class="va">...</span>, <span class="va">...</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>but this already takes too much time. This is where <a href="https://github.com/RinteRface/charpente">charpente</a> comes into play.
Specifically, the <code>create_dependency</code> function:</p>
<ul>
<li>Automatically download/points to the specified dependency by just providing its
name. It means you have to know what you are looking for. Best practice is
to have a look at the <a href="https://www.jsdelivr.com/">jsdelivr</a> website
(<a href="https://github.com/RinteRface/charpente">charpente</a> is built on top of jsdelivr) and find the good repository, as shown Figure
<a href="workflow-charpente.html#fig:workflow-jsdelivr-bulma">22.3</a>.</li>
<li>
<code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options(local = FALSE)</a></code> allows to fine tune the behavior. If local is FALSE,
<a href="https://github.com/RinteRface/charpente">charpente</a> points to the CDN without downloading any file. It is substantially faster than
the local option but requires an internet connection. Package developers will prefer the
<code>local = TRUE</code> to ensure dependencies are always accessible.</li>
<li>Extra parameters like <strong>tag</strong> control the downloaded version since HTML templates
may have several flavors. It is always good to be able to test multiple versions and select
the best option.</li>
<li>Creates the <code>add_&lt;DEP_NAME&gt;_deps</code> function in a <code>&lt;DEP_NAME&gt;--dependencies.R</code> script and opens it.</li>
</ul>
<div class="figure" style="text-align: center">
<span id="fig:workflow-jsdelivr-bulma"></span>
<img src="images/workflow/jsdelivr-bulma.png" alt="jsdelivr result for bulma" width="100%"><p class="caption">
FIGURE 22.3: jsdelivr result for bulma
</p>
</div>
<p>Once satisfied, we simply run to get the latest version:</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="st">"bulma"</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>local <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="st">"bulma"</span>, tag <span class="op">=</span> <span class="st">"0.7.0"</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>local <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>At the moment, <code>create_dependency</code> is not able to filter all files and you’ll have
to remove either <code>bulma-rtl.min.css</code> or <code>bulma.min.css</code>, rtl standing for right to left.</p>
<p>We can test our new dependency:</p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/load_all.html">load_all</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/findDependencies.html">findDependencies</a></span><span class="op">(</span><span class="fu">add_bulma_deps</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>which works like a charm. If you chose the local option, you would also get an <code>inst</code> folder
with all relevant bulma files sorted by type, that is css, javascript, …:</p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># local dependency script output</span>
<span class="va">add_bulma_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">bulma_deps</span> <span class="op">&lt;-</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"bulma"</span>,
  version <span class="op">=</span> <span class="st">"0.9.1"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"bulma-0.9.1"</span><span class="op">)</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/bulma.min.css"</span>,
  package <span class="op">=</span> <span class="st">"mypkg"</span>,
 <span class="op">)</span>
 <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">bulma_deps</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># CDN dependencies</span>
<span class="va">add_bulma_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">bulma_deps</span> <span class="op">&lt;-</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"bulma"</span>,
  version <span class="op">=</span> <span class="st">"0.9.1"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://cdn.jsdelivr.net/npm/bulma@0.9.1/"</span><span class="op">)</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/bulma.min.css"</span>
 <span class="op">)</span>
 <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">bulma_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="set-up-the-minimal-page-template" class="section level3">
<h3>
<span class="header-section-number">22.3.2</span> Set up the minimal page template<a class="anchor" aria-label="anchor" href="#set-up-the-minimal-page-template"><i class="fas fa-link"></i></a>
</h3>
<p>According to the <a href="https://bulma.io/documentation/overview/start/#starter-template">documentation</a>, the starter page template is:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb467-1"><a href="workflow-charpente.html#cb467-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb467-2"><a href="workflow-charpente.html#cb467-2"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb467-3"><a href="workflow-charpente.html#cb467-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb467-4"><a href="workflow-charpente.html#cb467-4"></a>    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">"utf-8"</span><span class="kw">&gt;</span></span>
<span id="cb467-5"><a href="workflow-charpente.html#cb467-5"></a>    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"viewport"</span><span class="ot"> content=</span><span class="st">"width=device-width, initial-scale=1"</span><span class="kw">&gt;</span></span>
<span id="cb467-6"><a href="workflow-charpente.html#cb467-6"></a>    <span class="kw">&lt;title&gt;</span>Hello Bulma!<span class="kw">&lt;/title&gt;</span></span>
<span id="cb467-7"><a href="workflow-charpente.html#cb467-7"></a>    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span><span class="ot"> href=</span><span class="st">"https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css"</span><span class="kw">&gt;</span></span>
<span id="cb467-8"><a href="workflow-charpente.html#cb467-8"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb467-9"><a href="workflow-charpente.html#cb467-9"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb467-10"><a href="workflow-charpente.html#cb467-10"></a>    <span class="kw">&lt;section</span><span class="ot"> class=</span><span class="st">"section"</span><span class="kw">&gt;</span></span>
<span id="cb467-11"><a href="workflow-charpente.html#cb467-11"></a>      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"container"</span><span class="kw">&gt;</span></span>
<span id="cb467-12"><a href="workflow-charpente.html#cb467-12"></a>        <span class="kw">&lt;h1</span><span class="ot"> class=</span><span class="st">"title"</span><span class="kw">&gt;</span></span>
<span id="cb467-13"><a href="workflow-charpente.html#cb467-13"></a>          Hello World</span>
<span id="cb467-14"><a href="workflow-charpente.html#cb467-14"></a>        <span class="kw">&lt;/h1&gt;</span></span>
<span id="cb467-15"><a href="workflow-charpente.html#cb467-15"></a>        <span class="kw">&lt;p</span><span class="ot"> class=</span><span class="st">"subtitle"</span><span class="kw">&gt;</span></span>
<span id="cb467-16"><a href="workflow-charpente.html#cb467-16"></a>          My first website with <span class="kw">&lt;strong&gt;</span>Bulma<span class="kw">&lt;/strong&gt;</span>!</span>
<span id="cb467-17"><a href="workflow-charpente.html#cb467-17"></a>        <span class="kw">&lt;/p&gt;</span></span>
<span id="cb467-18"><a href="workflow-charpente.html#cb467-18"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb467-19"><a href="workflow-charpente.html#cb467-19"></a>    <span class="kw">&lt;/section&gt;</span></span>
<span id="cb467-20"><a href="workflow-charpente.html#cb467-20"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb467-21"><a href="workflow-charpente.html#cb467-21"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>Adding some <a href="https://github.com/RinteRface/charpente">charpente</a> magic with <code>html_2_R</code>, we set the path parameter to <code>/html</code> to get the entire template. We, replace <code>...</code> by the appropriate content (see above). Since the copied HTML contains double quotations marks like <code>&lt;p class="subtitle"&gt;&lt;/p&gt;</code>, we put the string in single quotation marks.</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/html_2_R.html">html_2_R</a></span><span class="op">(</span>
  <span class="st">'&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
    &lt;title&gt;Hello Bulma!&lt;/title&gt;
    &lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css"&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;section class="section"&gt;
      &lt;div class="container"&gt;
        &lt;h1 class="title"&gt;
          Hello World
        &lt;/h1&gt;
        &lt;p class="subtitle"&gt;
          My first website with &lt;strong&gt;Bulma&lt;/strong&gt;!
        &lt;/p&gt;
      &lt;/div&gt;
    &lt;/section&gt;
  &lt;/body&gt;
&lt;/html&gt;
  '</span>,
  path <span class="op">=</span> <span class="st">"/html"</span>,
  prefix <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<pre><code>## </code></pre>
<pre><code>## ── Converting code ... ──</code></pre>
<pre><code>## </code></pre>
<pre><code>## ✓ Code converted with success.</code></pre>
<pre><code>## ℹ Copy and paste the following R code</code></pre>
<pre><code>## ────────────────────────────────────────────────────────────────────────────────</code></pre>
<pre><code>## tags$html(
##   tags$head(
##     tags$meta(charset = "utf-8"),
##     tags$meta(
##       name = "viewport",
##       content = "width=device-width, initial-scale=1"
##     ),
##     tags$title("Hello Bulma!"),
##     tags$link(
##       rel = "stylesheet",
##       href = "https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css"
##     )
##   ),
##   tags$body(tags$section(
##     class = "section",
##     tags$div(
##       class = "container",
##       tags$h1(
##         class = "title",
##         "Hello World"
##       ),
##       tags$p(
##         class = "subtitle",
##         "My first website with",
##         tags$strong("Bulma"),
##         "!"
##       )
##     )
##   ))
## )</code></pre>
<p><strong>Note</strong>: at run time, shiny adds <code>html</code> around the UI, thereby making it not necessary to include.
We’ll also don’t need the <code>link(rel = "stylesheet", href = "https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css")</code>
since <code>add_bulma_deps</code> does already attach the dependencies to the page.</p>
<p>The <code>bulma_page</code> function is, that you may save in the <code>R</code> package folder:</p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bulma_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu">add_bulma_deps</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span> 
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>With some practice, going from step 1 to the bulma page templates literally takes 3 minutes,
while it would have taken more than 30 minutes by hand. At any time, you may replace
the dependency with another version. Be careful, since <a href="https://github.com/RinteRface/charpente">charpente</a> does not make snapshots
of old versions.</p>
</div>
<div id="exercise-add-bulmajs" class="section level3">
<h3>
<span class="header-section-number">22.3.3</span> Exercise: add bulmaJS<a class="anchor" aria-label="anchor" href="#exercise-add-bulmajs"><i class="fas fa-link"></i></a>
</h3>
<p>As stated in the above, bulma only contains CSS things! It means we need
either to develop custom JS code to add interactivity or rely on any third party existing API.
<a href="https://bulmajs.tomerbe.co.uk/">bulma JS</a> is one of these!</p>
<ol style="list-style-type: decimal">
<li>Using <a href="https://github.com/RinteRface/charpente">charpente</a>, create a bulma js dependency. We’ll point to <a href="https://bulmajs.tomerbe.co.uk/">vizuaalog/bulmajs</a> since some bulmajs already exist and are not what we want. Run the following code in the R console.</li>
</ol>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="va">...</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>local <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Notice how many files are added to the dependency. In the following, we’ll only work with <strong>notifications</strong>:</p>
<ul>
<li>Only keep <code>notification.js</code> and remove all the unnecessary files</li>
<li>Only keep <code>bulma.js</code> that gather all plugins in 1 script.</li>
</ul>
<p>The best practice is usually to <strong>keep only what we need</strong> since some scripts may be <strong>heavy to load</strong>!</p>
<ol start="2" style="list-style-type: decimal">
<li>Run <code><a href="https://devtools.r-lib.org//reference/load_all.html">devtools::load_all()</a></code>. Modify the below code to test the newly created dependency. Hint: toggle the HTML inspector to check all appropriate dependencies are there!</li>
</ol>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">bulma_page</span><span class="op">(</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
<div id="add-custom-js" class="section level3">
<h3>
<span class="header-section-number">22.3.4</span> Add custom JS<a class="anchor" aria-label="anchor" href="#add-custom-js"><i class="fas fa-link"></i></a>
</h3>
<p>Notifications are always useful to send user feedback. Shiny has a notification system through <code><a href="https://shiny.rstudio.com/reference/shiny/latest/showNotification.html">shiny::showNotification</a></code>. Like Shiny, Bulma <a href="https://bulmajs.tomerbe.co.uk/docs/0.11/2-core-components/notification/">notifications</a> are entirely built from JS (no need for any HTML code).</p>
<p>The API works as follows:</p>
<ul>
<li>
<code>Bulma(target).notification(config)</code> creates the notification based on a JSON option list (config).
<code>target</code> expects a jQuery selector.</li>
<li>
<code>show</code> toggles the newly instantiated notification</li>
</ul>
<p>In other words the below code attaches the notification to the <code>body</code>:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb479-1"><a href="workflow-charpente.html#cb479-1"></a><span class="at">Bulma</span>(<span class="st">'body'</span>).<span class="at">notification</span>(<span class="op">{</span></span>
<span id="cb479-2"><a href="workflow-charpente.html#cb479-2"></a>  <span class="dt">body</span><span class="op">:</span> <span class="st">'Example notification'</span><span class="op">,</span></span>
<span id="cb479-3"><a href="workflow-charpente.html#cb479-3"></a>  <span class="dt">color</span><span class="op">:</span> <span class="st">'info'</span></span>
<span id="cb479-4"><a href="workflow-charpente.html#cb479-4"></a><span class="op">}</span>).<span class="at">show</span>()<span class="op">;</span></span></code></pre></div>
<p>In the following we design the R interface and JavaScript handler (which is no more than an event listener).
<a href="https://github.com/RinteRface/charpente">charpente</a> has a function that creates both pieces, namely <code>create_custom_handler</code>:</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_custom_handler</a></span><span class="op">(</span><span class="st">"notification"</span><span class="op">)</span></code></pre></div>
<p>We obtain the <code>notification-handler.R</code> script:</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">send_notification_message</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">session</span> <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="co"># your logic</span>
 <span class="op">)</span>
 
 <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"notification"</span>, <span class="va">message</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>and the corresponding JavaScript piece in <code>notification.js</code>,
derived from the <a href="https://github.com/ThinkR-open/golem">golem</a> <code>add_js_handler</code> function:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb482-1"><a href="workflow-charpente.html#cb482-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb482-2"><a href="workflow-charpente.html#cb482-2"></a>  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'notification'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb482-3"><a href="workflow-charpente.html#cb482-3"></a> </span>
<span id="cb482-4"><a href="workflow-charpente.html#cb482-4"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb482-5"><a href="workflow-charpente.html#cb482-5"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>By default, the JS file is created in the <code>srcjs</code> directory. This is a special directory
where we store all JavaScript files that depend on the package author. For instance,
bulmaJS is an external dependency and is very unlikely to be edited by the package author. For that reason,
it remains in the <code>inst</code> folder like all other external dependencies.</p>
</div>
<div id="add-custom-inputoutput-bindings" class="section level3">
<h3>
<span class="header-section-number">22.3.5</span> Add custom input/output bindings<a class="anchor" aria-label="anchor" href="#add-custom-inputoutput-bindings"><i class="fas fa-link"></i></a>
</h3>
<p>In part <a href="shiny-input-system.html#secondary-inputs">12.2</a>, we created better shinydashboard boxes that one
may programmatically collapse, close and restore. Until know, there was no way to
setup an input binding skeleton and one had to copy and paste each time the same
code. <a href="https://github.com/RinteRface/charpente">charpente</a> has a <code>create_input_binding</code> and <code>create_output_binding</code> (functions that
you can also find in the development version of <a href="https://github.com/ThinkR-open/golem">golem</a>). Contrary to the custom handler case,
<code>create_input_binding</code> only generate the JavaScript piece since the R part is highly variable from
one input to another. To get a plug and play box input binding we call:</p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_input_binding</a></span><span class="op">(</span><span class="st">"boxBinding"</span><span class="op">)</span></code></pre></div>
<p>which gives the <code>input-boxBinding.js</code> script in the <code>srcjs</code> folder:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb484-1"><a href="workflow-charpente.html#cb484-1"></a><span class="kw">var</span> boxBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">InputBinding</span>()<span class="op">;</span></span>
<span id="cb484-2"><a href="workflow-charpente.html#cb484-2"></a><span class="va">$</span>.<span class="at">extend</span>(boxBinding<span class="op">,</span> <span class="op">{</span></span>
<span id="cb484-3"><a href="workflow-charpente.html#cb484-3"></a>  <span class="dt">find</span><span class="op">:</span> <span class="kw">function</span>(scope) <span class="op">{</span></span>
<span id="cb484-4"><a href="workflow-charpente.html#cb484-4"></a>    <span class="co">// JS logic $(scope).find('whatever')</span></span>
<span id="cb484-5"><a href="workflow-charpente.html#cb484-5"></a>  <span class="op">},</span></span>
<span id="cb484-6"><a href="workflow-charpente.html#cb484-6"></a>  <span class="dt">getValue</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></span>
<span id="cb484-7"><a href="workflow-charpente.html#cb484-7"></a>    <span class="co">// JS code to get value</span></span>
<span id="cb484-8"><a href="workflow-charpente.html#cb484-8"></a>  <span class="op">},</span></span>
<span id="cb484-9"><a href="workflow-charpente.html#cb484-9"></a>  <span class="dt">setValue</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) <span class="op">{</span></span>
<span id="cb484-10"><a href="workflow-charpente.html#cb484-10"></a>    <span class="co">// JS code to set value</span></span>
<span id="cb484-11"><a href="workflow-charpente.html#cb484-11"></a>  <span class="op">},</span></span>
<span id="cb484-12"><a href="workflow-charpente.html#cb484-12"></a>  <span class="dt">receiveMessage</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) <span class="op">{</span></span>
<span id="cb484-13"><a href="workflow-charpente.html#cb484-13"></a>    <span class="co">// this.setValue(el, data);</span></span>
<span id="cb484-14"><a href="workflow-charpente.html#cb484-14"></a>  <span class="op">},</span></span>
<span id="cb484-15"><a href="workflow-charpente.html#cb484-15"></a>  <span class="dt">subscribe</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) <span class="op">{</span></span>
<span id="cb484-16"><a href="workflow-charpente.html#cb484-16"></a>    <span class="at">$</span>(el).<span class="at">on</span>(<span class="st">'click.boxBinding'</span><span class="op">,</span> <span class="kw">function</span>(e) <span class="op">{</span></span>
<span id="cb484-17"><a href="workflow-charpente.html#cb484-17"></a>      <span class="at">callback</span>()<span class="op">;</span></span>
<span id="cb484-18"><a href="workflow-charpente.html#cb484-18"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb484-19"><a href="workflow-charpente.html#cb484-19"></a></span>
<span id="cb484-20"><a href="workflow-charpente.html#cb484-20"></a>  <span class="op">},</span></span>
<span id="cb484-21"><a href="workflow-charpente.html#cb484-21"></a>  <span class="dt">unsubscribe</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></span>
<span id="cb484-22"><a href="workflow-charpente.html#cb484-22"></a>    <span class="at">$</span>(el).<span class="at">off</span>(<span class="st">'.boxBinding'</span>)<span class="op">;</span></span>
<span id="cb484-23"><a href="workflow-charpente.html#cb484-23"></a>  <span class="op">}</span></span>
<span id="cb484-24"><a href="workflow-charpente.html#cb484-24"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb484-25"><a href="workflow-charpente.html#cb484-25"></a><span class="va">Shiny</span>.<span class="va">inputBindings</span>.<span class="at">register</span>(boxBinding<span class="op">,</span> <span class="st">'shiny.whatever'</span>)<span class="op">;</span></span></code></pre></div>
<p>This function has multiple options:</p>
<ul>
<li>
<strong>initialized</strong> is FALSE by default. If TRUE, it adds an <code>initialized</code> method
to the binding.</li>
<li>
<strong>dev</strong> adds some <code>console.log</code> elements whenever relevant to help in the debugging
process.</li>
<li>
<strong>event</strong> is a list containing events related to the binding. By default, it generates
a <code>click</code> event without any rate policy. To add extra events we do
<code><a href="https://rdrr.io/r/base/list.html">list(name = c("click", "whatever"), rate_policy = c(FALSE, TRUE))</a></code>.</li>
</ul>
<p>Similarly, the <code>create_output_binding</code> function creates a ready to use output binding JS script,
in the <code>srcjs</code> folder (<code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_output_binding("menuOutput")</a></code>):</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb485-1"><a href="workflow-charpente.html#cb485-1"></a><span class="kw">var</span> menuOutput <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">OutputBinding</span>()<span class="op">;</span></span>
<span id="cb485-2"><a href="workflow-charpente.html#cb485-2"></a><span class="va">$</span>.<span class="at">extend</span>(menuOutput<span class="op">,</span> <span class="op">{</span></span>
<span id="cb485-3"><a href="workflow-charpente.html#cb485-3"></a>  <span class="dt">find</span><span class="op">:</span> <span class="kw">function</span>(scope) <span class="op">{</span></span>
<span id="cb485-4"><a href="workflow-charpente.html#cb485-4"></a>    <span class="co">// JS logic $(scope).find('whatever')</span></span>
<span id="cb485-5"><a href="workflow-charpente.html#cb485-5"></a>  <span class="op">},</span></span>
<span id="cb485-6"><a href="workflow-charpente.html#cb485-6"></a>  <span class="dt">renderValue</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) <span class="op">{</span></span>
<span id="cb485-7"><a href="workflow-charpente.html#cb485-7"></a>    <span class="co">// JS logic</span></span>
<span id="cb485-8"><a href="workflow-charpente.html#cb485-8"></a>  <span class="op">}</span></span>
<span id="cb485-9"><a href="workflow-charpente.html#cb485-9"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb485-10"><a href="workflow-charpente.html#cb485-10"></a><span class="va">Shiny</span>.<span class="va">outputBindings</span>.<span class="at">register</span>(menuOutput<span class="op">,</span> <span class="st">'shiny.whatever'</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="organize-your-js-code" class="section level3">
<h3>
<span class="header-section-number">22.3.6</span> Organize your JS code<a class="anchor" aria-label="anchor" href="#organize-your-js-code"><i class="fas fa-link"></i></a>
</h3>
<p>This naturally leads us to this part which is about JS code organization. Shiny developers
may have a lot of custom scripts, and it is generally a bad idea to put them all
under <code>inst</code>. Instead, we put them in <code>srcjs</code>, concatenate and minify them to create one big
<code>file.min.js</code> in the <code>inst</code> folder. This is better for performance since file size matter in JS.</p>
<p>The dreamRs team developed a tool to seamlessly format, organize, validate CSS and JS code, that is
<a href="https://github.com/dreamRs/jstools">{jstools}</a>. Interestingly, it has 2 addins allowing to quickly
format and validate a given JS file.</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"dreamRs/jstools"</span><span class="op">)</span></code></pre></div>
<p>We are going to create a second custom handler with <a href="https://github.com/RinteRface/charpente">charpente</a> and reorganize
the whole JS code:</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_custom_handler</a></span><span class="op">(</span><span class="st">"modal"</span><span class="op">)</span></code></pre></div>
<p>Now there should be 2 JS scripts in the <code>srcjs</code> folder. Below, we use a compressor, namely
<a href="https://terser.org/">terser</a>, that optimizes and compresses our code for the web browser, at a price to be less
human readable. It also provides source maps that are crucial to the debugging process, thereby making it possible to reconstruct the original JS code starting from a minified script:</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dreamRs/jstools">jstools</a></span><span class="op">)</span>
<span class="va">mypkgJS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="st">"srcjs"</span>,
  recursive <span class="op">=</span> <span class="cn">TRUE</span>,
  full.names <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"inst"</span><span class="op">)</span>
<span class="va">outputDir</span> <span class="op">&lt;-</span> <span class="st">"inst/mypkg-0.0.0.9000"</span>
<span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">outputDir</span><span class="op">)</span>

<span class="co"># Concat + Compress + source maps ----------------------------------------------------------------</span>

<span class="fu"><a href="https://rdrr.io/pkg/jstools/man/terser.html">terser_file</a></span><span class="op">(</span>
  input <span class="op">=</span> <span class="va">mypkgJS</span>,
  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%s/mypkg.min.js"</span>, <span class="va">outputDir</span><span class="op">)</span>,
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/jstools/man/terser.html">terser_options</a></span><span class="op">(</span>
    sourceMap <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      root <span class="op">=</span> <span class="st">"../../mypkg-build"</span>,
      filename <span class="op">=</span> <span class="st">"mypkg.min.js"</span>,
      url <span class="op">=</span> <span class="st">"mypkg.min.js.map"</span>,
      includeSources <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p><code>terser_file</code> takes all raw JS files as input, generate a minified/optimized script as well
as source maps available at <code>mypkg.min.js.map</code>. The <strong>root</strong> parameter indicates their location
on the server once the shiny app running:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb489-1"><a href="workflow-charpente.html#cb489-1"></a><span class="at">$</span>((<span class="kw">function</span>()<span class="op">{</span><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">"modal"</span><span class="op">,</span>(<span class="kw">function</span>(n)<span class="op">{}</span>))<span class="op">}</span>))<span class="op">,</span></span>
<span id="cb489-2"><a href="workflow-charpente.html#cb489-2"></a><span class="at">$</span>((<span class="kw">function</span>()<span class="op">{</span><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">"notification"</span><span class="op">,</span>(<span class="kw">function</span>(n)<span class="op">{}</span>))<span class="op">}</span>))<span class="op">;</span></span>
<span id="cb489-3"><a href="workflow-charpente.html#cb489-3"></a><span class="co">//# sourceMappingURL=mypkg.min.js.map</span></span></code></pre></div>
<p>The good new is that <a href="https://github.com/RinteRface/charpente">charpente</a> can automate this task in only one line of code:</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/compress_js.html">compress_js</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Additionally, this creates a plug and play dependency pointing to the newly generated JS file:</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_mypkg_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">mypkg_deps</span> <span class="op">&lt;-</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"mypkg"</span>,
  version <span class="op">=</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"mypkg"</span><span class="op">)</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"mypkg-0.0.0.9000"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"js/mypkg.min.js"</span>,
  package <span class="op">=</span> <span class="st">"mypkg"</span>,
 <span class="op">)</span>
 <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">mypkg_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><strong>Disclaimer</strong>: there is not yet similar process for CSS. This is still work in progress.</p>
<p>Other tools exist like <a href="https://github.com/JohnCoene/packer"><code>{packer}</code></a> by John Coene, which leverages <a href="https://webpack.js.org/">webpack</a> to handle JS code.</p>
</div>
<div id="combine-multiple-dependencies" class="section level3">
<h3>
<span class="header-section-number">22.3.7</span> Combine multiple dependencies<a class="anchor" aria-label="anchor" href="#combine-multiple-dependencies"><i class="fas fa-link"></i></a>
</h3>
<p><code>add_dependencies</code> allow to select any dependency available in the <code>./R</code> folder, provided that they follow the convention <code>&lt;depName&gt;_dependencies.R</code> (which is always the case if you use <a href="https://github.com/RinteRface/charpente">charpente</a>). For instance <code><a href="https://rdrr.io/pkg/charpente/man/add_dependencies.html">add_dependencies(div(), deps = c("bulma", "bulmajs"))</a></code> will add bulma (first) and bulmajs dependencies to a <code>div</code> tag. You may change the order as you want since most of the time, the order matters. <code>bulma_page</code> could also benefit from that shortcut:</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bulma_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"bulma"</span>, <span class="st">"mypkg"</span><span class="op">)</span>
    <span class="op">)</span> 
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="other-charpente-helpers" class="section level3">
<h3>
<span class="header-section-number">22.3.8</span> Other <code>{charpente}</code> helpers<a class="anchor" aria-label="anchor" href="#other-charpente-helpers"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s finish this section by listing some tools. We know <code>create_dependency</code> to install
an external dependency. For instance this code installs framework7 dependencies:</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="st">"framework7"</span><span class="op">)</span></code></pre></div>
<p>The problem is that we don’t necessarily know all package versions and yOu may need
<code>framework7 4.5.0</code> or <code>framework7 5.3.1</code>. <code>get_dependency_versions</code> allows to look for
all versions:</p>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_versions.html">get_dependency_versions</a></span><span class="op">(</span><span class="st">"framework7"</span><span class="op">)</span></code></pre></div>
<pre><code>## ℹ Trying with https://data.jsdelivr.com/v1/package/npm/framework7</code></pre>
<pre><code>## ✓ Success!</code></pre>
<pre><code>## ────────────────────────────────────────────────────────────────────────────────</code></pre>
<pre><code>##   [1] "6.0.0-beta.5"   "6.0.0-beta.4"   "6.0.0-beta.3"   "6.0.0-beta.2"  
##   [5] "6.0.0-beta.1"   "6.0.0-alpha.17" "6.0.0-alpha.16" "6.0.0-alpha.15"
##   [9] "6.0.0-alpha.14" "6.0.0-alpha.13" "6.0.0-alpha.12" "6.0.0-alpha.11"
##  [13] "6.0.0-alpha.10" "6.0.0-alpha.9"  "6.0.0-alpha.8"  "6.0.0-alpha.7" 
##  [17] "6.0.0-alpha.6"  "6.0.0-alpha.5"  "6.0.0-alpha.4"  "6.0.0-alpha.3" 
##  [21] "6.0.0-alpha.2"  "6.0.0-alpha.1"  "5.7.14"         "5.7.13"        
##  [25] "5.7.12"         "5.7.11"         "5.7.10"         "5.7.9"         
##  [29] "5.7.8"          "5.7.7"          "5.7.6"          "5.7.5"         
##  [33] "5.7.2"          "5.7.1"          "5.7.0"          "5.6.0"         
##  [37] "5.5.5"          "5.5.4"          "5.5.3"          "5.5.2"         
##  [41] "5.5.1"          "5.5.0"          "5.4.5"          "5.4.2"         
##  [45] "5.4.1"          "5.4.0"          "5.4.0-beta.3"   "5.4.0-beta.2"  
##  [49] "5.4.0-beta.1"   "5.3.2"          "5.3.0"          "5.2.0"         
##  [53] "5.1.3"          "5.1.2"          "5.1.1"          "5.1.0"         
##  [57] "5.0.5"          "5.0.4"          "5.0.3"          "5.0.2"         
##  [61] "5.0.1"          "5.0.0"          "5.0.0-beta.20"  "5.0.0-beta.19" 
##  [65] "5.0.0-beta.17"  "5.0.0-beta.16"  "5.0.0-beta.15"  "5.0.0-beta.14" 
##  [69] "5.0.0-beta.12"  "5.0.0-beta.11"  "5.0.0-beta.10"  "5.0.0-beta.7"  
##  [73] "5.0.0-beta.6"   "5.0.0-beta.5"   "5.0.0-beta.3"   "5.0.0-beta.2"  
##  [77] "5.0.0-beta.1"   "4.5.2"          "4.5.1"          "4.5.0"         
##  [81] "4.4.10"         "4.4.9"          "4.4.8"          "4.4.7"         
##  [85] "4.4.6"          "4.4.5"          "4.4.3"          "4.4.0"         
##  [89] "4.3.1"          "4.3.0"          "4.2.2"          "4.2.0"         
##  [93] "4.1.1"          "4.1.0"          "4.0.6"          "4.0.5"         
##  [97] "4.0.4"          "4.0.3"          "4.0.2"          "4.0.1"         
## [101] "4.0.0"          "4.0.0-beta.35"  "4.0.0-beta.34"  "4.0.0-beta.33" 
## [105] "4.0.0-beta.32"  "4.0.0-beta.31"  "4.0.0-beta.30"  "4.0.0-beta.29" 
## [109] "4.0.0-beta.28"  "4.0.0-beta.27"  "4.0.0-beta.26"  "4.0.0-beta.25" 
## [113] "4.0.0-beta.24"  "4.0.0-beta.23"  "4.0.0-beta.22"  "4.0.0-beta.21" 
## [117] "4.0.0-beta.20"  "4.0.0-beta.18"  "4.0.0-beta.17"  "4.0.0-beta.16" 
## [121] "4.0.0-beta.15"  "4.0.0-beta.14"  "4.0.0-beta.12"  "4.0.0-beta.11" 
## [125] "4.0.0-beta.10"  "4.0.0-beta.8"   "4.0.0-beta.7"   "4.0.0-beta.6"  
## [129] "4.0.0-beta.5"   "4.0.0-beta.4"   "4.0.0-beta.3"   "4.0.0-beta.2"  
## [133] "4.0.0-beta.1"   "3.6.7"          "3.6.6"          "3.6.5"         
## [137] "3.6.3"          "3.6.2"          "3.6.1"          "3.6.0"         
## [141] "3.5.2"          "3.5.1"          "3.5.0"          "3.4.3"         
## [145] "3.4.2"          "3.4.0"          "3.3.2"          "3.3.1"         
## [149] "3.3.0"          "3.2.1"          "3.2.0"          "3.1.1"         
## [153] "3.1.0"          "3.0.7"          "3.0.6"          "3.0.5"         
## [157] "3.0.1"          "3.0.0"          "3.0.0-beta.19"  "3.0.0-beta.18" 
## [161] "3.0.0-beta.17"  "3.0.0-beta.16"  "3.0.0-beta.15"  "3.0.0-beta.14" 
## [165] "3.0.0-beta.12"  "3.0.0-beta.11"  "3.0.0-beta.10"  "3.0.0-beta.9"  
## [169] "3.0.0-beta.8"   "3.0.0-beta.7"   "3.0.0-beta.6"   "3.0.0-beta.5"  
## [173] "3.0.0-beta.4"   "3.0.0-beta.3"   "3.0.0-beta.2"   "3.0.0-beta.1"  
## [177] "2.3.1"          "2.3.0"          "2.2.5"          "2.2.1"         
## [181] "2.2.0"          "2.1.3"          "2.1.2"          "2.1.1"         
## [185] "2.0.10"         "2.0.8"          "2.0.7"          "2.0.6"         
## [189] "2.0.5"          "2.0.2"          "2.0.1"          "2.0.0"         
## [193] "2.0.0-beta.21"  "2.0.0-beta.20"  "2.0.0-beta.19"  "2.0.0-beta.18" 
## [197] "2.0.0-beta.17"  "2.0.0-beta.16"  "2.0.0-beta.15"  "2.0.0-beta.14" 
## [201] "2.0.0-beta.12"  "2.0.0-beta.11"  "2.0.0-beta.10"  "2.0.0-beta.9"  
## [205] "2.0.0-beta.8"   "2.0.0-beta.7"   "2.0.0-beta.6"   "2.0.0-beta.5"  
## [209] "2.0.0-beta.4"   "2.0.0-beta.3"   "2.0.0-beta.2"   "2.0.0-beta.1"  
## [213] "1.7.1"          "1.7.0"          "1.6.5"          "1.6.4"         
## [217] "1.6.3"          "1.6.2"          "1.6.0"          "1.5.4"         
## [221] "1.5.3"          "1.5.2"          "1.5.0"          "1.4.2"         
## [225] "1.4.0"          "1.3.5"          "1.3.1"          "1.3.0"         
## [229] "1.2.0"          "1.0.7"          "1.0.6"          "1.0.5"         
## [233] "1.0.4"          "1.0.3"          "1.0.2"          "1.0.1"         
## [237] "1.0.0"          "0.10.0"</code></pre>
<div class="sourceCode" id="cb499"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_versions.html">get_dependency_versions</a></span><span class="op">(</span><span class="st">"framework7"</span>, latest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## ℹ Trying with https://data.jsdelivr.com/v1/package/npm/framework7</code></pre>
<pre><code>## ✓ Success!</code></pre>
<pre><code>## ────────────────────────────────────────────────────────────────────────────────</code></pre>
<pre><code>## [1] "5.7.14"</code></pre>
<p>Specifying <code>latest = TRUE</code> ensures to recover the very last <strong>stable</strong> version
(it excludes alpha/beta versions).</p>
<p>You may explore also the dependency files with <code>get_dependency_assets</code>, even for
a specific version with <strong>tag</strong>:</p>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_assets.html">get_dependency_assets</a></span><span class="op">(</span><span class="st">"bootstrap"</span><span class="op">)</span></code></pre></div>
<pre><code>## ℹ Trying with https://data.jsdelivr.com/v1/package/npm/bootstrap</code></pre>
<pre><code>## ✓ Success!</code></pre>
<pre><code>## ────────────────────────────────────────────────────────────────────────────────</code></pre>
<pre><code>## $url
## [1] "https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/"
## 
## $files
##                            name                                         hash
## 1           bootstrap.bundle.js U+mDCLgTk8IMb18+fQT+ucvP73uHTPaG2qZU9o7smtE=
## 2       bootstrap.bundle.js.map YJMOk7ccIv7s6lDK/ajRvOCs1eIKI5Z9XRHs7trBp9A=
## 3       bootstrap.bundle.min.js jXCJJT3KKcnNjZ3rfsabCj1EX4j2omR4xxm+H5CtywE=
## 4   bootstrap.bundle.min.js.map uNbbfrF1OXpvmsTSPFLIOPIbJPPqBIGoR6WIGolFaVc=
## 5                  bootstrap.js WdL2tWzdI6gzpVFnFzaxEwIj8WsZD5L1TlHTKQ2DO1g=
## 6              bootstrap.js.map HBB1WAmY3+442kzuvF8b5tJXMM1cz61xwkKIzAnbW6w=
## 7              bootstrap.min.js 2JaAhvdQnfNMMnhWPauHOZ2k+dzftBmBjjownu3HC4g=
## 8          bootstrap.min.js.map RE1Ort2xyjPVzw37Xs43LyZPtQieTQ8mgrM/xMfj1x4=
## 9                 bootstrap.css L9fxXhh0DKyukbrb0cy4GeQxzbUQ2K8+70UQCD3i5zM=
## 10            bootstrap.css.map ButqG+1kTig4Aquw5jNuh9mma9Zf8nnLcSRFQg2FFis=
## 11            bootstrap.min.css 93wNFzm2GO3EoByj9rKZCwGjAJAwr0nujPaOgwUt8ZQ=
## 12        bootstrap.min.css.map wo9wagfxvO/GQtEWWDZaoNc6DJCCY5eSAY40nrdgWBo=
## 13           bootstrap-grid.css R1GSXe1KGXUbB5LRkcwDbBnoC2j/UgVGBcR2mxOjjG8=
## 14       bootstrap-grid.css.map h0+T00I0mJwQOGJMe3PQZeV2hyxj0GGKNkZVKYzgle0=
## 15       bootstrap-grid.min.css Ox8H+DLyNLmbsy0unOdOpDT5rBGgsSNHmoiiAYvoK1I=
## 16   bootstrap-grid.min.css.map ShccoPA4BzSSedt00iUnQfIFw+kzrpFfNgav9nML7wU=
## 17         bootstrap-reboot.css 7o4if/8U8F8pzT376nBLy1R93HsXAbm+Fcv+bSsuvJ0=
## 18     bootstrap-reboot.css.map qFOMcRi0iP1yV9bs3IiJF0VgFjoXUknGSeJBpWJ6BI8=
## 19     bootstrap-reboot.min.css 2kkMxiKVm/28PqTYiAIS9eN3EjIV3wRubwkpd6cQxH0=
## 20 bootstrap-reboot.min.css.map XIyF06HHRdUQmW8j7EvIYm2eoxB9+lEebF4mf7rPsOk=
## 
## $hasSubfolders
## [1] TRUE</code></pre>
<p>This is helpful to further fine tune <code>charpente_options</code>. It is indeed possible
that you don’t want bundles (<code>bootstrap.bundle.min.js</code>), minified, lite versions of scripts.</p>
<p><code>get_installed_dependency</code> allows to inspect which dependencies are installed. It only works
if the dependencies were created locally, that is <code><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options(local = TRUE)</a></code>.</p>
<p>Finally, one may ask how to update a given dependency. <code>update_dependency</code> does this, provided that
the dependency is installed locally. By default, it installs the latest version of the targeted dependency.
It gives a diagnosis comparing the current installed version
with the latest available version. The are 3 possible cases: dependencies are up to date
and <code><a href="https://rdrr.io/pkg/charpente/man/update_dependency.html">update_dependency("bulma")</a></code> yields:</p>
<pre><code>ℹ Trying with https://data.jsdelivr.com/v1/package/npm/bulma
✓ Success!
──────────────────────────────────────────────────────────────────────────────
Error in update_dependency("bulma") : Versions are identical</code></pre>
<p>The installed dependencies are outdated (we have 0.7.0 with <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency("bulma", tag = "0.7.0", options = charpente_options(local = TRUE))</a></code>), the function shows the targeted version as well as
the last one:</p>
<pre><code>ℹ Trying with https://data.jsdelivr.com/v1/package/npm/bulma
✓ Success!
──────────────────────────────────────────────────────────────────────────────
ℹ current version: 0.7.0 ||
target version: 0.9.1 ||
latest version: 0.9.1
! Upgrading bulma to 0.9.1
✓ Directory inst/bulma-0.9.1/css successfully created
! Remove existing file R/bulma-dependencies.R</code></pre>
<p>The last use case is a downgrade, which may be possible if the package maintainer realizes
that the dependency version is too unstable. In the following, we have <code>bulma-0.9.1</code> installed
and downgrade to 0.7.0 with <code><a href="https://rdrr.io/pkg/charpente/man/update_dependency.html">update_dependency("bulma", version_target = "0.7.0")</a></code>:</p>
<pre><code>ℹ Trying with https://data.jsdelivr.com/v1/package/npm/bulma
✓ Success!
──────────────────────────────────────────────────────────────────────────────
ℹ current version: 0.9.1 ||
target version: 0.7.0 ||
latest version: 0.9.1
! Downgrading bulma to 0.7.0
✓ Directory inst/bulma-0.7.0/css successfully created
! Remove existing file R/bulma-dependencies.R</code></pre>
</div>
</div>
<div id="other-tips" class="section level2">
<h2>
<span class="header-section-number">22.4</span> Other tips<a class="anchor" aria-label="anchor" href="#other-tips"><i class="fas fa-link"></i></a>
</h2>
<div id="validate-javascript" class="section level3">
<h3>
<span class="header-section-number">22.4.1</span> Validate JavaScript<a class="anchor" aria-label="anchor" href="#validate-javascript"><i class="fas fa-link"></i></a>
</h3>
<p>We could not finish this chapter without mentioning tools to validate JavaScript code. We will particularly focus on <a href="https://jshint.com">JSHint</a>, which comes with <a href="https://github.com/dreamRs/jstools">{jstools}</a>. Below is an example of how to check all the <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> JavaScript input bindings at once:</p>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bindings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>
  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"framework7-5.7.8/input-bindings"</span>, package <span class="op">=</span> <span class="st">"shinyMobile"</span><span class="op">)</span>,
  recursive <span class="op">=</span> <span class="cn">TRUE</span>,
  full.names <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/jstools/man/JSHint.html">jshint_file</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">bindings</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/jstools/man/JSHint.html">jshint_options</a></span><span class="op">(</span>jquery <span class="op">=</span> <span class="cn">TRUE</span>, globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Shiny"</span>, <span class="st">"app"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## ── Checking actionSheetInputBinding.js ───────────────────────────────────────── 
## No errors found. 
## ── Checking autoCompleteInputBinding.js ──────────────────────────────────────── 
## No errors found. 
## ── Checking buttonInputBinding.js ────────────────────────────────────────────── 
## No errors found. 
## ── Checking cardInputBinding.js ──────────────────────────────────────────────── 
## No errors found. 
## ── Checking collapsibleInputBinding.js ───────────────────────────────────────── 
## No errors found. 
## ── Checking colorPickerInputBinding.js ───────────────────────────────────────── 
## 9 errors found. 
##  - Line 11: 'colorPickerModules' is not defined. 
##  - Line 16: 'colorPickerSliderValue' is not defined. 
##  - Line 17: 'colorPickerSliderValueEditable' is not defined. 
##  - Line 18: 'colorPickerSliderLabel' is not defined. 
##  - Line 19: 'colorPickerHexLabel' is not defined. 
##  - Line 20: 'colorPickerHexValueEditable' is not defined. 
##  - Line 21: 'colorPickerGroupedModules' is not defined. 
##  - Line 24: 'colorPickerPalettes' is not defined. 
##  - Line 29: 'colorPickerValue' is not defined. 
## ── Checking dateInputBinding.js ──────────────────────────────────────────────── 
## 1 errors found. 
##  - Line 11: 'console' is not defined. 
## ── Checking datePickerInputBinding.js ────────────────────────────────────────── 
## No errors found. 
## ── Checking fabsInputBinding.js ──────────────────────────────────────────────── 
## No errors found. 
## ── Checking gaugeInputBinding.js ─────────────────────────────────────────────── 
## 1 errors found. 
##  - Line 47: 'g' is defined but never used. 
## ── Checking loginInputBinding.js ─────────────────────────────────────────────── 
## No errors found. 
## ── Checking menuInputBinding.js ──────────────────────────────────────────────── 
## No errors found. 
## ── Checking messageBarInputBinding.js ────────────────────────────────────────── 
## No errors found. 
## ── Checking messagesInputBinding.js ──────────────────────────────────────────── 
## 2 errors found. 
##  - Line 70: 'responseInProgress' is not defined. 
##  - Line 85: 'responseInProgress' is not defined. 
## ── Checking panelInputBinding.js ─────────────────────────────────────────────── 
## No errors found. 
## ── Checking pickerInputBinding.js ────────────────────────────────────────────── 
## No errors found. 
## ── Checking popupInputBinding.js ─────────────────────────────────────────────── 
## 1 errors found. 
##  - Line 20: 'p' is defined but never used. 
## ── Checking selectInputBinding.js ────────────────────────────────────────────── 
## No errors found. 
## ── Checking sheetInputBinding.js ─────────────────────────────────────────────── 
## 1 errors found. 
##  - Line 34: 's' is defined but never used. 
## ── Checking sliderInputBinding.js ────────────────────────────────────────────── 
## 1 errors found. 
##  - Line 35: 'r' is defined but never used. 
## ── Checking smartSelectBinding.js ────────────────────────────────────────────── 
## No errors found. 
## ── Checking stepperInputBinding.js ───────────────────────────────────────────── 
## 1 errors found. 
##  - Line 33: 's' is defined but never used. 
## ── Checking tabsInputBinding.js ──────────────────────────────────────────────── 
## No errors found. 
## ── Checking toggleInputBinding.js ────────────────────────────────────────────── 
## No errors found. 
## ── Checking virtualListBinding.js ────────────────────────────────────────────── 
## 3 errors found. 
##  - Line 21: 'for of' is available in ES6 (use 'esversion: 6') or Mozilla JS extensions (use moz). 
##  - Line 107: 'template literal syntax' is only available in ES6 (use 'esversion: 6'). 
##  - Line 111: 'template literal syntax' is only available in ES6 (use 'esversion: 6').</code></pre>
<p>You may fine tune the <code>jshint_file</code> behavior with the <a href="https://jshint.com/docs/options/"><code>jshint_options</code></a>. One is often tempted to call <code>eval</code> in JS code, which will result in a JSHint error. An option called <code>evil</code> exists to disable the corresponding test. However, we recommend to play the game, accept those error and try to fix them instead of cheating with options! An important remark about validation is that it does not check whether your code
does what it should do. It just focus on checking whether the code runs! To test
the JavaScript behavior, please refer to Chapter <a href="custom-templates-testing.html#custom-templates-testing-js">19.2.1.2</a>.
Be extremely careful: if we consider the example mentioned in section <a href="survival-kit-javascript.html#broken-shiny-app-debug">10.6.2</a>, the
following code is valid JavaScript:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb514-1"><a href="workflow-charpente.html#cb514-1"></a><span class="kw">const</span> sendNotif <span class="op">=</span> (message<span class="op">,</span> type<span class="op">,</span> duration) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb514-2"><a href="workflow-charpente.html#cb514-2"></a>  <span class="va">Shiny</span>.<span class="va">notification</span>.<span class="at">show</span>(<span class="op">{</span></span>
<span id="cb514-3"><a href="workflow-charpente.html#cb514-3"></a>    <span class="dt">html</span><span class="op">:</span> <span class="vs">`&lt;strong&gt;</span><span class="sc">${</span>message<span class="sc">}</span><span class="vs">&lt;/strong&gt;`</span><span class="op">,</span></span>
<span id="cb514-4"><a href="workflow-charpente.html#cb514-4"></a>    <span class="dt">type</span><span class="op">:</span> type<span class="op">,</span></span>
<span id="cb514-5"><a href="workflow-charpente.html#cb514-5"></a>    <span class="dt">duration</span><span class="op">:</span> duration</span>
<span id="cb514-6"><a href="workflow-charpente.html#cb514-6"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb514-7"><a href="workflow-charpente.html#cb514-7"></a><span class="op">};</span></span>
<span id="cb514-8"><a href="workflow-charpente.html#cb514-8"></a></span>
<span id="cb514-9"><a href="workflow-charpente.html#cb514-9"></a><span class="at">sendNotif</span>(<span class="st">'Hello'</span>)</span></code></pre></div>
<p>and will pass the validation step without any error:</p>
<div class="sourceCode" id="cb515"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/jstools/man/JSHint.html">jshint</a></span><span class="op">(</span>
  <span class="st">"const sendNotif = (message, type, duration) =&gt; {
  Shiny.notification.show({
    html: `&lt;strong&gt;${message}&lt;/strong&gt;`,
    type: type,
    duration: duration
  });
  };
  sendNotif('Hello');
  "</span>,
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/jstools/man/JSHint.html">jshint_options</a></span><span class="op">(</span>
    esversion <span class="op">=</span> <span class="fl">6</span>,
    jquery <span class="op">=</span> <span class="cn">TRUE</span>, 
    globals <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Shiny"</span>, <span class="st">"app"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## $functions
##      name                   param line character last lastcharacter
## 1 (empty) message, type, duration    1        27    7             4
##   metrics.complexity metrics.parameters metrics.statements
## 1                  1                  3                  1
## 
## $options
## $options$unstable
## named list()
## 
## $options$undef
## [1] TRUE
## 
## $options$unused
## [1] "vars"
## 
## $options$browser
## [1] TRUE
## 
## $options$jquery
## [1] TRUE
## 
## $options$devel
## [1] FALSE
## 
## $options$esversion
## [1] 6
## 
## $options$globals
## [1] "Shiny" "app"  
## 
## $options$indent
## [1] 4
## 
## $options$maxerr
## [1] 50
## 
## 
## $globals
## [1] "Shiny"
## 
## $member
## $member$notification
## [1] 1
## 
## $member$show
## [1] 1
## 
## $member$html
## [1] 1
## 
## $member$type
## [1] 1
## 
## $member$duration
## [1] 1
## 
## 
## attr(,"class")
## [1] "list"   "jshint"</code></pre>
<p>Yet the code won’t work since <code>Shiny.notification</code> does not exist.</p>
</div>
<div id="beautify-js-code" class="section level3">
<h3>
<span class="header-section-number">22.4.2</span> Beautify JS code<a class="anchor" aria-label="anchor" href="#beautify-js-code"><i class="fas fa-link"></i></a>
</h3>
<p>If you work with the RStudio IDE, your JS code maybe sometimes messy with bad indentation.
<a href="https://github.com/dreamRs/jstools">jstools</a> also provides a function and addin to fix the problem. <code><a href="https://rdrr.io/pkg/jstools/man/prettier.html">prettier_js(code)</a></code> and
<code><a href="https://rdrr.io/pkg/jstools/man/prettier.html">prettier_file(input = "path/to/file.js", output = "path/to/reformated.js")</a></code> does this.
I often use the <code>Prettier</code> addin which is way faster than typing the function call (Figure <a href="workflow-charpente.html#fig:workflow-pretty-js">22.4</a>).</p>
<div class="figure" style="text-align: center">
<span id="fig:workflow-pretty-js"></span>
<img src="images/workflow/pretty-js.png" alt="Better JS formatting" width="50%"><p class="caption">
FIGURE 22.4: Better JS formatting
</p>
</div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="custom-templates-interactivity.html"><span class="header-section-number">21</span> Adding more interactivity</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#workflow-charpente"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li><a class="nav-link" href="#motivations-1"><span class="header-section-number">22.1</span> Motivations</a></li>
<li><a class="nav-link" href="#general-idea"><span class="header-section-number">22.2</span> General idea</a></li>
<li>
<a class="nav-link" href="#a-case-study-shinybulma"><span class="header-section-number">22.3</span> A case study: {shinybulma}</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#build-the-html-dependency"><span class="header-section-number">22.3.1</span> Build the HTML dependency</a></li>
<li><a class="nav-link" href="#set-up-the-minimal-page-template"><span class="header-section-number">22.3.2</span> Set up the minimal page template</a></li>
<li><a class="nav-link" href="#exercise-add-bulmajs"><span class="header-section-number">22.3.3</span> Exercise: add bulmaJS</a></li>
<li><a class="nav-link" href="#add-custom-js"><span class="header-section-number">22.3.4</span> Add custom JS</a></li>
<li><a class="nav-link" href="#add-custom-inputoutput-bindings"><span class="header-section-number">22.3.5</span> Add custom input/output bindings</a></li>
<li><a class="nav-link" href="#organize-your-js-code"><span class="header-section-number">22.3.6</span> Organize your JS code</a></li>
<li><a class="nav-link" href="#combine-multiple-dependencies"><span class="header-section-number">22.3.7</span> Combine multiple dependencies</a></li>
<li><a class="nav-link" href="#other-charpente-helpers"><span class="header-section-number">22.3.8</span> Other {charpente} helpers</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#other-tips"><span class="header-section-number">22.4</span> Other tips</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#validate-javascript"><span class="header-section-number">22.4.1</span> Validate JavaScript</a></li>
<li><a class="nav-link" href="#beautify-js-code"><span class="header-section-number">22.4.2</span> Beautify JS code</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/workflow-charpente.Rmd">View source</a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/workflow-charpente.Rmd">Edit this page</a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It waslast built on 2020-12-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This website is produced by the <a class="text-light" href="https://bookdown.org">bookdown</a> bs4_book template.</p>
  </div>

</div></div>
</footer>
</body>
</html>
