<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Shiny, under the hood | Outstanding User Interfaces with Shiny</title>
  <meta name="description" content="This book will serve as content for the 2020 erum workshop." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Shiny, under the hood | Outstanding User Interfaces with Shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will serve as content for the 2020 erum workshop." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Shiny, under the hood | Outstanding User Interfaces with Shiny" />
  
  <meta name="twitter:description" content="This book will serve as content for the 2020 erum workshop." />
  

<meta name="author" content="David Granjon" />


<meta name="date" content="2020-05-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="survival-kit-javascript.html"/>
<link rel="next" href="htmltools-overview.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Outstanding User Interfaces with Shiny</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#is-this-book-for-me"><i class="fa fa-check"></i>Is this book for me?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#related-content"><i class="fa fa-check"></i>Related content</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>Survival Kit</b></span></li>
<li class="chapter" data-level="2" data-path="survival-kit-html.html"><a href="survival-kit-html.html"><i class="fa fa-check"></i><b>2</b> HTML</a><ul>
<li class="chapter" data-level="2.1" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-basics"><i class="fa fa-check"></i><b>2.1</b> HTML Basics</a></li>
<li class="chapter" data-level="2.2" data-path="survival-kit-html.html"><a href="survival-kit-html.html#tag-attributes"><i class="fa fa-check"></i><b>2.2</b> Tag attributes</a></li>
<li class="chapter" data-level="2.3" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-page-skeleton"><i class="fa fa-check"></i><b>2.3</b> HTML page: skeleton</a></li>
<li class="chapter" data-level="2.4" data-path="survival-kit-html.html"><a href="survival-kit-html.html#about-the-dom"><i class="fa fa-check"></i><b>2.4</b> About the DOM</a><ul>
<li class="chapter" data-level="2.4.1" data-path="survival-kit-html.html"><a href="survival-kit-html.html#visualizing-the-dom-the-html-inspector"><i class="fa fa-check"></i><b>2.4.1</b> Visualizing the DOM: the HTML inspector</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="survival-kit-html.html"><a href="survival-kit-html.html#preliminary-introduction-to-css-and-javascript"><i class="fa fa-check"></i><b>2.5</b> Preliminary introduction to CSS and JavaScript</a><ul>
<li class="chapter" data-level="2.5.1" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-and-css"><i class="fa fa-check"></i><b>2.5.1</b> HTML and CSS</a></li>
<li class="chapter" data-level="2.5.2" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-and-javascript"><i class="fa fa-check"></i><b>2.5.2</b> HTML and JavaScript</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html"><i class="fa fa-check"></i><b>3</b> JavaScript</a><ul>
<li class="chapter" data-level="3.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#setup"><i class="fa fa-check"></i><b>3.2</b> Setup</a><ul>
<li class="chapter" data-level="3.2.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#node"><i class="fa fa-check"></i><b>3.2.1</b> Node</a></li>
<li class="chapter" data-level="3.2.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#choose-a-good-ide"><i class="fa fa-check"></i><b>3.2.2</b> Choose a good IDE</a></li>
<li class="chapter" data-level="3.2.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#first-script"><i class="fa fa-check"></i><b>3.2.3</b> First Script</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#programming-with-js-basis"><i class="fa fa-check"></i><b>3.3</b> Programming with JS: basis</a><ul>
<li class="chapter" data-level="3.3.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#js-types"><i class="fa fa-check"></i><b>3.3.1</b> JS types</a></li>
<li class="chapter" data-level="3.3.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#variables"><i class="fa fa-check"></i><b>3.3.2</b> Variables</a></li>
<li class="chapter" data-level="3.3.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#conditions"><i class="fa fa-check"></i><b>3.3.3</b> Conditions</a></li>
<li class="chapter" data-level="3.3.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#iterations"><i class="fa fa-check"></i><b>3.3.4</b> Iterations</a></li>
<li class="chapter" data-level="3.3.5" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#objects"><i class="fa fa-check"></i><b>3.3.5</b> Objects</a></li>
<li class="chapter" data-level="3.3.6" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#functions"><i class="fa fa-check"></i><b>3.3.6</b> Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#jquery"><i class="fa fa-check"></i><b>3.4</b> jQuery</a></li>
<li class="chapter" data-level="3.5" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#event-listeners"><i class="fa fa-check"></i><b>3.5</b> Event listeners</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html"><i class="fa fa-check"></i><b>4</b> Shiny, under the hood</a><ul>
<li class="chapter" data-level="4.1" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#shiny-dependencies"><i class="fa fa-check"></i><b>4.1</b> Shiny dependencies</a></li>
<li class="chapter" data-level="4.2" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#shiny-hiddens-gems"><i class="fa fa-check"></i><b>4.2</b> Shiny hiddens gems</a><ul>
<li class="chapter" data-level="4.2.1" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#initialization"><i class="fa fa-check"></i><b>4.2.1</b> Initialization</a></li>
<li class="chapter" data-level="4.2.2" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#input-bindings"><i class="fa fa-check"></i><b>4.2.2</b> Input bindings</a></li>
<li class="chapter" data-level="4.2.3" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#custom-handlers"><i class="fa fa-check"></i><b>4.2.3</b> Custom handlers</a></li>
<li class="chapter" data-level="4.2.4" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#utilities-to-quickly-define-new-inputs"><i class="fa fa-check"></i><b>4.2.4</b> Utilities to quickly define new inputs</a></li>
<li class="chapter" data-level="4.2.5" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#get-access-to-initial-values"><i class="fa fa-check"></i><b>4.2.5</b> Get access to initial values</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>htmltools</b></span></li>
<li class="chapter" data-level="5" data-path="htmltools-overview.html"><a href="htmltools-overview.html"><i class="fa fa-check"></i><b>5</b> htmltools overview</a><ul>
<li class="chapter" data-level="5.1" data-path="htmltools-overview.html"><a href="htmltools-overview.html#html-tags"><i class="fa fa-check"></i><b>5.1</b> HTML Tags</a></li>
<li class="chapter" data-level="5.2" data-path="htmltools-overview.html"><a href="htmltools-overview.html#notations"><i class="fa fa-check"></i><b>5.2</b> Notations</a></li>
<li class="chapter" data-level="5.3" data-path="htmltools-overview.html"><a href="htmltools-overview.html#adding-new-tags"><i class="fa fa-check"></i><b>5.3</b> Adding new tags</a></li>
<li class="chapter" data-level="5.4" data-path="htmltools-overview.html"><a href="htmltools-overview.html#alternative-way-to-write-tags"><i class="fa fa-check"></i><b>5.4</b> Alternative way to write tags</a></li>
<li class="chapter" data-level="5.5" data-path="htmltools-overview.html"><a href="htmltools-overview.html#playing-with-tags"><i class="fa fa-check"></i><b>5.5</b> Playing with tags</a><ul>
<li class="chapter" data-level="5.5.1" data-path="htmltools-overview.html"><a href="htmltools-overview.html#tags-structure"><i class="fa fa-check"></i><b>5.5.1</b> Tags structure</a></li>
<li class="chapter" data-level="5.5.2" data-path="htmltools-overview.html"><a href="htmltools-overview.html#useful-functions-for-tags"><i class="fa fa-check"></i><b>5.5.2</b> Useful functions for tags</a></li>
<li class="chapter" data-level="5.5.3" data-path="htmltools-overview.html"><a href="htmltools-overview.html#other-interesting-functions"><i class="fa fa-check"></i><b>5.5.3</b> Other interesting functions</a></li>
<li class="chapter" data-level="5.5.4" data-path="htmltools-overview.html"><a href="htmltools-overview.html#conditionally-set-attributes"><i class="fa fa-check"></i><b>5.5.4</b> Conditionally set attributes</a></li>
<li class="chapter" data-level="5.5.5" data-path="htmltools-overview.html"><a href="htmltools-overview.html#using"><i class="fa fa-check"></i><b>5.5.5</b> Using %&gt;%</a></li>
<li class="chapter" data-level="5.5.6" data-path="htmltools-overview.html"><a href="htmltools-overview.html#programmatically-create-children-elements"><i class="fa fa-check"></i><b>5.5.6</b> Programmatically create children elements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html"><i class="fa fa-check"></i><b>6</b> Dependency utilities</a><ul>
<li class="chapter" data-level="6.1" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#the-dirty-approach"><i class="fa fa-check"></i><b>6.1</b> The dirty approach</a></li>
<li class="chapter" data-level="6.2" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#the-clean-approach"><i class="fa fa-check"></i><b>6.2</b> The clean approach</a></li>
<li class="chapter" data-level="6.3" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#another-example-importing-html-dependencies-from-other-packages"><i class="fa fa-check"></i><b>6.3</b> Another example: Importing HTML dependencies from other packages</a></li>
<li class="chapter" data-level="6.4" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#suppress-dependencies"><i class="fa fa-check"></i><b>6.4</b> Suppress dependencies</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="htmltools-other-tools.html"><a href="htmltools-other-tools.html"><i class="fa fa-check"></i><b>7</b> Other tools</a><ul>
<li class="chapter" data-level="7.1" data-path="htmltools-other-tools.html"><a href="htmltools-other-tools.html#css"><i class="fa fa-check"></i><b>7.1</b> CSS</a></li>
</ul></li>
<li class="part"><span><b>Practice</b></span></li>
<li class="chapter" data-level="8" data-path="custom-templates-selection.html"><a href="custom-templates-selection.html"><i class="fa fa-check"></i><b>8</b> Template selection</a></li>
<li class="chapter" data-level="9" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html"><i class="fa fa-check"></i><b>9</b> Define dependencies</a></li>
<li class="chapter" data-level="10" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html"><i class="fa fa-check"></i><b>10</b> Template skeleton</a></li>
<li class="chapter" data-level="11" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html"><i class="fa fa-check"></i><b>11</b> Develop custom input widgets</a><ul>
<li class="chapter" data-level="11.1" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#how-does-shiny-handle-inputs"><i class="fa fa-check"></i><b>11.1</b> How does Shiny handle inputs?</a></li>
<li class="chapter" data-level="11.2" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#how-to-add-new-input-to-shiny"><i class="fa fa-check"></i><b>11.2</b> How to add new input to Shiny?</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html"><i class="fa fa-check"></i><b>12</b> Testing templates elements</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Outstanding User Interfaces with Shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="survival-kit-shiny" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Shiny, under the hood</h1>
<p>In the 2 previous chapters, we quickly introduced HTML and JavaScript. Chapter 1 finished on an example showing how to modify an HTML page with JavaScript. Yet, in Chapter 2, we simply introduced the language without showing any link with HTML.
In this chapter we are going to see what shiny has under the hood to better understand the link between those languages. We will particularly accord a great importance to jQuery.</p>
<div id="shiny-dependencies" class="section level2">
<h2><span class="header-section-number">4.1</span> Shiny dependencies</h2>
<p>This books assumes you are already quite advanded in Shiny. Below we will investigate elements that you probably never noticed.</p>
<p>Shiny allows to develop web applications by only using R. If you remember about the first experiment of Chapter <a href="survival-kit-html.html#survival-kit-html">2</a>, we only did</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="kw">p</span>(<span class="st">&quot;Hello World&quot;</span>)</a></code></pre></div>
<p>Hello World</p>
<p>to notice that the <code>p</code> function generates HTML. We will see in the next chapters other tools to build/modify/delete tags. The main difference between HTML tags and Shiny tags is the absence of closing tag for Shiny. For instance, in raw HTML, we expect <code>&lt;p&gt;</code> to be closed by <code>&lt;/p&gt;</code>. In Shiny, we only call <code>p(...)</code>, where <code>...</code> may be attributes like class/id or children tags. However, this is still a bit far from web application since there is no user interface, interactivity and computations. The simplest Shiny layout is the <code>fluidPage</code> (if you type shinyapp in the R console, it will show a predefined snippet with this default template):</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">  <span class="kw">p</span>(<span class="st">&quot;Hello World&quot;</span>)</a>
<a class="sourceLine" id="cb35-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb35-4" data-line-number="4"></a>
<a class="sourceLine" id="cb35-5" data-line-number="5">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {}</a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>At first glance, the page only contains the Hello World text. Waiiit … are you sure about this? Let’s run the above example and open the HTML inspector. Results are displayed on Figure <a href="survival-kit-shiny.html#fig:shiny-deps">4.1</a>. In Chapter <a href="htmltools-dependencies.html#htmltools-dependencies">6</a> we will see better tools to extract HTML dependencies.</p>
<div class="figure"><span id="fig:shiny-deps"></span>
<img src="images/survival-kit/shiny-deps.png" alt="Shiny dependencies" width="537" />
<p class="caption">
Figure 4.1: Shiny dependencies
</p>
</div>
<p>We see in the head section that Shiny has 4 dependencies:</p>
<ul>
<li>json2</li>
<li>jQuery 3.4.1</li>
<li>shiny (custom JavaScript and CSS)</li>
<li>Bootstrap 3.4.1 (JavaScript and CSS) + other files (html5shiv, respond)</li>
</ul>
<p><a href="https://getbootstrap.com">Bootstrap</a> is here to provide plug and play design and interactions (tabs, navs). For instance the <code>fluidRow</code> and <code>column</code> functions of Shiny leverage the Bootstrap grid to control how elements are displayed in a page. This is convenient because it avoids to write a crazy amount of CSS/JavaScript and always reinvent the wheel. <a href="https://jquery.com">jQuery</a> is a famous JavaScript library providing a user friendly interface to manipulate the DOM and is present in almost all actual websites. It is slighly easier (understand more convenient tu use) than vanilla JS, even though web developers tend to avoid it to go back to vanilla JS (Bootstrap 5, the next iteration of Bootstrap will not rely on jQuery anymore). Shiny has its own JS and CSS files (we will discuss this very soon). Finally, json2 is a library to handle the <a href="https://www.json.org/json-en.html">JSON</a> data format (JavaScript Object Notation). In the following chapters we will use it a lot, through the jsonlite package that allows to transform JSON objects in R objects and inversely.</p>
<p>In summary, all those libraries are necessary to make Shiny what it is! Customizing Shiny will imply to alter those existing libraries (except the Shiny core JavaScript and json2).</p>
</div>
<div id="shiny-hiddens-gems" class="section level2">
<h2><span class="header-section-number">4.2</span> Shiny hiddens gems</h2>
<p>As promised earlier, let’s talk about the <a href="https://github.com/rstudio/shiny/blob/master/srcjs/init_shiny.js">Shiny JavaScript core</a>. The goal of this part is to better understand the mechanisms behind Shiny, especially the input system.</p>
<div id="initialization" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Initialization</h3>
<p>Upon initialization, Shiny runs several JavaScript functions. Not surprisingly, there is one called <a href="https://github.com/rstudio/shiny/blob/master/srcjs/init_shiny.js"><code>initShiny</code></a> containing a subtantial amount of elements.</p>
<p>We find utils functions like <code>bindOutputs</code>, <code>unbindOutputs</code> to respectively bind/unbind outputs, <code>bindInputs</code> and <code>unbindInputs</code> for inputs. Only <code>bindAll</code> and <code>unbindAll</code> are available to the user (see a usecase <a href="https://stackoverflow.com/questions/51633326/dateinput-not-working-on-dt-in-shiny">here</a>). To illustrate what they do, let’s run the app below.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">  <span class="kw">sliderInput</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>,</a>
<a class="sourceLine" id="cb36-3" data-line-number="3">    <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1000</span>, <span class="dt">value =</span> <span class="dv">500</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4">  ),</a>
<a class="sourceLine" id="cb36-5" data-line-number="5">  <span class="kw">plotOutput</span>(<span class="st">&quot;distPlot&quot;</span>)</a>
<a class="sourceLine" id="cb36-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb36-7" data-line-number="7"></a>
<a class="sourceLine" id="cb36-8" data-line-number="8">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb36-9" data-line-number="9">  output<span class="op">$</span>distPlot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</a>
<a class="sourceLine" id="cb36-10" data-line-number="10">    <span class="kw">hist</span>(<span class="kw">rnorm</span>(input<span class="op">$</span>obs))</a>
<a class="sourceLine" id="cb36-11" data-line-number="11">  })</a>
<a class="sourceLine" id="cb36-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb36-13" data-line-number="13"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>We then open the HTML inspector and run <code>Shiny.unbindAll(document)</code> (document is the scope, that is where to search). Try to change the slider input. What do you observe? Now let’s type <code>Shiny.bindAll(document)</code> and update the slider value. What happens? Magic isn’t it? This simply shows that when inputs are not bound, nothing happens so binding inputs is necessary. Let’s see below how an input binding works.</p>
</div>
<div id="input-bindings" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Input bindings</h3>
<p>The input binding is defined by a class living in the <code>input_binding.js</code> <a href="https://github.com/rstudio/shiny/blob/master/srcjs/input_binding.js">file</a>.
An input binding allows Shiny to identify each instance of a given input and what you can do with this input. The interesting thing is that if your app contains 10 different sliders, they all share the same input binding! An input binding is an object having the following methods:</p>
<ul>
<li>find(scope): this method specifies how to find the current input element (el) in the DOM. scope refers to the <code>document</code> element. In general, we use jQuery selector to search for a class.</li>
<li>initialize(el): This is called before the input is bound but not all input need to be initalized. Some API like <a href="https://framework7.io">Framework7</a> require to almost always have an initialize method (We will see later).</li>
<li>getValue(el): returns the input value. The way to obtain the value tighly depends on the object and is different for almost all inputs.</li>
<li>setValue(el, value): This method is used to set the value of the current input.</li>
<li>receiveMessage(el, data): This method is the JavaScript part of all the <code>updateInput</code> functions. We usually call the setValue method inside.</li>
<li>subscribe(el, callback): We listen to events telling under which circumstances to change the input value. Some API like Bootstrap explicitly mention those events (like <code>hide.bs.tab</code>, <code>shown.bs.tab</code>, …).</li>
<li>getRatePolicy: when callback is true in the subscribe method, we apply a specific rate policy (<a href="https://davidwalsh.name/javascript-debounce-function">debounce</a>, throttle). This is useful for instance when we don’t want to flood the server with useless update requests. For a slider, we only want to send the value as soon as the range stops moving and not all intermediate values. Those elements are defined <a href="https://github.com/rstudio/shiny/blob/master/srcjs/input_rate.js">here</a>.</li>
</ul>
<p>At the end of the input binding definition, we register it for Shiny.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">let</span> myBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">inputBinding</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="va">$</span>.<span class="at">extend</span>(myBinding<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3">  <span class="co">// methods go here</span></a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb37-5" data-line-number="5"></a>
<a class="sourceLine" id="cb37-6" data-line-number="6"><span class="va">Shiny</span>.<span class="va">inputBindings</span>.<span class="at">register</span>(myBinding<span class="op">,</span> <span class="st">&#39;reference&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Even thought the Shiny <a href="https://shiny.rstudio.com/articles/building-inputs.html">documentation</a> mentions a <code>Shiny.inputBindings.setPriority</code> method to handle conflicting binding, it is better not to use it.</p>
<p>Upon initialization, Shiny calls the <code>initializeInputs</code> function that takes all input bindings and call their initialize method before binding all inputs. Note that once an input has been initialized it has a <code>_shiny_initialized</code> tag to avoid initializing it twice. As shown above, the initialize method is not always defined.</p>
<p>TO DO: picture to add visual representation of an input binding</p>
</div>
<div id="custom-handlers" class="section level3">
<h3><span class="header-section-number">4.2.3</span> Custom handlers</h3>
<p>These are dedicated to send messages from R to JavaScript.</p>
<p>TO DO: picture showing the communication</p>
</div>
<div id="utilities-to-quickly-define-new-inputs" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Utilities to quickly define new inputs</h3>
<p>If you ever wondered where the <code>Shiny.onInputChange</code> or <code>Shiny.setInputValue</code> comes from (see <a href="https://shiny.rstudio.com/articles/communicating-with-js.html">article</a>), it is actually defined in the <code>initShiny</code> function.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="va">exports</span>.<span class="at">setInputValue</span> <span class="op">=</span> <span class="va">exports</span>.<span class="at">onInputChange</span> <span class="op">=</span> <span class="kw">function</span>(name<span class="op">,</span> value<span class="op">,</span> opts) <span class="op">{</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2">  opts <span class="op">=</span> <span class="at">addDefaultInputOpts</span>(opts)<span class="op">;</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3">  <span class="va">inputs</span>.<span class="at">setInput</span>(name<span class="op">,</span> value<span class="op">,</span> opts)<span class="op">;</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="op">};</span></a></code></pre></div>
<p>Briefly, this function avoids to create an input binding. It is faster to code but there is a price to pay: you lose the possibility to easily update the new input. Indeed, all input functions like <code>sliderInput</code> have their own update function like <code>updateSliderInput</code>, because of the custom input binding system (We will see it very soon)!</p>
</div>
<div id="get-access-to-initial-values" class="section level3">
<h3><span class="header-section-number">4.2.5</span> Get access to initial values</h3>
<p>Something we may notice when exploring the <code>initShiny</code> function is the existence of a shinyapp object, defined as follows:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">var</span> shinyapp <span class="op">=</span> <span class="va">exports</span>.<span class="at">shinyapp</span> <span class="op">=</span> <span class="kw">new</span> <span class="at">ShinyApp</span>()<span class="op">;</span></a></code></pre></div>
<p>Let’s explore what ShinyApp contains. The definition is located in the shinyapps.js <a href="https://github.com/rstudio/shiny/blob/master/srcjs/shinyapp.js">script</a>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">var</span> ShinyApp <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2">  <span class="kw">this</span>.<span class="at">$socket</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"></a>
<a class="sourceLine" id="cb40-4" data-line-number="4">  <span class="co">// Cached input values</span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5">  <span class="kw">this</span>.<span class="at">$inputValues</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb40-6" data-line-number="6"></a>
<a class="sourceLine" id="cb40-7" data-line-number="7">  <span class="co">// Input values at initialization (and reconnect)</span></a>
<a class="sourceLine" id="cb40-8" data-line-number="8">  <span class="kw">this</span>.<span class="at">$initialInput</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb40-9" data-line-number="9"></a>
<a class="sourceLine" id="cb40-10" data-line-number="10">  <span class="co">// Output bindings</span></a>
<a class="sourceLine" id="cb40-11" data-line-number="11">  <span class="kw">this</span>.<span class="at">$bindings</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb40-12" data-line-number="12"></a>
<a class="sourceLine" id="cb40-13" data-line-number="13">  <span class="co">// Cached values/errors</span></a>
<a class="sourceLine" id="cb40-14" data-line-number="14">  <span class="kw">this</span>.<span class="at">$values</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb40-15" data-line-number="15">  <span class="kw">this</span>.<span class="at">$errors</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb40-16" data-line-number="16"></a>
<a class="sourceLine" id="cb40-17" data-line-number="17">  <span class="co">// Conditional bindings (show/hide element based on expression)</span></a>
<a class="sourceLine" id="cb40-18" data-line-number="18">  <span class="kw">this</span>.<span class="at">$conditionals</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb40-19" data-line-number="19"></a>
<a class="sourceLine" id="cb40-20" data-line-number="20">  <span class="kw">this</span>.<span class="at">$pendingMessages</span> <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb40-21" data-line-number="21">  <span class="kw">this</span>.<span class="at">$activeRequests</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb40-22" data-line-number="22">  <span class="kw">this</span>.<span class="at">$nextRequestId</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb40-23" data-line-number="23"></a>
<a class="sourceLine" id="cb40-24" data-line-number="24">  <span class="kw">this</span>.<span class="at">$allowReconnect</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb40-25" data-line-number="25"><span class="op">};</span></a></code></pre></div>
<p>It creates several properties, some of them are easy to guess like <code>inputValues</code> or <code>initialInput</code>. Let’s run the example below and open the HTML inspector. Notice that the <code>sliderInput</code> is set to 500 at <code>t0</code> (initialization).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">  <span class="kw">sliderInput</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>,</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">    <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1000</span>, <span class="dt">value =</span> <span class="dv">500</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4">  ),</a>
<a class="sourceLine" id="cb41-5" data-line-number="5">  <span class="kw">plotOutput</span>(<span class="st">&quot;distPlot&quot;</span>)</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb41-7" data-line-number="7"></a>
<a class="sourceLine" id="cb41-8" data-line-number="8">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb41-9" data-line-number="9">  output<span class="op">$</span>distPlot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</a>
<a class="sourceLine" id="cb41-10" data-line-number="10">    <span class="kw">hist</span>(<span class="kw">rnorm</span>(input<span class="op">$</span>obs))</a>
<a class="sourceLine" id="cb41-11" data-line-number="11">  })</a>
<a class="sourceLine" id="cb41-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb41-13" data-line-number="13"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>Figure <a href="survival-kit-shiny.html#fig:shiny-initial-inputs">4.2</a> shows how to access Shiny’s initial input value with <code>Shiny.shinyapp.$initialInput.obs</code>. After changing the slider position, its value is given by <code>Shiny.shinyapp.$inputValues.obs</code>. <code>$initialInput</code> and <code>$inputValues</code> contains way more elements but we are only interested by the slider in this example.</p>
<div class="figure"><span id="fig:shiny-initial-inputs"></span>
<img src="images/survival-kit/shiny-init-input.png" alt="Explore initial input values" width="994" />
<p class="caption">
Figure 4.2: Explore initial input values
</p>
</div>
<p>I acknowledge, the practical interest might be limited but still good to know for debugging purposes.</p>

</div>
</div>
</div>




</div>
            </section>

          </div>
        </div>
      </div>
<a href="survival-kit-javascript.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="htmltools-overview.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/survival-kit-shiny.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["outstanding-shiny-ui.pdf", "outstanding-shiny-ui.epub", "outstanding-shiny-ui.mobi"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
