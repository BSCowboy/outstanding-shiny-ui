<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Shiny: What’s under the Hood? | Outstanding User Interfaces with Shiny</title>
  <meta name="description" content="This book will serve as content for the 2020 erum workshop." />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Shiny: What’s under the Hood? | Outstanding User Interfaces with Shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book will serve as content for the 2020 erum workshop." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Shiny: What’s under the Hood? | Outstanding User Interfaces with Shiny" />
  
  <meta name="twitter:description" content="This book will serve as content for the 2020 erum workshop." />
  

<meta name="author" content="David Granjon" />


<meta name="date" content="2020-05-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="survival-kit-javascript.html"/>
<link rel="next" href="htmltools-overview.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Outstanding User Interfaces with Shiny</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#is-this-book-for-me"><i class="fa fa-check"></i>Is this book for me?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#related-content"><i class="fa fa-check"></i>Related content</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>Survival Kit</b></span></li>
<li class="chapter" data-level="2" data-path="survival-kit-html.html"><a href="survival-kit-html.html"><i class="fa fa-check"></i><b>2</b> HTML</a><ul>
<li class="chapter" data-level="2.1" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-basics"><i class="fa fa-check"></i><b>2.1</b> HTML Basics</a></li>
<li class="chapter" data-level="2.2" data-path="survival-kit-html.html"><a href="survival-kit-html.html#tag-attributes"><i class="fa fa-check"></i><b>2.2</b> Tag attributes</a></li>
<li class="chapter" data-level="2.3" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-page-skeleton"><i class="fa fa-check"></i><b>2.3</b> HTML page: skeleton</a></li>
<li class="chapter" data-level="2.4" data-path="survival-kit-html.html"><a href="survival-kit-html.html#about-the-document-object-model-dom"><i class="fa fa-check"></i><b>2.4</b> About the Document Object Model (DOM)</a><ul>
<li class="chapter" data-level="2.4.1" data-path="survival-kit-html.html"><a href="survival-kit-html.html#visualizing-the-dom-the-html-inspector"><i class="fa fa-check"></i><b>2.4.1</b> Visualizing the DOM: the HTML inspector</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="survival-kit-html.html"><a href="survival-kit-html.html#preliminary-introduction-to-css-and-javascript"><i class="fa fa-check"></i><b>2.5</b> Preliminary introduction to CSS and JavaScript</a><ul>
<li class="chapter" data-level="2.5.1" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-and-css"><i class="fa fa-check"></i><b>2.5.1</b> HTML and CSS</a></li>
<li class="chapter" data-level="2.5.2" data-path="survival-kit-html.html"><a href="survival-kit-html.html#html-and-javascript"><i class="fa fa-check"></i><b>2.5.2</b> HTML and JavaScript</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html"><i class="fa fa-check"></i><b>3</b> JavaScript</a><ul>
<li class="chapter" data-level="3.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#setup"><i class="fa fa-check"></i><b>3.2</b> Setup</a><ul>
<li class="chapter" data-level="3.2.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#node"><i class="fa fa-check"></i><b>3.2.1</b> Node</a></li>
<li class="chapter" data-level="3.2.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#choose-a-good-ide"><i class="fa fa-check"></i><b>3.2.2</b> Choose a good IDE</a></li>
<li class="chapter" data-level="3.2.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#first-script"><i class="fa fa-check"></i><b>3.2.3</b> First Script</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#programming-with-js-basis"><i class="fa fa-check"></i><b>3.3</b> Programming with JS: basis</a><ul>
<li class="chapter" data-level="3.3.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#js-types"><i class="fa fa-check"></i><b>3.3.1</b> JS types</a></li>
<li class="chapter" data-level="3.3.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#variables"><i class="fa fa-check"></i><b>3.3.2</b> Variables</a></li>
<li class="chapter" data-level="3.3.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#conditions"><i class="fa fa-check"></i><b>3.3.3</b> Conditions</a></li>
<li class="chapter" data-level="3.3.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#objects"><i class="fa fa-check"></i><b>3.3.4</b> Objects</a></li>
<li class="chapter" data-level="3.3.5" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#iterations"><i class="fa fa-check"></i><b>3.3.5</b> Iterations</a></li>
<li class="chapter" data-level="3.3.6" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#functions"><i class="fa fa-check"></i><b>3.3.6</b> Functions</a></li>
<li class="chapter" data-level="3.3.7" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#event-listeners"><i class="fa fa-check"></i><b>3.3.7</b> Event listeners</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#jquery"><i class="fa fa-check"></i><b>3.4</b> jQuery</a><ul>
<li class="chapter" data-level="3.4.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#introduction-1"><i class="fa fa-check"></i><b>3.4.1</b> Introduction</a></li>
<li class="chapter" data-level="3.4.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#syntax"><i class="fa fa-check"></i><b>3.4.2</b> Syntax</a></li>
<li class="chapter" data-level="3.4.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#useful-functions"><i class="fa fa-check"></i><b>3.4.3</b> Useful functions</a></li>
<li class="chapter" data-level="3.4.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#chaining-jquery-methods"><i class="fa fa-check"></i><b>3.4.4</b> Chaining jQuery methods</a></li>
<li class="chapter" data-level="3.4.5" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#iterations-1"><i class="fa fa-check"></i><b>3.4.5</b> Iterations</a></li>
<li class="chapter" data-level="3.4.6" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#good-practice"><i class="fa fa-check"></i><b>3.4.6</b> Good practice</a></li>
<li class="chapter" data-level="3.4.7" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#events"><i class="fa fa-check"></i><b>3.4.7</b> Events</a></li>
<li class="chapter" data-level="3.4.8" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#extending-objects"><i class="fa fa-check"></i><b>3.4.8</b> Extending objects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html"><i class="fa fa-check"></i><b>4</b> Shiny: What’s under the Hood?</a><ul>
<li class="chapter" data-level="4.1" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#shiny-html-css-and-javascript"><i class="fa fa-check"></i><b>4.1</b> Shiny, HTML, CSS and JavaScript</a></li>
<li class="chapter" data-level="4.2" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#discover-shiny-dependencies"><i class="fa fa-check"></i><b>4.2</b> Discover Shiny dependencies</a></li>
<li class="chapter" data-level="4.3" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#websocket-rjs-bidirectional-communication"><i class="fa fa-check"></i><b>4.3</b> Websocket: R/JS bidirectional communication</a></li>
<li class="chapter" data-level="4.4" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#shinys-input-system"><i class="fa fa-check"></i><b>4.4</b> Shiny’s input system</a><ul>
<li class="chapter" data-level="4.4.1" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#shiny-javascript-sources"><i class="fa fa-check"></i><b>4.4.1</b> Shiny JavaScript sources</a></li>
<li class="chapter" data-level="4.4.2" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#the-shiny-javascript-object"><i class="fa fa-check"></i><b>4.4.2</b> The Shiny JavaScript object</a></li>
<li class="chapter" data-level="4.4.3" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#initialization"><i class="fa fa-check"></i><b>4.4.3</b> Initialization</a></li>
<li class="chapter" data-level="4.4.4" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#input-bindings"><i class="fa fa-check"></i><b>4.4.4</b> Input bindings</a></li>
<li class="chapter" data-level="4.4.5" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#utilities-to-quickly-define-new-inputs"><i class="fa fa-check"></i><b>4.4.5</b> Utilities to quickly define new inputs</a></li>
<li class="chapter" data-level="4.4.6" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#miscellaneous"><i class="fa fa-check"></i><b>4.4.6</b> Miscellaneous</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="survival-kit-shiny.html"><a href="survival-kit-shiny.html#custom-handlers-from-r-to-javascript"><i class="fa fa-check"></i><b>4.5</b> Custom handlers: from R to JavaScript</a></li>
</ul></li>
<li class="part"><span><b>htmltools</b></span></li>
<li class="chapter" data-level="5" data-path="htmltools-overview.html"><a href="htmltools-overview.html"><i class="fa fa-check"></i><b>5</b> htmltools overview</a><ul>
<li class="chapter" data-level="5.1" data-path="htmltools-overview.html"><a href="htmltools-overview.html#html-tags"><i class="fa fa-check"></i><b>5.1</b> HTML Tags</a></li>
<li class="chapter" data-level="5.2" data-path="htmltools-overview.html"><a href="htmltools-overview.html#notations"><i class="fa fa-check"></i><b>5.2</b> Notations</a></li>
<li class="chapter" data-level="5.3" data-path="htmltools-overview.html"><a href="htmltools-overview.html#adding-new-tags"><i class="fa fa-check"></i><b>5.3</b> Adding new tags</a></li>
<li class="chapter" data-level="5.4" data-path="htmltools-overview.html"><a href="htmltools-overview.html#alternative-way-to-write-tags"><i class="fa fa-check"></i><b>5.4</b> Alternative way to write tags</a></li>
<li class="chapter" data-level="5.5" data-path="htmltools-overview.html"><a href="htmltools-overview.html#playing-with-tags"><i class="fa fa-check"></i><b>5.5</b> Playing with tags</a><ul>
<li class="chapter" data-level="5.5.1" data-path="htmltools-overview.html"><a href="htmltools-overview.html#tags-structure"><i class="fa fa-check"></i><b>5.5.1</b> Tags structure</a></li>
<li class="chapter" data-level="5.5.2" data-path="htmltools-overview.html"><a href="htmltools-overview.html#useful-functions-for-tags"><i class="fa fa-check"></i><b>5.5.2</b> Useful functions for tags</a></li>
<li class="chapter" data-level="5.5.3" data-path="htmltools-overview.html"><a href="htmltools-overview.html#other-interesting-functions"><i class="fa fa-check"></i><b>5.5.3</b> Other interesting functions</a></li>
<li class="chapter" data-level="5.5.4" data-path="htmltools-overview.html"><a href="htmltools-overview.html#conditionally-set-attributes"><i class="fa fa-check"></i><b>5.5.4</b> Conditionally set attributes</a></li>
<li class="chapter" data-level="5.5.5" data-path="htmltools-overview.html"><a href="htmltools-overview.html#using"><i class="fa fa-check"></i><b>5.5.5</b> Using %&gt;%</a></li>
<li class="chapter" data-level="5.5.6" data-path="htmltools-overview.html"><a href="htmltools-overview.html#programmatically-create-children-elements"><i class="fa fa-check"></i><b>5.5.6</b> Programmatically create children elements</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html"><i class="fa fa-check"></i><b>6</b> Dependency utilities</a><ul>
<li class="chapter" data-level="6.1" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#the-dirty-approach"><i class="fa fa-check"></i><b>6.1</b> The dirty approach</a></li>
<li class="chapter" data-level="6.2" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#the-clean-approach"><i class="fa fa-check"></i><b>6.2</b> The clean approach</a></li>
<li class="chapter" data-level="6.3" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#another-example-importing-html-dependencies-from-other-packages"><i class="fa fa-check"></i><b>6.3</b> Another example: Importing HTML dependencies from other packages</a></li>
<li class="chapter" data-level="6.4" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#suppress-dependencies"><i class="fa fa-check"></i><b>6.4</b> Suppress dependencies</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="htmltools-other-tools.html"><a href="htmltools-other-tools.html"><i class="fa fa-check"></i><b>7</b> Other tools</a><ul>
<li class="chapter" data-level="7.1" data-path="htmltools-other-tools.html"><a href="htmltools-other-tools.html#css"><i class="fa fa-check"></i><b>7.1</b> CSS</a></li>
</ul></li>
<li class="part"><span><b>Practice</b></span></li>
<li class="chapter" data-level="8" data-path="custom-templates-selection.html"><a href="custom-templates-selection.html"><i class="fa fa-check"></i><b>8</b> Template selection</a></li>
<li class="chapter" data-level="9" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html"><i class="fa fa-check"></i><b>9</b> Define dependencies</a><ul>
<li class="chapter" data-level="9.1" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html#discover-the-project"><i class="fa fa-check"></i><b>9.1</b> Discover the project</a></li>
<li class="chapter" data-level="9.2" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html#identify-mandatory-dependencies"><i class="fa fa-check"></i><b>9.2</b> Identify mandatory dependencies</a></li>
<li class="chapter" data-level="9.3" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html#bundle-dependencies"><i class="fa fa-check"></i><b>9.3</b> Bundle dependencies</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html"><i class="fa fa-check"></i><b>10</b> Template skeleton</a><ul>
<li class="chapter" data-level="10.1" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#identify-template-elements"><i class="fa fa-check"></i><b>10.1</b> Identify template elements</a></li>
<li class="chapter" data-level="10.2" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#design-the-page-layout"><i class="fa fa-check"></i><b>10.2</b> Design the page layout</a><ul>
<li class="chapter" data-level="10.2.1" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-page-wrapper"><i class="fa fa-check"></i><b>10.2.1</b> The page wrapper</a></li>
<li class="chapter" data-level="10.2.2" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-body-content"><i class="fa fa-check"></i><b>10.2.2</b> The body content</a></li>
<li class="chapter" data-level="10.2.3" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-footer"><i class="fa fa-check"></i><b>10.2.3</b> The footer</a></li>
<li class="chapter" data-level="10.2.4" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-navbar-or-header"><i class="fa fa-check"></i><b>10.2.4</b> The navbar (or header)</a></li>
<li class="chapter" data-level="10.2.5" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#card-containers"><i class="fa fa-check"></i><b>10.2.5</b> Card containers</a></li>
<li class="chapter" data-level="10.2.6" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#ribbons-card-components"><i class="fa fa-check"></i><b>10.2.6</b> Ribbons: card components</a></li>
<li class="chapter" data-level="10.2.7" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#icons"><i class="fa fa-check"></i><b>10.2.7</b> Icons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html"><i class="fa fa-check"></i><b>11</b> Develop custom input widgets</a><ul>
<li class="chapter" data-level="11.1" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#tabler-action-button"><i class="fa fa-check"></i><b>11.1</b> Tabler action button</a><ul>
<li class="chapter" data-level="11.1.1" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#reminders-about-the-action-button"><i class="fa fa-check"></i><b>11.1.1</b> Reminders about the action button</a></li>
<li class="chapter" data-level="11.1.2" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#application-to-tabler"><i class="fa fa-check"></i><b>11.1.2</b> Application to tabler</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#toggle-switch"><i class="fa fa-check"></i><b>11.2</b> Toggle Switch</a></li>
<li class="chapter" data-level="11.3" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#navbar-menu-input"><i class="fa fa-check"></i><b>11.3</b> Navbar menu input</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html"><i class="fa fa-check"></i><b>12</b> Adding more interactivity</a><ul>
<li class="chapter" data-level="12.1" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#custom-progress-bars"><i class="fa fa-check"></i><b>12.1</b> Custom progress bars</a></li>
<li class="chapter" data-level="12.2" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#tab-events"><i class="fa fa-check"></i><b>12.2</b> Tab events</a></li>
<li class="chapter" data-level="12.3" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#user-feedback-toasts"><i class="fa fa-check"></i><b>12.3</b> User feedback: toasts</a><ul>
<li class="chapter" data-level="12.3.1" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#toast-skeleton"><i class="fa fa-check"></i><b>12.3.1</b> Toast skeleton</a></li>
<li class="chapter" data-level="12.3.2" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#the-toast-api"><i class="fa fa-check"></i><b>12.3.2</b> The toast API</a></li>
<li class="chapter" data-level="12.3.3" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#r-implementation"><i class="fa fa-check"></i><b>12.3.3</b> R implementation</a></li>
<li class="chapter" data-level="12.3.4" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#wrap-up"><i class="fa fa-check"></i><b>12.3.4</b> Wrap up</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html"><i class="fa fa-check"></i><b>13</b> Testing templates elements</a></li>
<li class="part"><span><b>Beautify with CSS and SASS</b></span></li>
<li class="chapter" data-level="14" data-path="beautify-with-fresh.html"><a href="beautify-with-fresh.html"><i class="fa fa-check"></i><b>14</b> Beautify with fresh</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Outstanding User Interfaces with Shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="survival-kit-shiny" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Shiny: What’s under the Hood?</h1>
<p>In the 2 previous chapters, we quickly introduced HTML and JavaScript. In this chapter, we are going to see what Shiny has under the hood. Therefore, as mentionned in the book prerequisites, you should be quite familiar with Shiny if you want to get the most out of this chapter.</p>
<p>We will answer to the following questions:</p>
<ul>
<li>What web dependencies is Shiny based on?</li>
<li>How is R/JavaScript communication achieved?</li>
<li>How does Shiny deal with inputs?</li>
</ul>
<div id="shiny-html-css-and-javascript" class="section level2">
<h2><span class="header-section-number">4.1</span> Shiny, HTML, CSS and JavaScript</h2>
<p>Shiny allows to develop web applications with R in minutes. Let’s face it: this is quite mind blowing! Well, this won’t probably be a production app but still a working prototype. Believe me, doing a web application with pure HTML/CSS and JavaScript is more difficult, especially for a non web developer background.</p>
<p>Is Shiny less customizable than a classic web app? Not at all! Indeed, Shiny has its own engine to build HTML tags, through R, meaning that all HTML elements are available. You may also include any custom <a href="https://shiny.rstudio.com/articles/packaging-javascript.html">JavaScript</a> or <a href="https://mastering-shiny.org/advanced-ui.html">CSS</a> code.</p>
<p>Do you remember about the first experiment of Chapter <a href="survival-kit-html.html#survival-kit-html">2</a>? We only did</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">library</span>(shiny)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="kw">p</span>(<span class="st">&quot;Hello World&quot;</span>)</a></code></pre></div>
<p>and noticed that the <code>p</code> function generates HTML. We will study in chapter <a href="htmltools-overview.html#htmltools-overview">5</a> the tools to build/modify/delete these tags. The main difference between HTML tags and Shiny tags is the absence of closing tag for Shiny. For instance, in raw HTML, we expect <code>&lt;p&gt;</code> to be closed by <code>&lt;/p&gt;</code>. In Shiny, we only call <code>p(...)</code>, where <code>...</code> may be attributes like class/id or children tags.</p>
</div>
<div id="discover-shiny-dependencies" class="section level2">
<h2><span class="header-section-number">4.2</span> Discover Shiny dependencies</h2>
<p>The simplest Shiny layout is the <code>fluidPage</code>. The <code>shinyapp</code> predefined Rstudio snippet will create a basic app skeleton (type shinyapp in RStudio IDE):</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">  <span class="kw">p</span>(<span class="st">&quot;Hello World&quot;</span>)</a>
<a class="sourceLine" id="cb66-3" data-line-number="3">)</a>
<a class="sourceLine" id="cb66-4" data-line-number="4"></a>
<a class="sourceLine" id="cb66-5" data-line-number="5">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {}</a>
<a class="sourceLine" id="cb66-6" data-line-number="6"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>At first glance, the page only contains text. Waiiit … are you sure about this? Let’s run the above example and open the HTML inspector introduced in <a href="survival-kit-html.html#survival-kit-html">2</a>. Results are displayed on Figure <a href="survival-kit-shiny.html#fig:shiny-deps">4.1</a>.</p>
<div class="figure"><span id="fig:shiny-deps"></span>
<img src="images/survival-kit/shiny-deps.png" alt="Shiny dependencies" width="537" />
<p class="caption">
Figure 4.1: Shiny dependencies
</p>
</div>
<p>We see in the head section that Shiny has 4 dependencies:</p>
<ul>
<li>json2</li>
<li>jQuery 3.4.1</li>
<li>shiny (custom JavaScript and CSS)</li>
<li>Bootstrap 3.4.1 (JavaScript and CSS) + other files (html5shiv, respond)</li>
</ul>
<p><a href="https://getbootstrap.com">Bootstrap</a> is here to provide plug and play design and interactions (tabs, navs). For instance the <code>fluidRow</code> and <code>column</code> functions of Shiny leverage the Bootstrap grid to control how elements are displayed in a page. This is convenient because it avoids to write a crazy amount of CSS/JavaScript and always reinvent the wheel.</p>
<p>jQuery drives the DOM manipulations. Shiny has its own JS and CSS files. Finally, json2 is a library to handle the <a href="https://www.json.org/json-en.html">JSON</a> data format (JavaScript Object Notation). In the following chapters we will use it a lot, through the <a href="https://cran.r-project.org/web/packages/jsonlite/index.html">jsonlite</a> package that allows to transform JSON objects in R objects and inversely.</p>
<p>In summary, all those libraries are necessary to make Shiny what it is! Customizing Shiny may imply to alter those existing libraries (except the Shiny core JavaScript and json2). In Chapter <a href="htmltools-dependencies.html#htmltools-dependencies">6</a> we will discover better tools to extract HTML dependencies.</p>
</div>
<div id="websocket-rjs-bidirectional-communication" class="section level2">
<h2><span class="header-section-number">4.3</span> Websocket: R/JS bidirectional communication</h2>
<p>How does R (server) and JavaScript (client) communicate? This is a builtin Shiny feature highlighted <a href="Fast%20bidirectional%20communication%20between%20the%20web%20browser%20and%20R%20using%20the%20httpuv%20package.">here</a>, leveraging the <a href="https://github.com/rstudio/httpuv">httpuv</a> and <a href="https://github.com/rstudio/websocket">websocket</a> packages. We will not detail how they work but rather how to inspect the websocket in a web browser. Let’s run the following app.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw">shinyApp</span>(</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">  <span class="dt">ui =</span> <span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">    <span class="kw">selectInput</span>(<span class="st">&quot;variable&quot;</span>, <span class="st">&quot;Variable:&quot;</span>,</a>
<a class="sourceLine" id="cb67-4" data-line-number="4">                <span class="kw">c</span>(<span class="st">&quot;Cylinders&quot;</span> =<span class="st"> &quot;cyl&quot;</span>,</a>
<a class="sourceLine" id="cb67-5" data-line-number="5">                  <span class="st">&quot;Transmission&quot;</span> =<span class="st"> &quot;am&quot;</span>,</a>
<a class="sourceLine" id="cb67-6" data-line-number="6">                  <span class="st">&quot;Gears&quot;</span> =<span class="st"> &quot;gear&quot;</span>)),</a>
<a class="sourceLine" id="cb67-7" data-line-number="7">    <span class="kw">tableOutput</span>(<span class="st">&quot;data&quot;</span>)</a>
<a class="sourceLine" id="cb67-8" data-line-number="8">  ),</a>
<a class="sourceLine" id="cb67-9" data-line-number="9">  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {</a>
<a class="sourceLine" id="cb67-10" data-line-number="10">    output<span class="op">$</span>data &lt;-<span class="st"> </span><span class="kw">renderTable</span>({</a>
<a class="sourceLine" id="cb67-11" data-line-number="11">      mtcars[, <span class="kw">c</span>(<span class="st">&quot;mpg&quot;</span>, input<span class="op">$</span>variable), drop =<span class="st"> </span><span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb67-12" data-line-number="12">    }, <span class="dt">rownames =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb67-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb67-14" data-line-number="14">)</a></code></pre></div>
<p>After opening the HTML inspector, we select the network tab and search for websocket in the list. We also choose the message tab to inspect what R and JavaScript say to each others. On the JavaScript side, the websocket is created in the shinyapp.js <a href="https://github.com/rstudio/shiny/blob/master/srcjs/shinyapp.js">file</a>. The first element received from R is the first message in the list shown in Figure <a href="survival-kit-shiny.html#fig:shiny-websocket">4.2</a>. It is a JSON containing the method used as well as passed data. In the meantime, you may change the select input value.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="va">socket</span>.<span class="at">send</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2"><span class="dt">method</span><span class="op">:</span> <span class="st">&#39;init&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb68-3" data-line-number="3"><span class="dt">data</span><span class="op">:</span> <span class="va">self</span>.<span class="at">$initialInput</span></a>
<a class="sourceLine" id="cb68-4" data-line-number="4"><span class="op">}</span>))<span class="op">;</span></a></code></pre></div>
<p>The second message received from R is after updating the select input.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">this</span>.<span class="at">sendInput</span> <span class="op">=</span> <span class="kw">function</span>(values) <span class="op">{</span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="kw">var</span> msg <span class="op">=</span> <span class="va">JSON</span>.<span class="at">stringify</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="dt">method</span><span class="op">:</span> <span class="st">&#39;update&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb69-4" data-line-number="4"><span class="dt">data</span><span class="op">:</span> values</a>
<a class="sourceLine" id="cb69-5" data-line-number="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb69-6" data-line-number="6"><span class="co">// other things</span></a>
<a class="sourceLine" id="cb69-7" data-line-number="7"><span class="op">};</span></a></code></pre></div>
<p>All of this is quite complex but extremely useful to check wether input/output work properly. In case of error, we would see the field <code>error</code> containing some elements. In the last part of this book, we will be designing custom inputs and knowing how to debug them outside R is priceless.</p>
<p>Finally, <code>Shiny.shinyapp.$socket.readyState</code> returns the state of the socket connection. It should be 1 if your app is running but I’ve seen some cases where the socket was actually closed (and nothing could happen).</p>
<div class="figure"><span id="fig:shiny-websocket"></span>
<img src="images/survival-kit/shiny-websocket.png" alt="Shiny websocket" width="997" />
<p class="caption">
Figure 4.2: Shiny websocket
</p>
</div>
<p>Understanding how R and JS may communicate will help in the next section about the Shiny input system.</p>
</div>
<div id="shinys-input-system" class="section level2">
<h2><span class="header-section-number">4.4</span> Shiny’s input system</h2>
<p>The goal of this part is to better understand how Shiny inputs work.</p>
<div id="shiny-javascript-sources" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Shiny JavaScript sources</h3>
<p>The Shiny input system relies on the Shiny JavaScript sources. They are located in the srcjs folder shown in Figure <a href="survival-kit-shiny.html#fig:shiny-js-sources">4.3</a>.</p>
<div class="figure"><span id="fig:shiny-js-sources"></span>
<img src="images/survival-kit/shiny-js-sources.png" alt="Shiny JavaScript sources" width="1155" />
<p class="caption">
Figure 4.3: Shiny JavaScript sources
</p>
</div>
<p>Notice the <code>_start.js</code> and <code>_end.js</code>. These will be used by the <code>Gruntfile.js</code>, that is a <a href="https://gruntjs.com">grunt-based</a> tool to run different tasks such as concatenate multiple JavaScript files, lint the code, minify it … See <a href="https://github.com/rstudio/shiny/tree/master/tools">here</a> for a summary.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="va">grunt</span>.<span class="at">registerTask</span>(<span class="st">&#39;default&#39;</span><span class="op">,</span> [</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="st">&#39;concat&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-3" data-line-number="3"><span class="st">&#39;string-replace&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-4" data-line-number="4"><span class="st">&#39;validateStringReplace&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-5" data-line-number="5"><span class="st">&#39;eslint&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-6" data-line-number="6"><span class="st">&#39;configureBabel&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-7" data-line-number="7"><span class="st">&#39;babel&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb70-8" data-line-number="8"><span class="st">&#39;uglify&#39;</span></a>
<a class="sourceLine" id="cb70-9" data-line-number="9">])<span class="op">;</span></a></code></pre></div>
<p>These results in a large big <a href="https://github.com/rstudio/shiny/blob/master/inst/www/shared/shiny.js">file</a> and its minified <a href="https://github.com/rstudio/shiny/blob/master/inst/www/shared/shiny.min.js">version</a> in the <code>shiny/inst/www/shared</code> folder.</p>
</div>
<div id="the-shiny-javascript-object" class="section level3">
<h3><span class="header-section-number">4.4.2</span> The Shiny JavaScript object</h3>
<p>The <code>Shiny</code> object is exported at the top of the <code>shiny.js</code> file.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> In other words, this means that we may use this object and any of its properties within the HTML inspector console tab, in any JavaScript file or shiny app as below.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb71-2" data-line-number="2">  tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb71-3" data-line-number="3">    <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb71-4" data-line-number="4"><span class="st">      console.log(Shiny);</span></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="st">    });</span></a>
<a class="sourceLine" id="cb71-6" data-line-number="6"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb71-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb71-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb71-9" data-line-number="9">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {}</a>
<a class="sourceLine" id="cb71-10" data-line-number="10"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>This object contains many properties and methods as shown in Figure <a href="survival-kit-shiny.html#fig:shiny-object">4.4</a>. We will discuss some of them later, like <code>Shiny.setInputValue</code>, <code>Shiny.addCustomMessageHandler</code>, <code>Shiny.shinyapps</code>, <code>Shiny.bindAll</code>, …</p>
<div class="figure"><span id="fig:shiny-object"></span>
<img src="images/survival-kit/shiny-object.png" alt="The Shiny JavaScript object" width="628" />
<p class="caption">
Figure 4.4: The Shiny JavaScript object
</p>
</div>
</div>
<div id="initialization" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Initialization</h3>
<p>When we run our app, most of the time it works and it is just fine! But what happens so that inputs and outputs are correctly handled? Upon initialization, Shiny runs several JavaScript functions. Not surprisingly, there is one called <a href="https://github.com/rstudio/shiny/blob/master/srcjs/init_shiny.js"><code>init_shiny</code></a> containing a subtantial amount of elements. We find utils functions like <code>bindOutputs</code>, <code>unbindOutputs</code> to respectively bind/unbind outputs, <code>bindInputs</code> and <code>unbindInputs</code> for inputs. Only <code>bindAll</code> and <code>unbindAll</code> are available to the user (see a usecase <a href="https://stackoverflow.com/questions/51633326/dateinput-not-working-on-dt-in-shiny">here</a>). To illustrate what they do, let’s run the app below.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb72-2" data-line-number="2">  <span class="kw">sliderInput</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>,</a>
<a class="sourceLine" id="cb72-3" data-line-number="3">              <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1000</span>, <span class="dt">value =</span> <span class="dv">500</span></a>
<a class="sourceLine" id="cb72-4" data-line-number="4">  ),</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">  <span class="kw">plotOutput</span>(<span class="st">&quot;distPlot&quot;</span>)</a>
<a class="sourceLine" id="cb72-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb72-7" data-line-number="7"></a>
<a class="sourceLine" id="cb72-8" data-line-number="8">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb72-9" data-line-number="9">  output<span class="op">$</span>distPlot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</a>
<a class="sourceLine" id="cb72-10" data-line-number="10">    <span class="kw">hist</span>(<span class="kw">rnorm</span>(input<span class="op">$</span>obs))</a>
<a class="sourceLine" id="cb72-11" data-line-number="11">  })</a>
<a class="sourceLine" id="cb72-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb72-13" data-line-number="13"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>We then open the HTML inspector and run <code>Shiny.unbindAll(document)</code> (document is the scope, that is where to search). Try to change the slider input. What do you observe? Now let’s type <code>Shiny.bindAll(document)</code> and update the slider value. What happens? Magic isn’t it? This simply shows that when inputs are not bound, nothing happens so binding inputs is necessary.</p>
<p>Let’s see below what is an input binding and how it works.</p>
</div>
<div id="input-bindings" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Input bindings</h3>
<div id="reminders-about-shiny-inputs" class="section level4">
<h4><span class="header-section-number">4.4.4.1</span> Reminders about Shiny inputs</h4>
<p>Shiny contains a lot of inputs like <code>sliderInput</code>, <code>checkboxInput</code>, <code>radioButtons</code>, <code>numericInput</code>, …Their role is to provide a way for the user to change parameters and update the app state.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">numericInput</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;Observations:&quot;</span>, <span class="dv">10</span>, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="dv">100</span>)</a></code></pre></div>
<p>All input functions have the same common <code>inputId</code> parameter, to guarantee the uniqueness of the given input.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb74-2" data-line-number="2">  <span class="kw">textInput</span>(<span class="st">&quot;text&quot;</span>, <span class="st">&quot;My Text 1&quot;</span>),</a>
<a class="sourceLine" id="cb74-3" data-line-number="3">  <span class="kw">hr</span>(),</a>
<a class="sourceLine" id="cb74-4" data-line-number="4">  <span class="kw">uiOutput</span>(<span class="st">&quot;mytext&quot;</span>)</a>
<a class="sourceLine" id="cb74-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb74-6" data-line-number="6"></a>
<a class="sourceLine" id="cb74-7" data-line-number="7">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb74-8" data-line-number="8">  output<span class="op">$</span>mytext &lt;-<span class="st"> </span><span class="kw">renderText</span>(input<span class="op">$</span>text)</a>
<a class="sourceLine" id="cb74-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb74-10" data-line-number="10"></a>
<a class="sourceLine" id="cb74-11" data-line-number="11"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>Now the questions is: how does Shiny recognizes inputs and drives their behavior?</p>
</div>
<div id="binding-shiny-inputs" class="section level4">
<h4><span class="header-section-number">4.4.4.2</span> Binding Shiny inputs</h4>
<p>An input binding allows Shiny to identify each instance of a given input and what you may do with this input. For instance, a slider input must update whenever the range is dragged or when the left and right arrows of the keyboard are pressed. It relies on a class defined in the <code>input_binding.js</code> <a href="https://github.com/rstudio/shiny/blob/master/srcjs/input_binding.js">file</a>.</p>
<p>Let’s describe each method chronologically.</p>
<div id="find-the-input" class="section level5">
<h5><span class="header-section-number">4.4.4.2.1</span> Find the input</h5>
<p>The first step, is critical and consists in locating the input in the DOM. We could compare this to the receptor/ligand reaction.
On the R side, we define an input, with a specific attribute that will serve as a receptor for the binding. For most of inputs, the <code>type</code> attribute will suit. Sometimes it may also be the class, like for the <code>actionButton</code>. On the JS side, we need a method that will indentify this receptor. Moreover, two different types of inputs (for instance <code>radioButton</code> and <code>selectInput</code>) cannot have the same receptor for conflict reasons, whereas two instances of the same input type can (if your app contains 10 sliders, they all share the same input binding!). The receptor identifier is provided by the <code>find</code> method of the <code>InputBinding</code> class. This method must be applied on a scope, that is the <code>document</code>. <code>find</code> accepts any valid jQuery selector. Figure <a href="survival-kit-shiny.html#fig:shiny-find-inputs">4.5</a> summarizes this important step.</p>
<div class="figure"><span id="fig:shiny-find-inputs"></span>
<img src="images/survival-kit/shiny-find-inputs.png" alt="How to find inputs?" width="720" />
<p class="caption">
Figure 4.5: How to find inputs?
</p>
</div>
<p>Below, we are going to create a new binding for the <code>textInput</code>, with only 2 methods mentionned in the previous section, that is <code>find</code> and <code>getValue</code>. For that, we need to create a customized textInput, <code>customTextInput</code> so that it is not recognized by the classic Shiny text input binding. We add the input-text class and make our own input binding pointing to that specific class.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">customTextInput &lt;-<span class="st"> </span><span class="cf">function</span> (inputId, label, <span class="dt">value =</span> <span class="st">&quot;&quot;</span>, <span class="dt">width =</span> <span class="ot">NULL</span>, <span class="dt">placeholder =</span> <span class="ot">NULL</span>) {</a>
<a class="sourceLine" id="cb75-2" data-line-number="2">  value &lt;-<span class="st"> </span><span class="kw">restoreInput</span>(<span class="dt">id =</span> inputId, <span class="dt">default =</span> value)</a>
<a class="sourceLine" id="cb75-3" data-line-number="3">  <span class="kw">div</span>(</a>
<a class="sourceLine" id="cb75-4" data-line-number="4">    <span class="dt">class =</span> <span class="st">&quot;form-group shiny-input-container&quot;</span>, </a>
<a class="sourceLine" id="cb75-5" data-line-number="5">    <span class="dt">style =</span> <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(width)) {</a>
<a class="sourceLine" id="cb75-6" data-line-number="6">      <span class="kw">paste0</span>(<span class="st">&quot;width: &quot;</span>, <span class="kw">validateCssUnit</span>(width), <span class="st">&quot;;&quot;</span>)</a>
<a class="sourceLine" id="cb75-7" data-line-number="7">    },</a>
<a class="sourceLine" id="cb75-8" data-line-number="8">    shiny<span class="op">:::</span><span class="kw">shinyInputLabel</span>(inputId, label), </a>
<a class="sourceLine" id="cb75-9" data-line-number="9">    tags<span class="op">$</span><span class="kw">input</span>(</a>
<a class="sourceLine" id="cb75-10" data-line-number="10">      <span class="dt">id =</span> inputId, </a>
<a class="sourceLine" id="cb75-11" data-line-number="11">      <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>, </a>
<a class="sourceLine" id="cb75-12" data-line-number="12">      <span class="dt">class =</span> <span class="st">&quot;form-control input-text&quot;</span>, </a>
<a class="sourceLine" id="cb75-13" data-line-number="13">      <span class="dt">value =</span> value,</a>
<a class="sourceLine" id="cb75-14" data-line-number="14">      <span class="dt">placeholder =</span> placeholder</a>
<a class="sourceLine" id="cb75-15" data-line-number="15">    )</a>
<a class="sourceLine" id="cb75-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb75-17" data-line-number="17">}</a></code></pre></div>
<p>We put everything in a Shiny app and invit the reader to open the HTML inspector and look at the <code>console.log</code> result.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb76-2" data-line-number="2">  tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb76-3" data-line-number="3">    <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb76-4" data-line-number="4"><span class="st">      // Input binding</span></a>
<a class="sourceLine" id="cb76-5" data-line-number="5"><span class="st">      let customTextBinding = new Shiny.InputBinding();</span></a>
<a class="sourceLine" id="cb76-6" data-line-number="6"></a>
<a class="sourceLine" id="cb76-7" data-line-number="7"><span class="st">      $.extend(customTextBinding, {</span></a>
<a class="sourceLine" id="cb76-8" data-line-number="8"><span class="st">        find: function(scope) {</span></a>
<a class="sourceLine" id="cb76-9" data-line-number="9"><span class="st">          console.log($(scope).find(&#39;.input-text&#39;));</span></a>
<a class="sourceLine" id="cb76-10" data-line-number="10"><span class="st">          return $(scope).find(&#39;.input-text&#39;);</span></a>
<a class="sourceLine" id="cb76-11" data-line-number="11"><span class="st">        }</span></a>
<a class="sourceLine" id="cb76-12" data-line-number="12"><span class="st">      });</span></a>
<a class="sourceLine" id="cb76-13" data-line-number="13"><span class="st">      </span></a>
<a class="sourceLine" id="cb76-14" data-line-number="14"><span class="st">      Shiny.inputBindings.register(customTextBinding, &#39;text&#39;);</span></a>
<a class="sourceLine" id="cb76-15" data-line-number="15"><span class="st">    });</span></a>
<a class="sourceLine" id="cb76-16" data-line-number="16"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb76-17" data-line-number="17">  ),</a>
<a class="sourceLine" id="cb76-18" data-line-number="18">  <span class="kw">customTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="st">&quot;Caption&quot;</span>, <span class="st">&quot;Data Summary&quot;</span>),</a>
<a class="sourceLine" id="cb76-19" data-line-number="19">  <span class="kw">uiOutput</span>(<span class="st">&quot;customText&quot;</span>)</a>
<a class="sourceLine" id="cb76-20" data-line-number="20">)</a>
<a class="sourceLine" id="cb76-21" data-line-number="21"></a>
<a class="sourceLine" id="cb76-22" data-line-number="22">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb76-23" data-line-number="23">  output<span class="op">$</span>customText &lt;-<span class="st"> </span><span class="kw">renderText</span>(input<span class="op">$</span>caption)</a>
<a class="sourceLine" id="cb76-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb76-25" data-line-number="25"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
</div>
<div id="initialize-inputs" class="section level5">
<h5><span class="header-section-number">4.4.4.2.2</span> Initialize inputs</h5>
<p>Upon initialization, Shiny calls the <code>initializeInputs</code> function that takes all input bindings and call their <code>initialize</code> method before binding all inputs. Note that once an input has been initialized it has a <code>_shiny_initialized</code> tag to avoid initializing it twice. The initialize method is not always defined but some API like <a href="https://framework7.io">Framework7</a>, on top of which <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> is built, require to have it. Below is an example for the toggle input:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="co">// what is expected</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="kw">let</span> toggle <span class="op">=</span> <span class="va">app</span>.<span class="va">toggle</span>.<span class="at">create</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb77-3" data-line-number="3"><span class="dt">el</span><span class="op">:</span> <span class="st">&#39;.toggle&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="dt">on</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="dt">change</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></a>
<a class="sourceLine" id="cb77-6" data-line-number="6"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Toggle changed&#39;</span>)</a>
<a class="sourceLine" id="cb77-7" data-line-number="7"><span class="op">}</span></a>
<a class="sourceLine" id="cb77-8" data-line-number="8"><span class="op">}</span></a>
<a class="sourceLine" id="cb77-9" data-line-number="9"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><code>app.toggle.create</code> is internal to the API. The corresponding shinyMobile input binding starts as follows.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">var</span> f7ToggleBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">InputBinding</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="va">$</span>.<span class="at">extend</span>(f7ToggleBinding<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb78-3" data-line-number="3"><span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="va">app</span>.<span class="va">toggle</span>.<span class="at">create</span>(<span class="op">{</span><span class="dt">el</span><span class="op">:</span> el<span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb78-5" data-line-number="5"><span class="op">},</span></a>
<a class="sourceLine" id="cb78-6" data-line-number="6"><span class="co">// other methods</span></a>
<a class="sourceLine" id="cb78-7" data-line-number="7"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Once initialized, we may use all specific methods provided by the API. <a href="https://framework7.io">Framework7</a> is clearly a gold mine, as its API provides a lot of possible options for many inputs/widgets.</p>
</div>
<div id="get-the-value" class="section level5">
<h5><span class="header-section-number">4.4.4.2.3</span> Get the value</h5>
<p><code>getValue(el)</code> returns the input value. The way to obtain the value is different for almost all inputs. For instance, the <code>textInput</code> is pretty simple since the value is located in the <code>value</code> attribute. <code>el</code> refers to the element holding the id attribute and recognized by the <code>find</code> method. Figure <a href="survival-kit-shiny.html#fig:shiny-el">4.6</a> shows the result of a <code>console.log($(el));</code>.</p>
<div class="figure"><span id="fig:shiny-el"></span>
<img src="images/survival-kit/shiny-el.png" alt="About el" width="1278" />
<p class="caption">
Figure 4.6: About el
</p>
</div>
<p>To get the value, we apply the jQuery method <code>val</code> on the <code>$(el)</code> element and return the result.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">  tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">    <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb79-4" data-line-number="4"><span class="st">      // Input binding</span></a>
<a class="sourceLine" id="cb79-5" data-line-number="5"><span class="st">      let customTextBinding = new Shiny.InputBinding();</span></a>
<a class="sourceLine" id="cb79-6" data-line-number="6"></a>
<a class="sourceLine" id="cb79-7" data-line-number="7"><span class="st">      $.extend(customTextBinding, {</span></a>
<a class="sourceLine" id="cb79-8" data-line-number="8"><span class="st">        find: function(scope) {</span></a>
<a class="sourceLine" id="cb79-9" data-line-number="9"><span class="st">          return $(scope).find(&#39;.input-text&#39;);</span></a>
<a class="sourceLine" id="cb79-10" data-line-number="10"><span class="st">        },</span></a>
<a class="sourceLine" id="cb79-11" data-line-number="11"><span class="st">        // Given the DOM element for the input, return the value</span></a>
<a class="sourceLine" id="cb79-12" data-line-number="12"><span class="st">        getValue: function(el) {</span></a>
<a class="sourceLine" id="cb79-13" data-line-number="13"><span class="st">          console.log($(el));</span></a>
<a class="sourceLine" id="cb79-14" data-line-number="14"><span class="st">          return $(el).val();</span></a>
<a class="sourceLine" id="cb79-15" data-line-number="15"><span class="st">        }</span></a>
<a class="sourceLine" id="cb79-16" data-line-number="16"><span class="st">      });</span></a>
<a class="sourceLine" id="cb79-17" data-line-number="17"><span class="st">      </span></a>
<a class="sourceLine" id="cb79-18" data-line-number="18"><span class="st">      Shiny.inputBindings.register(customTextBinding, &#39;text&#39;);</span></a>
<a class="sourceLine" id="cb79-19" data-line-number="19"><span class="st">    });</span></a>
<a class="sourceLine" id="cb79-20" data-line-number="20"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb79-21" data-line-number="21">  ),</a>
<a class="sourceLine" id="cb79-22" data-line-number="22">  <span class="kw">customTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="st">&quot;Caption&quot;</span>, <span class="st">&quot;Data Summary&quot;</span>),</a>
<a class="sourceLine" id="cb79-23" data-line-number="23">  <span class="kw">uiOutput</span>(<span class="st">&quot;customText&quot;</span>)</a>
<a class="sourceLine" id="cb79-24" data-line-number="24">)</a>
<a class="sourceLine" id="cb79-25" data-line-number="25"></a>
<a class="sourceLine" id="cb79-26" data-line-number="26">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb79-27" data-line-number="27">  output<span class="op">$</span>customText &lt;-<span class="st"> </span><span class="kw">renderText</span>(input<span class="op">$</span>caption)</a>
<a class="sourceLine" id="cb79-28" data-line-number="28">}</a>
<a class="sourceLine" id="cb79-29" data-line-number="29"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>This time, the input value is returned. Notice that when you try to change the text content, the output value does not update as we would normally expect. We are actually missing a couple of methods so that the binding is fully working.</p>
</div>
<div id="set-and-update" class="section level5">
<h5><span class="header-section-number">4.4.4.2.4</span> Set and update</h5>
<p><code>setValue(el, value)</code> is used to set the value of the current input. This method is necessary so that the input value can be updated. It has to be used in combination with <code>receiveMessage(el, data)</code>, which is the JavaScript part of all the R <code>updateInput</code> functions. We usually call the <code>setValue</code> method inside.</p>
<p>Let’s create a function to update our custom text input. Call it <code>updateCustomTextInput</code>. It requires at least 3 parameters:</p>
<ul>
<li>inputId tells which input to update.</li>
<li>value is the new value. This will be taken by the <code>setValue</code> JS method in the input binding</li>
<li>session is the Shiny session object. session is an <a href="https://r6.r-lib.org">R6</a> class having methods like <code>sendInputMessage</code> to send values from R to JavaScript. The <code>receiveMessage</code> method will apply <code>setValue</code> with the data received from R</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">updateCustomTextInput &lt;-<span class="st"> </span><span class="cf">function</span>(inputId, <span class="dt">value =</span> <span class="ot">NULL</span>, <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()) {</a>
<a class="sourceLine" id="cb80-2" data-line-number="2">  session<span class="op">$</span><span class="kw">sendInputMessage</span>(inputId, <span class="dt">message =</span> value)</a>
<a class="sourceLine" id="cb80-3" data-line-number="3">}</a></code></pre></div>
<p>We add <code>setValue</code> and <code>receiveMessage</code> to custom input binding:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb81-2" data-line-number="2">  tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">    <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb81-4" data-line-number="4"><span class="st">      // Input binding</span></a>
<a class="sourceLine" id="cb81-5" data-line-number="5"><span class="st">      let customTextBinding = new Shiny.InputBinding();</span></a>
<a class="sourceLine" id="cb81-6" data-line-number="6"></a>
<a class="sourceLine" id="cb81-7" data-line-number="7"><span class="st">      $.extend(customTextBinding, {</span></a>
<a class="sourceLine" id="cb81-8" data-line-number="8"><span class="st">        find: function(scope) {</span></a>
<a class="sourceLine" id="cb81-9" data-line-number="9"><span class="st">          return $(scope).find(&#39;.input-text&#39;);</span></a>
<a class="sourceLine" id="cb81-10" data-line-number="10"><span class="st">        },</span></a>
<a class="sourceLine" id="cb81-11" data-line-number="11"><span class="st">        // Given the DOM element for the input, return the value</span></a>
<a class="sourceLine" id="cb81-12" data-line-number="12"><span class="st">        getValue: function(el) {</span></a>
<a class="sourceLine" id="cb81-13" data-line-number="13"><span class="st">          return $(el).val();</span></a>
<a class="sourceLine" id="cb81-14" data-line-number="14"><span class="st">        },</span></a>
<a class="sourceLine" id="cb81-15" data-line-number="15"><span class="st">        setValue: function(el, value) {</span></a>
<a class="sourceLine" id="cb81-16" data-line-number="16"><span class="st">          $(el).val(value);</span></a>
<a class="sourceLine" id="cb81-17" data-line-number="17"><span class="st">        },</span></a>
<a class="sourceLine" id="cb81-18" data-line-number="18"><span class="st">        receiveMessage: function(el, data) {</span></a>
<a class="sourceLine" id="cb81-19" data-line-number="19"><span class="st">          console.log(data);</span></a>
<a class="sourceLine" id="cb81-20" data-line-number="20"><span class="st">          this.setValue(el, data);</span></a>
<a class="sourceLine" id="cb81-21" data-line-number="21"><span class="st">        }</span></a>
<a class="sourceLine" id="cb81-22" data-line-number="22"><span class="st">      });</span></a>
<a class="sourceLine" id="cb81-23" data-line-number="23"><span class="st">      </span></a>
<a class="sourceLine" id="cb81-24" data-line-number="24"><span class="st">      Shiny.inputBindings.register(customTextBinding, &#39;text&#39;);</span></a>
<a class="sourceLine" id="cb81-25" data-line-number="25"><span class="st">    });</span></a>
<a class="sourceLine" id="cb81-26" data-line-number="26"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb81-27" data-line-number="27">  ),</a>
<a class="sourceLine" id="cb81-28" data-line-number="28">  <span class="kw">customTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="st">&quot;Caption&quot;</span>, <span class="st">&quot;Data Summary&quot;</span>),</a>
<a class="sourceLine" id="cb81-29" data-line-number="29">  <span class="kw">actionButton</span>(<span class="st">&quot;update&quot;</span>, <span class="st">&quot;Update text!&quot;</span>, <span class="dt">class =</span> <span class="st">&quot;btn-success&quot;</span>),</a>
<a class="sourceLine" id="cb81-30" data-line-number="30">  <span class="kw">uiOutput</span>(<span class="st">&quot;customText&quot;</span>)</a>
<a class="sourceLine" id="cb81-31" data-line-number="31">)</a>
<a class="sourceLine" id="cb81-32" data-line-number="32"></a>
<a class="sourceLine" id="cb81-33" data-line-number="33">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb81-34" data-line-number="34">  output<span class="op">$</span>customText &lt;-<span class="st"> </span><span class="kw">renderText</span>(input<span class="op">$</span>caption)</a>
<a class="sourceLine" id="cb81-35" data-line-number="35">  <span class="kw">observeEvent</span>(input<span class="op">$</span>update, {</a>
<a class="sourceLine" id="cb81-36" data-line-number="36">    <span class="kw">updateCustomTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;new text&quot;</span>)</a>
<a class="sourceLine" id="cb81-37" data-line-number="37">  })</a>
<a class="sourceLine" id="cb81-38" data-line-number="38">}</a>
<a class="sourceLine" id="cb81-39" data-line-number="39"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>Figure <a href="survival-kit-shiny.html#fig:shiny-update-inputs">4.7</a> illustrates the main mechanisms.</p>
<div class="figure"><span id="fig:shiny-update-inputs"></span>
<img src="images/survival-kit/shiny-update-inputs.png" alt="What happens after clickin on the update button?" width="720" />
<p class="caption">
Figure 4.7: What happens after clickin on the update button?
</p>
</div>
<p>If we have to pass multiple elements to update, we would have to change the <code>updateCustomTextInput</code> function such as:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">updateCustomTextInput &lt;-<span class="st"> </span><span class="cf">function</span>(inputId, <span class="dt">value =</span> <span class="ot">NULL</span>, <span class="dt">placeholder =</span> <span class="ot">NULL</span>, <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()) {</a>
<a class="sourceLine" id="cb82-2" data-line-number="2">  message &lt;-<span class="st"> </span>shiny<span class="op">:::</span><span class="kw">dropNulls</span>(</a>
<a class="sourceLine" id="cb82-3" data-line-number="3">    <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb82-4" data-line-number="4">      <span class="dt">value =</span> value,</a>
<a class="sourceLine" id="cb82-5" data-line-number="5">      <span class="dt">placeholder =</span> placeholder</a>
<a class="sourceLine" id="cb82-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb82-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb82-8" data-line-number="8">  session<span class="op">$</span><span class="kw">sendInputMessage</span>(inputId, message)</a>
<a class="sourceLine" id="cb82-9" data-line-number="9">}</a></code></pre></div>
<p><code>dropNulls</code> is an internal function ensuring that the list does not contain NULL elements. On the JS side, we would have to update the <code>receiveMessage</code> method. We send a list from R, which is then serialized to a JSON object. Properties like <code>value</code> may be accessed using the . notation:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb83-1" data-line-number="1">receiveMessage<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) <span class="op">{</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="va">console</span>.<span class="at">log</span>(data)<span class="op">;</span></a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="cf">if</span> (<span class="va">data</span>.<span class="at">hasOwnProperty</span>(<span class="st">&#39;value&#39;</span>)) <span class="op">{</span></a>
<a class="sourceLine" id="cb83-4" data-line-number="4"><span class="kw">this</span>.<span class="at">setValue</span>(el<span class="op">,</span> <span class="va">data</span>.<span class="at">value</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb83-5" data-line-number="5"><span class="op">}</span></a>
<a class="sourceLine" id="cb83-6" data-line-number="6"></a>
<a class="sourceLine" id="cb83-7" data-line-number="7"><span class="co">// other parameters to update...</span></a>
<a class="sourceLine" id="cb83-8" data-line-number="8"><span class="op">}</span></a></code></pre></div>
<p>So far so good! We managed to update the text input value. Yet, the output value does not change. We are going to fix this missing step in the next section.</p>
</div>
<div id="subscribe" class="section level5">
<h5><span class="header-section-number">4.4.4.2.5</span> Subscribe</h5>
<p><code>subscribe(el, callback)</code> listens to events telling under which circumstances to tell Shiny to update the input value and make it available in the app. Some API like Bootstrap explicitly mention those events (like <code>hide.bs.tab</code>, <code>shown.bs.tab</code>, …).
Going back to our custom text input, what event would make it change?</p>
<ul>
<li>After a key is release on the keyboard. We may listen to <code>keyup</code></li>
<li>After copying and pasting any text in the input field or dictating text. The <code>input</code> event may be helpful</li>
</ul>
<p>We may add those <a href="https://javascript.info/events-change-input">events</a> to our binding using an event listener seen at the end of Chapter <a href="survival-kit-javascript.html#survival-kit-javascript">3</a>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;keyup.customTextBinding input.customTextBinding&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2"><span class="at">callback</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb84-3" data-line-number="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><code>callback</code> ensures that the new value is captured by Shiny. We will come back later on the callback parameter.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">  tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb85-3" data-line-number="3">    <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="st">      // Input binding</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="st">      let customTextBinding = new Shiny.InputBinding();</span></a>
<a class="sourceLine" id="cb85-6" data-line-number="6"></a>
<a class="sourceLine" id="cb85-7" data-line-number="7"><span class="st">      $.extend(customTextBinding, {</span></a>
<a class="sourceLine" id="cb85-8" data-line-number="8"><span class="st">        find: function(scope) {</span></a>
<a class="sourceLine" id="cb85-9" data-line-number="9"><span class="st">          return $(scope).find(&#39;.input-text&#39;);</span></a>
<a class="sourceLine" id="cb85-10" data-line-number="10"><span class="st">        },</span></a>
<a class="sourceLine" id="cb85-11" data-line-number="11"><span class="st">        // Given the DOM element for the input, return the value</span></a>
<a class="sourceLine" id="cb85-12" data-line-number="12"><span class="st">        getValue: function(el) {</span></a>
<a class="sourceLine" id="cb85-13" data-line-number="13"><span class="st">          return $(el).val();</span></a>
<a class="sourceLine" id="cb85-14" data-line-number="14"><span class="st">        },</span></a>
<a class="sourceLine" id="cb85-15" data-line-number="15"><span class="st">        setValue: function(el, value) {</span></a>
<a class="sourceLine" id="cb85-16" data-line-number="16"><span class="st">          $(el).val(value);</span></a>
<a class="sourceLine" id="cb85-17" data-line-number="17"><span class="st">        },</span></a>
<a class="sourceLine" id="cb85-18" data-line-number="18"><span class="st">        receiveMessage: function(el, data) {</span></a>
<a class="sourceLine" id="cb85-19" data-line-number="19"><span class="st">          if (data.hasOwnProperty(&#39;value&#39;)) {</span></a>
<a class="sourceLine" id="cb85-20" data-line-number="20"><span class="st">            this.setValue(el, data.value);</span></a>
<a class="sourceLine" id="cb85-21" data-line-number="21"><span class="st">            $(el).trigger(&#39;change&#39;);</span></a>
<a class="sourceLine" id="cb85-22" data-line-number="22"><span class="st">          }</span></a>
<a class="sourceLine" id="cb85-23" data-line-number="23"><span class="st">        },</span></a>
<a class="sourceLine" id="cb85-24" data-line-number="24"><span class="st">        subscribe: function(el, callback) {</span></a>
<a class="sourceLine" id="cb85-25" data-line-number="25"><span class="st">          $(el).on(&#39;keyup.customTextBinding input.customTextBinding&#39;, function(event) {</span></a>
<a class="sourceLine" id="cb85-26" data-line-number="26"><span class="st">            console.log(event);</span></a>
<a class="sourceLine" id="cb85-27" data-line-number="27"><span class="st">            callback();</span></a>
<a class="sourceLine" id="cb85-28" data-line-number="28"><span class="st">          });</span></a>
<a class="sourceLine" id="cb85-29" data-line-number="29"><span class="st">        }</span></a>
<a class="sourceLine" id="cb85-30" data-line-number="30"><span class="st">      });</span></a>
<a class="sourceLine" id="cb85-31" data-line-number="31"><span class="st">      </span></a>
<a class="sourceLine" id="cb85-32" data-line-number="32"><span class="st">      Shiny.inputBindings.register(customTextBinding, &#39;text&#39;);</span></a>
<a class="sourceLine" id="cb85-33" data-line-number="33"><span class="st">    });</span></a>
<a class="sourceLine" id="cb85-34" data-line-number="34"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb85-35" data-line-number="35">  ),</a>
<a class="sourceLine" id="cb85-36" data-line-number="36">  <span class="kw">customTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="st">&quot;Caption&quot;</span>, <span class="st">&quot;Data Summary&quot;</span>),</a>
<a class="sourceLine" id="cb85-37" data-line-number="37">  <span class="kw">actionButton</span>(<span class="st">&quot;update&quot;</span>, <span class="st">&quot;Update text!&quot;</span>, <span class="dt">class =</span> <span class="st">&quot;btn-success&quot;</span>),</a>
<a class="sourceLine" id="cb85-38" data-line-number="38">  <span class="kw">uiOutput</span>(<span class="st">&quot;customText&quot;</span>)</a>
<a class="sourceLine" id="cb85-39" data-line-number="39">)</a>
<a class="sourceLine" id="cb85-40" data-line-number="40"></a>
<a class="sourceLine" id="cb85-41" data-line-number="41">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb85-42" data-line-number="42">  output<span class="op">$</span>customText &lt;-<span class="st"> </span><span class="kw">renderText</span>(input<span class="op">$</span>caption)</a>
<a class="sourceLine" id="cb85-43" data-line-number="43">  <span class="kw">observeEvent</span>(input<span class="op">$</span>update, {</a>
<a class="sourceLine" id="cb85-44" data-line-number="44">    <span class="kw">updateCustomTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;new text&quot;</span>)</a>
<a class="sourceLine" id="cb85-45" data-line-number="45">  })</a>
<a class="sourceLine" id="cb85-46" data-line-number="46">}</a>
<a class="sourceLine" id="cb85-47" data-line-number="47"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>Hurray! The output result is successfuly changed when the input value is manually changed. But nothing happens when we click on the update button. What did we miss? Looking back at the <code>receiveMessage</code> method, we change the input value but how does Shiny knows that this step was successful? To check that no event is raised, we put a <code>console.log(event);</code> in the <code>subscribe</code> method. Any action like removing the text content or adding new text triggers event but clicking on the action button does not. Therefore, we must trigger an event and add it to the <code>subscribe</code> method. We may choose the <code>change</code> event, that triggers when an element has finished changing.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;change.customTextBinding&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb86-2" data-line-number="2"><span class="at">callback</span>(<span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb86-3" data-line-number="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Let’s try again.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb87-2" data-line-number="2">  tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb87-3" data-line-number="3">    <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb87-4" data-line-number="4"><span class="st">      // Input binding</span></a>
<a class="sourceLine" id="cb87-5" data-line-number="5"><span class="st">      let customTextBinding = new Shiny.InputBinding();</span></a>
<a class="sourceLine" id="cb87-6" data-line-number="6"></a>
<a class="sourceLine" id="cb87-7" data-line-number="7"><span class="st">      $.extend(customTextBinding, {</span></a>
<a class="sourceLine" id="cb87-8" data-line-number="8"><span class="st">        find: function(scope) {</span></a>
<a class="sourceLine" id="cb87-9" data-line-number="9"><span class="st">          return $(scope).find(&#39;.input-text&#39;);</span></a>
<a class="sourceLine" id="cb87-10" data-line-number="10"><span class="st">        },</span></a>
<a class="sourceLine" id="cb87-11" data-line-number="11"><span class="st">        // Given the DOM element for the input, return the value</span></a>
<a class="sourceLine" id="cb87-12" data-line-number="12"><span class="st">        getValue: function(el) {</span></a>
<a class="sourceLine" id="cb87-13" data-line-number="13"><span class="st">          return $(el).val();</span></a>
<a class="sourceLine" id="cb87-14" data-line-number="14"><span class="st">        },</span></a>
<a class="sourceLine" id="cb87-15" data-line-number="15"><span class="st">        setValue: function(el, value) {</span></a>
<a class="sourceLine" id="cb87-16" data-line-number="16"><span class="st">          $(el).val(value);</span></a>
<a class="sourceLine" id="cb87-17" data-line-number="17"><span class="st">        },</span></a>
<a class="sourceLine" id="cb87-18" data-line-number="18"><span class="st">        receiveMessage: function(el, data) {</span></a>
<a class="sourceLine" id="cb87-19" data-line-number="19"><span class="st">          if (data.hasOwnProperty(&#39;value&#39;)) {</span></a>
<a class="sourceLine" id="cb87-20" data-line-number="20"><span class="st">            this.setValue(el, data.value);</span></a>
<a class="sourceLine" id="cb87-21" data-line-number="21"><span class="st">            $(el).trigger(&#39;change&#39;);</span></a>
<a class="sourceLine" id="cb87-22" data-line-number="22"><span class="st">          }</span></a>
<a class="sourceLine" id="cb87-23" data-line-number="23"><span class="st">        },</span></a>
<a class="sourceLine" id="cb87-24" data-line-number="24"><span class="st">        subscribe: function(el, callback) {</span></a>
<a class="sourceLine" id="cb87-25" data-line-number="25"><span class="st">          $(el).on(&#39;keyup.customTextBinding input.textInputBinding&#39;, function(event) {</span></a>
<a class="sourceLine" id="cb87-26" data-line-number="26"><span class="st">            callback();</span></a>
<a class="sourceLine" id="cb87-27" data-line-number="27"><span class="st">          });</span></a>
<a class="sourceLine" id="cb87-28" data-line-number="28"></a>
<a class="sourceLine" id="cb87-29" data-line-number="29"><span class="st">          $(el).on(&#39;change.customTextBinding&#39;, function(event) {</span></a>
<a class="sourceLine" id="cb87-30" data-line-number="30"><span class="st">            callback(false);</span></a>
<a class="sourceLine" id="cb87-31" data-line-number="31"><span class="st">          });</span></a>
<a class="sourceLine" id="cb87-32" data-line-number="32"><span class="st">        }</span></a>
<a class="sourceLine" id="cb87-33" data-line-number="33"><span class="st">      });</span></a>
<a class="sourceLine" id="cb87-34" data-line-number="34"><span class="st">      </span></a>
<a class="sourceLine" id="cb87-35" data-line-number="35"><span class="st">      Shiny.inputBindings.register(customTextBinding, &#39;text&#39;);</span></a>
<a class="sourceLine" id="cb87-36" data-line-number="36"><span class="st">    });</span></a>
<a class="sourceLine" id="cb87-37" data-line-number="37"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb87-38" data-line-number="38">  ),</a>
<a class="sourceLine" id="cb87-39" data-line-number="39">  <span class="kw">customTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="st">&quot;Caption&quot;</span>, <span class="st">&quot;Data Summary&quot;</span>),</a>
<a class="sourceLine" id="cb87-40" data-line-number="40">  <span class="kw">actionButton</span>(<span class="st">&quot;update&quot;</span>, <span class="st">&quot;Update text!&quot;</span>, <span class="dt">class =</span> <span class="st">&quot;btn-success&quot;</span>),</a>
<a class="sourceLine" id="cb87-41" data-line-number="41">  <span class="kw">uiOutput</span>(<span class="st">&quot;customText&quot;</span>)</a>
<a class="sourceLine" id="cb87-42" data-line-number="42">)</a>
<a class="sourceLine" id="cb87-43" data-line-number="43"></a>
<a class="sourceLine" id="cb87-44" data-line-number="44">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb87-45" data-line-number="45">  output<span class="op">$</span>customText &lt;-<span class="st"> </span><span class="kw">renderText</span>(input<span class="op">$</span>caption)</a>
<a class="sourceLine" id="cb87-46" data-line-number="46">  <span class="kw">observeEvent</span>(input<span class="op">$</span>update, {</a>
<a class="sourceLine" id="cb87-47" data-line-number="47">    <span class="kw">updateCustomTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;new text&quot;</span>)</a>
<a class="sourceLine" id="cb87-48" data-line-number="48">  })</a>
<a class="sourceLine" id="cb87-49" data-line-number="49">}</a>
<a class="sourceLine" id="cb87-50" data-line-number="50"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>Perfect? Not exactly. Wouldn’t is be better to only change the input value once the keyboard is completly released for some time (and not each time a key is released). This is what we call debouncing. This implies to set a delay before telling Shiny to get the new value and the <code>getRatePolicy</code> method is exactly what we need. Additionally, we must also pass true to the <code>callback</code> in the subscribe method, in order to apply our specific rate policy (<a href="https://davidwalsh.name/javascript-debounce-function">debounce</a>, throttle). This is useful for instance when we don’t want to flood the server with useless update requests. For a slider, we only want to send the value as soon as the range stops moving and not all intermediate values. Those elements are defined <a href="https://github.com/rstudio/shiny/blob/master/srcjs/input_rate.js">here</a>.</p>
<p>Run the app below and try to manually change the text input value by adding a couple of letters as fast as you can. What do you notice? We see that output value only updates when we release the keyboard.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb88-2" data-line-number="2">  tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb88-3" data-line-number="3">    <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb88-4" data-line-number="4"><span class="st">      // Input binding</span></a>
<a class="sourceLine" id="cb88-5" data-line-number="5"><span class="st">      let customTextBinding = new Shiny.InputBinding();</span></a>
<a class="sourceLine" id="cb88-6" data-line-number="6"></a>
<a class="sourceLine" id="cb88-7" data-line-number="7"><span class="st">      $.extend(customTextBinding, {</span></a>
<a class="sourceLine" id="cb88-8" data-line-number="8"><span class="st">        find: function(scope) {</span></a>
<a class="sourceLine" id="cb88-9" data-line-number="9"><span class="st">          return $(scope).find(&#39;.input-text&#39;);</span></a>
<a class="sourceLine" id="cb88-10" data-line-number="10"><span class="st">        },</span></a>
<a class="sourceLine" id="cb88-11" data-line-number="11"><span class="st">        // Given the DOM element for the input, return the value</span></a>
<a class="sourceLine" id="cb88-12" data-line-number="12"><span class="st">        getValue: function(el) {</span></a>
<a class="sourceLine" id="cb88-13" data-line-number="13"><span class="st">          return $(el).val();</span></a>
<a class="sourceLine" id="cb88-14" data-line-number="14"><span class="st">        },</span></a>
<a class="sourceLine" id="cb88-15" data-line-number="15"><span class="st">        setValue: function(el, value) {</span></a>
<a class="sourceLine" id="cb88-16" data-line-number="16"><span class="st">          $(el).val(value);</span></a>
<a class="sourceLine" id="cb88-17" data-line-number="17"><span class="st">        },</span></a>
<a class="sourceLine" id="cb88-18" data-line-number="18"><span class="st">        receiveMessage: function(el, data) {</span></a>
<a class="sourceLine" id="cb88-19" data-line-number="19"><span class="st">          if (data.hasOwnProperty(&#39;value&#39;)) {</span></a>
<a class="sourceLine" id="cb88-20" data-line-number="20"><span class="st">            this.setValue(el, data.value);</span></a>
<a class="sourceLine" id="cb88-21" data-line-number="21"><span class="st">            $(el).trigger(&#39;change&#39;);</span></a>
<a class="sourceLine" id="cb88-22" data-line-number="22"><span class="st">          }</span></a>
<a class="sourceLine" id="cb88-23" data-line-number="23"><span class="st">        },</span></a>
<a class="sourceLine" id="cb88-24" data-line-number="24"><span class="st">        subscribe: function(el, callback) {</span></a>
<a class="sourceLine" id="cb88-25" data-line-number="25"><span class="st">          $(el).on(&#39;keyup.customTextBinding input.textInputBinding&#39;, function(event) {</span></a>
<a class="sourceLine" id="cb88-26" data-line-number="26"><span class="st">            callback(true);</span></a>
<a class="sourceLine" id="cb88-27" data-line-number="27"><span class="st">          });</span></a>
<a class="sourceLine" id="cb88-28" data-line-number="28"></a>
<a class="sourceLine" id="cb88-29" data-line-number="29"><span class="st">          $(el).on(&#39;change.customTextBinding&#39;, function(event) {</span></a>
<a class="sourceLine" id="cb88-30" data-line-number="30"><span class="st">            callback();</span></a>
<a class="sourceLine" id="cb88-31" data-line-number="31"><span class="st">          });</span></a>
<a class="sourceLine" id="cb88-32" data-line-number="32"><span class="st">        },</span></a>
<a class="sourceLine" id="cb88-33" data-line-number="33"><span class="st">        getRatePolicy: function() {</span></a>
<a class="sourceLine" id="cb88-34" data-line-number="34"><span class="st">          return {</span></a>
<a class="sourceLine" id="cb88-35" data-line-number="35"><span class="st">            policy: &#39;debounce&#39;,</span></a>
<a class="sourceLine" id="cb88-36" data-line-number="36"><span class="st">            delay: 250</span></a>
<a class="sourceLine" id="cb88-37" data-line-number="37"><span class="st">          };</span></a>
<a class="sourceLine" id="cb88-38" data-line-number="38"><span class="st">        },</span></a>
<a class="sourceLine" id="cb88-39" data-line-number="39"><span class="st">        unsubscribe: function(el) {</span></a>
<a class="sourceLine" id="cb88-40" data-line-number="40"><span class="st">          $(el).off(&#39;.customTextBinding&#39;);</span></a>
<a class="sourceLine" id="cb88-41" data-line-number="41"><span class="st">        }</span></a>
<a class="sourceLine" id="cb88-42" data-line-number="42"><span class="st">      });</span></a>
<a class="sourceLine" id="cb88-43" data-line-number="43"><span class="st">      </span></a>
<a class="sourceLine" id="cb88-44" data-line-number="44"><span class="st">      Shiny.inputBindings.register(customTextBinding, &#39;text&#39;);</span></a>
<a class="sourceLine" id="cb88-45" data-line-number="45"><span class="st">    });</span></a>
<a class="sourceLine" id="cb88-46" data-line-number="46"><span class="st">    &quot;</span></a>
<a class="sourceLine" id="cb88-47" data-line-number="47">  ),</a>
<a class="sourceLine" id="cb88-48" data-line-number="48">  <span class="kw">customTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="st">&quot;Caption&quot;</span>, <span class="st">&quot;Data Summary&quot;</span>),</a>
<a class="sourceLine" id="cb88-49" data-line-number="49">  <span class="kw">actionButton</span>(<span class="st">&quot;update&quot;</span>, <span class="st">&quot;Update text!&quot;</span>, <span class="dt">class =</span> <span class="st">&quot;btn-success&quot;</span>),</a>
<a class="sourceLine" id="cb88-50" data-line-number="50">  <span class="kw">uiOutput</span>(<span class="st">&quot;customText&quot;</span>)</a>
<a class="sourceLine" id="cb88-51" data-line-number="51">)</a>
<a class="sourceLine" id="cb88-52" data-line-number="52"></a>
<a class="sourceLine" id="cb88-53" data-line-number="53">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb88-54" data-line-number="54">  output<span class="op">$</span>customText &lt;-<span class="st"> </span><span class="kw">renderText</span>(input<span class="op">$</span>caption)</a>
<a class="sourceLine" id="cb88-55" data-line-number="55">  <span class="kw">observeEvent</span>(input<span class="op">$</span>update, {</a>
<a class="sourceLine" id="cb88-56" data-line-number="56">    <span class="kw">updateCustomTextInput</span>(<span class="st">&quot;caption&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;new text&quot;</span>)</a>
<a class="sourceLine" id="cb88-57" data-line-number="57">  })</a>
<a class="sourceLine" id="cb88-58" data-line-number="58">}</a>
<a class="sourceLine" id="cb88-59" data-line-number="59"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>You may adjust the delay according to your needs, but a too high delay would not feel very natural.</p>
</div>
<div id="register-an-input-binding" class="section level5">
<h5><span class="header-section-number">4.4.4.2.6</span> Register an input binding</h5>
<p>At the end of the input binding definition, we register it for Shiny.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw">let</span> myBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">inputBinding</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="va">$</span>.<span class="at">extend</span>(myBinding<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb89-3" data-line-number="3"><span class="co">// methods go here</span></a>
<a class="sourceLine" id="cb89-4" data-line-number="4"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb89-5" data-line-number="5"></a>
<a class="sourceLine" id="cb89-6" data-line-number="6"><span class="va">Shiny</span>.<span class="va">inputBindings</span>.<span class="at">register</span>(myBinding<span class="op">,</span> <span class="st">&#39;reference&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Although the Shiny <a href="https://shiny.rstudio.com/articles/building-inputs.html">documentation</a> mentions a <code>Shiny.inputBindings.setPriority</code> method to handle conflicting bindings, it is better not to have to use it.</p>
</div>
</div>
<div id="binding-other-elements" class="section level4">
<h4><span class="header-section-number">4.4.4.3</span> Binding other elements</h4>
<p>The Shiny input binding system is too convenient to only use it for input elements. In shinydashboard, you may know the <code>box</code> function. Boxes are containers with a title, body and footer as well as optional elements. Interestingly we may collapse/uncollapse the box. It would be nice to capture the state of the box in an input, so as to trigger other actions as soon as this input changes. Since an input value is unique, we must add an inputId parameter to the box function:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="st">&quot;%OR%&quot;</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(a)) a <span class="cf">else</span> b</a>
<a class="sourceLine" id="cb90-2" data-line-number="2"></a>
<a class="sourceLine" id="cb90-3" data-line-number="3">box2 &lt;-<span class="st"> </span><span class="cf">function</span> (..., <span class="dt">inputId =</span> <span class="ot">NULL</span>, <span class="dt">title =</span> <span class="ot">NULL</span>, <span class="dt">footer =</span> <span class="ot">NULL</span>, <span class="dt">status =</span> <span class="ot">NULL</span>, <span class="dt">solidHeader =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb90-4" data-line-number="4">                 <span class="dt">background =</span> <span class="ot">NULL</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="ot">NULL</span>, <span class="dt">collapsible =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb90-5" data-line-number="5">                 <span class="dt">collapsed =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb90-6" data-line-number="6">{</a>
<a class="sourceLine" id="cb90-7" data-line-number="7">  boxClass &lt;-<span class="st"> &quot;box&quot;</span></a>
<a class="sourceLine" id="cb90-8" data-line-number="8">  <span class="cf">if</span> (solidHeader <span class="op">||</span><span class="st"> </span><span class="op">!</span><span class="kw">is.null</span>(background)) {</a>
<a class="sourceLine" id="cb90-9" data-line-number="9">    boxClass &lt;-<span class="st"> </span><span class="kw">paste</span>(boxClass, <span class="st">&quot;box-solid&quot;</span>)</a>
<a class="sourceLine" id="cb90-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb90-11" data-line-number="11">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(status)) {</a>
<a class="sourceLine" id="cb90-12" data-line-number="12">    boxClass &lt;-<span class="st"> </span><span class="kw">paste0</span>(boxClass, <span class="st">&quot; box-&quot;</span>, status)</a>
<a class="sourceLine" id="cb90-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb90-14" data-line-number="14">  <span class="cf">if</span> (collapsible <span class="op">&amp;&amp;</span><span class="st"> </span>collapsed) {</a>
<a class="sourceLine" id="cb90-15" data-line-number="15">    boxClass &lt;-<span class="st"> </span><span class="kw">paste</span>(boxClass, <span class="st">&quot;collapsed-box&quot;</span>)</a>
<a class="sourceLine" id="cb90-16" data-line-number="16">  }</a>
<a class="sourceLine" id="cb90-17" data-line-number="17">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(background)) {</a>
<a class="sourceLine" id="cb90-18" data-line-number="18">    boxClass &lt;-<span class="st"> </span><span class="kw">paste0</span>(boxClass, <span class="st">&quot; bg-&quot;</span>, background)</a>
<a class="sourceLine" id="cb90-19" data-line-number="19">  }</a>
<a class="sourceLine" id="cb90-20" data-line-number="20">  style &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb90-21" data-line-number="21">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(height)) {</a>
<a class="sourceLine" id="cb90-22" data-line-number="22">    style &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;height: &quot;</span>, <span class="kw">validateCssUnit</span>(height))</a>
<a class="sourceLine" id="cb90-23" data-line-number="23">  }</a>
<a class="sourceLine" id="cb90-24" data-line-number="24">  titleTag &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb90-25" data-line-number="25">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(title)) {</a>
<a class="sourceLine" id="cb90-26" data-line-number="26">    titleTag &lt;-<span class="st"> </span><span class="kw">h3</span>(<span class="dt">class =</span> <span class="st">&quot;box-title&quot;</span>, title)</a>
<a class="sourceLine" id="cb90-27" data-line-number="27">  }</a>
<a class="sourceLine" id="cb90-28" data-line-number="28">  collapseTag &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb90-29" data-line-number="29">  <span class="cf">if</span> (collapsible) {</a>
<a class="sourceLine" id="cb90-30" data-line-number="30">    buttonStatus &lt;-<span class="st"> </span>status <span class="op">%OR%</span><span class="st"> &quot;default&quot;</span></a>
<a class="sourceLine" id="cb90-31" data-line-number="31">    collapseIcon &lt;-<span class="st"> </span><span class="cf">if</span> (collapsed) </a>
<a class="sourceLine" id="cb90-32" data-line-number="32">      <span class="st">&quot;plus&quot;</span></a>
<a class="sourceLine" id="cb90-33" data-line-number="33">    <span class="cf">else</span> <span class="st">&quot;minus&quot;</span></a>
<a class="sourceLine" id="cb90-34" data-line-number="34">    collapseTag &lt;-<span class="st"> </span><span class="kw">div</span>(<span class="dt">class =</span> <span class="st">&quot;box-tools pull-right&quot;</span>, tags<span class="op">$</span><span class="kw">button</span>(<span class="dt">class =</span> <span class="kw">paste0</span>(<span class="st">&quot;btn btn-box-tool&quot;</span>), </a>
<a class="sourceLine" id="cb90-35" data-line-number="35">                                                                   <span class="st">`</span><span class="dt">data-widget</span><span class="st">`</span> =<span class="st"> &quot;collapse&quot;</span>, shiny<span class="op">::</span><span class="kw">icon</span>(collapseIcon)))</a>
<a class="sourceLine" id="cb90-36" data-line-number="36">  }</a>
<a class="sourceLine" id="cb90-37" data-line-number="37">  headerTag &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb90-38" data-line-number="38">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(titleTag) <span class="op">||</span><span class="st"> </span><span class="op">!</span><span class="kw">is.null</span>(collapseTag)) {</a>
<a class="sourceLine" id="cb90-39" data-line-number="39">    headerTag &lt;-<span class="st"> </span><span class="kw">div</span>(<span class="dt">class =</span> <span class="st">&quot;box-header&quot;</span>, titleTag, collapseTag)</a>
<a class="sourceLine" id="cb90-40" data-line-number="40">  }</a>
<a class="sourceLine" id="cb90-41" data-line-number="41">  </a>
<a class="sourceLine" id="cb90-42" data-line-number="42">  <span class="kw">div</span>(</a>
<a class="sourceLine" id="cb90-43" data-line-number="43">    <span class="dt">class =</span> <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(width)) <span class="kw">paste0</span>(<span class="st">&quot;col-sm-&quot;</span>, width), </a>
<a class="sourceLine" id="cb90-44" data-line-number="44">    <span class="kw">div</span>(</a>
<a class="sourceLine" id="cb90-45" data-line-number="45">      <span class="dt">id =</span> inputId, </a>
<a class="sourceLine" id="cb90-46" data-line-number="46">      <span class="dt">class =</span> boxClass, </a>
<a class="sourceLine" id="cb90-47" data-line-number="47">      <span class="dt">style =</span> <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(style)) </a>
<a class="sourceLine" id="cb90-48" data-line-number="48">        style, </a>
<a class="sourceLine" id="cb90-49" data-line-number="49">      headerTag, </a>
<a class="sourceLine" id="cb90-50" data-line-number="50">      <span class="kw">div</span>(<span class="dt">class =</span> <span class="st">&quot;box-body&quot;</span>, ...),</a>
<a class="sourceLine" id="cb90-51" data-line-number="51">      <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(footer)) <span class="kw">div</span>(<span class="dt">class =</span> <span class="st">&quot;box-footer&quot;</span>, footer)</a>
<a class="sourceLine" id="cb90-52" data-line-number="52">    )</a>
<a class="sourceLine" id="cb90-53" data-line-number="53">  )</a>
<a class="sourceLine" id="cb90-54" data-line-number="54">}</a></code></pre></div>
<p>Besides, we create the <code>updateBox</code> function, which will collapse the box:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1">updateBox &lt;-<span class="st"> </span><span class="cf">function</span>(inputId, <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()) {</a>
<a class="sourceLine" id="cb91-2" data-line-number="2">  session<span class="op">$</span><span class="kw">sendInputMessage</span>(inputId, <span class="dt">message =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb91-3" data-line-number="3">}</a></code></pre></div>
<p>When collapsed, a box gets the <code>collapsed-box</code> class. This will be useful for the input binding. As mentionned above, it is also necessary to know when to tell Shiny to update the value with the <code>subscribe</code> method. Most of the time, the change event might suit but as shinydashboard is built on top of <a href="https://adminlte.io/docs/2.4/js-box-widget">AdminLTE2</a>, it has an API to control box behaviour. We identify 2 events corresponding to the collapsible action:</p>
<ul>
<li>expanded.boxwidget (Triggered after the box is expanded)</li>
<li>collapsed.boxwidget (Triggered after the box is collapsed)</li>
</ul>
<p>Those events are unfortunately not possible to use since the AdminLTE code forget to trigger them in the main JS <a href="https://github.com/rstudio/shinydashboard/blob/master/srcjs/AdminLTE/app.js">code</a> (see the collapse method line 577-612). There are other solutions, as shown below with the <code>click</code> event.</p>
<p>There is also a plug and play <code>toggleBox</code> method. To unleash the power of our box, we need to activate it with <code>$('#&lt;box_id&gt;').activateBox();</code> before the binding step. If you remember, the <code>initialize</code> method is exactly doing this:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">let</span> boxBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">InputBinding</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="va">$</span>.<span class="at">extend</span>(boxBinding<span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb92-3" data-line-number="3">  <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-4" data-line-number="4">    <span class="at">$</span>(el).<span class="at">activateBox</span>()<span class="op">;</span> <span class="co">// box activation</span></a>
<a class="sourceLine" id="cb92-5" data-line-number="5">  <span class="op">},</span></a>
<a class="sourceLine" id="cb92-6" data-line-number="6">  <span class="dt">find</span><span class="op">:</span> <span class="kw">function</span>(scope) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-7" data-line-number="7">    <span class="cf">return</span> <span class="at">$</span>(scope).<span class="at">find</span>(<span class="st">&#39;.box&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-8" data-line-number="8">  <span class="op">},</span></a>
<a class="sourceLine" id="cb92-9" data-line-number="9">  <span class="dt">getValue</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-10" data-line-number="10">    <span class="kw">let</span> isCollapsed <span class="op">=</span> <span class="at">$</span>(el).<span class="at">hasClass</span>(<span class="st">&#39;collapsed-box&#39;</span>)</a>
<a class="sourceLine" id="cb92-11" data-line-number="11">    <span class="cf">return</span> <span class="op">{</span><span class="dt">collapsed</span><span class="op">:</span> isCollapsed<span class="op">};</span> <span class="co">// this will be a list in R</span></a>
<a class="sourceLine" id="cb92-12" data-line-number="12">  <span class="op">},</span></a>
<a class="sourceLine" id="cb92-13" data-line-number="13">  <span class="dt">setValue</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-14" data-line-number="14">    <span class="at">$</span>(el).<span class="at">toggleBox</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb92-15" data-line-number="15">  <span class="op">},</span> </a>
<a class="sourceLine" id="cb92-16" data-line-number="16">  <span class="dt">receiveMessage</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-17" data-line-number="17">    <span class="kw">this</span>.<span class="at">setValue</span>(el<span class="op">,</span> data)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-18" data-line-number="18">    <span class="at">$</span>(el).<span class="at">trigger</span>(<span class="st">&#39;change&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-19" data-line-number="19">  <span class="op">},</span></a>
<a class="sourceLine" id="cb92-20" data-line-number="20">  <span class="dt">subscribe</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-21" data-line-number="21">    <span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="st">&#39;[data-widget=&quot;collapse&quot;]&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-22" data-line-number="22">      <span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb92-23" data-line-number="23">        <span class="at">callback</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb92-24" data-line-number="24">      <span class="op">},</span> <span class="dv">550</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-25" data-line-number="25">    <span class="op">}</span>)<span class="op">;</span> </a>
<a class="sourceLine" id="cb92-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb92-27" data-line-number="27">    <span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-28" data-line-number="28">      <span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb92-29" data-line-number="29">        <span class="at">callback</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb92-30" data-line-number="30">      <span class="op">},</span> <span class="dv">550</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-31" data-line-number="31">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-32" data-line-number="32">  <span class="op">},</span></a>
<a class="sourceLine" id="cb92-33" data-line-number="33">  <span class="dt">unsubscribe</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></a>
<a class="sourceLine" id="cb92-34" data-line-number="34">    <span class="at">$</span>(el).<span class="at">off</span>(<span class="st">&#39;.boxBinding&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-35" data-line-number="35">  <span class="op">}</span></a>
<a class="sourceLine" id="cb92-36" data-line-number="36"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb92-37" data-line-number="37"></a>
<a class="sourceLine" id="cb92-38" data-line-number="38"><span class="va">Shiny</span>.<span class="va">inputBindings</span>.<span class="at">register</span>(boxBinding<span class="op">,</span> <span class="st">&#39;box-input&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Some comments about the binding:</p>
<ul>
<li><code>getValue</code> returns an object which will give a list in R. This is in case we add other elements like the remove action available in AdminLTE</li>
<li><code>setValue</code> calls the plug and play <code>toggleBox</code> method</li>
<li><code>receiveMessage</code> must trigger a change event so that Shiny knows when the value needs to be updated</li>
<li><code>subscribe</code> listens to the <code>click</code> event on the <code>[data-widget=&quot;collapse&quot;]</code> element and delays the <code>callback</code> call by a value which is slightly higher than the default AdminLTE2 animation to collapse the box (500mx). If you omit this part, the input will not have time to properly update!!!</li>
<li>We don’t need extra listener for the <code>updateBox</code> function since it also triggers a click on the collapse button, thereby forwarding to the corresponding listener</li>
</ul>
<p>Let’s try our new toy in a simple dashboard:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">shinyApp</span>(</a>
<a class="sourceLine" id="cb93-2" data-line-number="2">  <span class="dt">ui =</span> <span class="kw">dashboardPage</span>(</a>
<a class="sourceLine" id="cb93-3" data-line-number="3">    <span class="kw">dashboardHeader</span>(),</a>
<a class="sourceLine" id="cb93-4" data-line-number="4">    <span class="kw">dashboardSidebar</span>(),</a>
<a class="sourceLine" id="cb93-5" data-line-number="5">    <span class="kw">dashboardBody</span>(</a>
<a class="sourceLine" id="cb93-6" data-line-number="6">      tags<span class="op">$</span><span class="kw">script</span>(</a>
<a class="sourceLine" id="cb93-7" data-line-number="7">        <span class="st">&quot;$(function() {</span></a>
<a class="sourceLine" id="cb93-8" data-line-number="8"><span class="st">          let boxBinding = new Shiny.InputBinding();</span></a>
<a class="sourceLine" id="cb93-9" data-line-number="9"><span class="st">          $.extend(boxBinding, {</span></a>
<a class="sourceLine" id="cb93-10" data-line-number="10"><span class="st">            initialize: function(el) {</span></a>
<a class="sourceLine" id="cb93-11" data-line-number="11"><span class="st">              $(el).activateBox();</span></a>
<a class="sourceLine" id="cb93-12" data-line-number="12"><span class="st">            },</span></a>
<a class="sourceLine" id="cb93-13" data-line-number="13"><span class="st">            find: function(scope) {</span></a>
<a class="sourceLine" id="cb93-14" data-line-number="14"><span class="st">              return $(scope).find(&#39;.box&#39;);</span></a>
<a class="sourceLine" id="cb93-15" data-line-number="15"><span class="st">            },</span></a>
<a class="sourceLine" id="cb93-16" data-line-number="16"><span class="st">            getValue: function(el) {</span></a>
<a class="sourceLine" id="cb93-17" data-line-number="17"><span class="st">              let isCollapsed = $(el).hasClass(&#39;collapsed-box&#39;);</span></a>
<a class="sourceLine" id="cb93-18" data-line-number="18"><span class="st">              return {collapsed: isCollapsed}; // this will be a list in R</span></a>
<a class="sourceLine" id="cb93-19" data-line-number="19"><span class="st">            },</span></a>
<a class="sourceLine" id="cb93-20" data-line-number="20"><span class="st">            setValue: function(el, value) {</span></a>
<a class="sourceLine" id="cb93-21" data-line-number="21"><span class="st">              $(el).toggleBox();</span></a>
<a class="sourceLine" id="cb93-22" data-line-number="22"><span class="st">            }, </span></a>
<a class="sourceLine" id="cb93-23" data-line-number="23"><span class="st">            receiveMessage: function(el, data) {</span></a>
<a class="sourceLine" id="cb93-24" data-line-number="24"><span class="st">              this.setValue(el, data);</span></a>
<a class="sourceLine" id="cb93-25" data-line-number="25"><span class="st">              $(el).trigger(&#39;change&#39;);</span></a>
<a class="sourceLine" id="cb93-26" data-line-number="26"><span class="st">            },</span></a>
<a class="sourceLine" id="cb93-27" data-line-number="27"><span class="st">            subscribe: function(el, callback) {</span></a>
<a class="sourceLine" id="cb93-28" data-line-number="28"><span class="st">              $(el).on(&#39;click&#39;, &#39;[data-widget=</span><span class="ch">\&quot;</span><span class="st">collapse</span><span class="ch">\&quot;</span><span class="st">]&#39;, function(event) {</span></a>
<a class="sourceLine" id="cb93-29" data-line-number="29"><span class="st">                setTimeout(function() {</span></a>
<a class="sourceLine" id="cb93-30" data-line-number="30"><span class="st">                  callback();</span></a>
<a class="sourceLine" id="cb93-31" data-line-number="31"><span class="st">                }, 550);</span></a>
<a class="sourceLine" id="cb93-32" data-line-number="32"><span class="st">              }); </span></a>
<a class="sourceLine" id="cb93-33" data-line-number="33"><span class="st">              $(el).on(&#39;change&#39;, function(event) {</span></a>
<a class="sourceLine" id="cb93-34" data-line-number="34"><span class="st">                setTimeout(function() {</span></a>
<a class="sourceLine" id="cb93-35" data-line-number="35"><span class="st">                  callback();</span></a>
<a class="sourceLine" id="cb93-36" data-line-number="36"><span class="st">                }, 550);</span></a>
<a class="sourceLine" id="cb93-37" data-line-number="37"><span class="st">              });</span></a>
<a class="sourceLine" id="cb93-38" data-line-number="38"><span class="st">            },</span></a>
<a class="sourceLine" id="cb93-39" data-line-number="39"><span class="st">            unsubscribe: function(el) {</span></a>
<a class="sourceLine" id="cb93-40" data-line-number="40"><span class="st">              $(el).off(&#39;.boxBinding&#39;);</span></a>
<a class="sourceLine" id="cb93-41" data-line-number="41"><span class="st">            }</span></a>
<a class="sourceLine" id="cb93-42" data-line-number="42"><span class="st">          });</span></a>
<a class="sourceLine" id="cb93-43" data-line-number="43"><span class="st">          </span></a>
<a class="sourceLine" id="cb93-44" data-line-number="44"><span class="st">          Shiny.inputBindings.register(boxBinding, &#39;box-input&#39;);</span></a>
<a class="sourceLine" id="cb93-45" data-line-number="45"><span class="st">        });</span></a>
<a class="sourceLine" id="cb93-46" data-line-number="46"><span class="st">        &quot;</span></a>
<a class="sourceLine" id="cb93-47" data-line-number="47">      ),</a>
<a class="sourceLine" id="cb93-48" data-line-number="48">      </a>
<a class="sourceLine" id="cb93-49" data-line-number="49">      <span class="kw">box2</span>(</a>
<a class="sourceLine" id="cb93-50" data-line-number="50">        <span class="dt">title =</span> <span class="kw">textOutput</span>(<span class="st">&quot;box_state&quot;</span>),</a>
<a class="sourceLine" id="cb93-51" data-line-number="51">        <span class="st">&quot;Box body&quot;</span>,</a>
<a class="sourceLine" id="cb93-52" data-line-number="52">        <span class="dt">inputId =</span> <span class="st">&quot;mybox&quot;</span>,</a>
<a class="sourceLine" id="cb93-53" data-line-number="53">        <span class="dt">collapsible =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb93-54" data-line-number="54">        <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</a>
<a class="sourceLine" id="cb93-55" data-line-number="55">      ),</a>
<a class="sourceLine" id="cb93-56" data-line-number="56">      <span class="kw">actionButton</span>(<span class="st">&quot;toggle_box&quot;</span>, <span class="st">&quot;Toggle Box&quot;</span>)</a>
<a class="sourceLine" id="cb93-57" data-line-number="57">    ),</a>
<a class="sourceLine" id="cb93-58" data-line-number="58">    <span class="dt">title =</span> <span class="st">&quot;Dashboard example&quot;</span></a>
<a class="sourceLine" id="cb93-59" data-line-number="59">  ),</a>
<a class="sourceLine" id="cb93-60" data-line-number="60">  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {</a>
<a class="sourceLine" id="cb93-61" data-line-number="61">    </a>
<a class="sourceLine" id="cb93-62" data-line-number="62">    output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</a>
<a class="sourceLine" id="cb93-63" data-line-number="63">      <span class="kw">req</span>(<span class="op">!</span>input<span class="op">$</span>mybox<span class="op">$</span>collapsed)</a>
<a class="sourceLine" id="cb93-64" data-line-number="64">      <span class="kw">plot</span>(<span class="kw">rnorm</span>(<span class="dv">200</span>))</a>
<a class="sourceLine" id="cb93-65" data-line-number="65">    })</a>
<a class="sourceLine" id="cb93-66" data-line-number="66">    </a>
<a class="sourceLine" id="cb93-67" data-line-number="67">    output<span class="op">$</span>box_state &lt;-<span class="st"> </span><span class="kw">renderText</span>({</a>
<a class="sourceLine" id="cb93-68" data-line-number="68">      state &lt;-<span class="st"> </span><span class="cf">if</span> (input<span class="op">$</span>mybox<span class="op">$</span>collapsed) <span class="st">&quot;collapsed&quot;</span> <span class="cf">else</span> <span class="st">&quot;uncollapsed&quot;</span></a>
<a class="sourceLine" id="cb93-69" data-line-number="69">      <span class="kw">paste</span>(<span class="st">&quot;My box is&quot;</span>, state)</a>
<a class="sourceLine" id="cb93-70" data-line-number="70">    })</a>
<a class="sourceLine" id="cb93-71" data-line-number="71">    </a>
<a class="sourceLine" id="cb93-72" data-line-number="72">    <span class="kw">observeEvent</span>(input<span class="op">$</span>toggle_box, {</a>
<a class="sourceLine" id="cb93-73" data-line-number="73">      <span class="kw">updateBox</span>(<span class="st">&quot;mybox&quot;</span>)</a>
<a class="sourceLine" id="cb93-74" data-line-number="74">    })</a>
<a class="sourceLine" id="cb93-75" data-line-number="75">    </a>
<a class="sourceLine" id="cb93-76" data-line-number="76">  }</a>
<a class="sourceLine" id="cb93-77" data-line-number="77">)</a></code></pre></div>
</div>
</div>
<div id="utilities-to-quickly-define-new-inputs" class="section level3">
<h3><span class="header-section-number">4.4.5</span> Utilities to quickly define new inputs</h3>
<p>If you ever wondered where the <code>Shiny.onInputChange</code> or <code>Shiny.setInputValue</code> comes from (see <a href="https://shiny.rstudio.com/articles/communicating-with-js.html">article</a>), it is actually defined in the <code>initShiny</code> function.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="va">exports</span>.<span class="at">setInputValue</span> <span class="op">=</span> <span class="va">exports</span>.<span class="at">onInputChange</span> <span class="op">=</span> <span class="kw">function</span>(name<span class="op">,</span> value<span class="op">,</span> opts) <span class="op">{</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2">opts <span class="op">=</span> <span class="at">addDefaultInputOpts</span>(opts)<span class="op">;</span></a>
<a class="sourceLine" id="cb94-3" data-line-number="3"><span class="va">inputs</span>.<span class="at">setInput</span>(name<span class="op">,</span> value<span class="op">,</span> opts)<span class="op">;</span></a>
<a class="sourceLine" id="cb94-4" data-line-number="4"><span class="op">};</span></a></code></pre></div>
<p>Briefly, this function avoids to create an input binding. It is faster to code but there is a price to pay: you lose the possibility to easily update the new input. Indeed, all input functions like <code>sliderInput</code> have their own update function like <code>updateSliderInput</code>, because of the custom input binding system (We will see it very soon)!</p>
</div>
<div id="miscellaneous" class="section level3">
<h3><span class="header-section-number">4.4.6</span> Miscellaneous</h3>
<p>We present here some tools that may be useful…TO FINISH</p>
<div id="get-access-to-initial-values" class="section level4">
<h4><span class="header-section-number">4.4.6.1</span> Get access to initial values</h4>
<p>Something we may notice when exploring the <code>initShiny</code> function is the existence of a <code>Shiny.shinyapp</code> object, defined as follows:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">var</span> shinyapp <span class="op">=</span> <span class="va">exports</span>.<span class="at">shinyapp</span> <span class="op">=</span> <span class="kw">new</span> <span class="at">ShinyApp</span>()<span class="op">;</span></a></code></pre></div>
<p>Let’s explore what <code>shinyApp</code> contains. The definition is located in the shinyapps.js <a href="https://github.com/rstudio/shiny/blob/master/srcjs/shinyapp.js">script</a>.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw">var</span> ShinyApp <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="kw">this</span>.<span class="at">$socket</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a>
<a class="sourceLine" id="cb96-3" data-line-number="3"></a>
<a class="sourceLine" id="cb96-4" data-line-number="4"><span class="co">// Cached input values</span></a>
<a class="sourceLine" id="cb96-5" data-line-number="5"><span class="kw">this</span>.<span class="at">$inputValues</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb96-6" data-line-number="6"></a>
<a class="sourceLine" id="cb96-7" data-line-number="7"><span class="co">// Input values at initialization (and reconnect)</span></a>
<a class="sourceLine" id="cb96-8" data-line-number="8"><span class="kw">this</span>.<span class="at">$initialInput</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb96-9" data-line-number="9"></a>
<a class="sourceLine" id="cb96-10" data-line-number="10"><span class="co">// Output bindings</span></a>
<a class="sourceLine" id="cb96-11" data-line-number="11"><span class="kw">this</span>.<span class="at">$bindings</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb96-12" data-line-number="12"></a>
<a class="sourceLine" id="cb96-13" data-line-number="13"><span class="co">// Cached values/errors</span></a>
<a class="sourceLine" id="cb96-14" data-line-number="14"><span class="kw">this</span>.<span class="at">$values</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb96-15" data-line-number="15"><span class="kw">this</span>.<span class="at">$errors</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb96-16" data-line-number="16"></a>
<a class="sourceLine" id="cb96-17" data-line-number="17"><span class="co">// Conditional bindings (show/hide element based on expression)</span></a>
<a class="sourceLine" id="cb96-18" data-line-number="18"><span class="kw">this</span>.<span class="at">$conditionals</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb96-19" data-line-number="19"></a>
<a class="sourceLine" id="cb96-20" data-line-number="20"><span class="kw">this</span>.<span class="at">$pendingMessages</span> <span class="op">=</span> []<span class="op">;</span></a>
<a class="sourceLine" id="cb96-21" data-line-number="21"><span class="kw">this</span>.<span class="at">$activeRequests</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb96-22" data-line-number="22"><span class="kw">this</span>.<span class="at">$nextRequestId</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb96-23" data-line-number="23"></a>
<a class="sourceLine" id="cb96-24" data-line-number="24"><span class="kw">this</span>.<span class="at">$allowReconnect</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb96-25" data-line-number="25"><span class="op">};</span></a></code></pre></div>
<p>It creates several properties, some of them are easy to guess like <code>inputValues</code> or <code>initialInput</code>. Let’s run the example below and open the HTML inspector. Notice that the <code>sliderInput</code> is set to 500 at <code>t0</code> (initialization).</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</a>
<a class="sourceLine" id="cb97-2" data-line-number="2">  <span class="kw">sliderInput</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>,</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">              <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1000</span>, <span class="dt">value =</span> <span class="dv">500</span></a>
<a class="sourceLine" id="cb97-4" data-line-number="4">  ),</a>
<a class="sourceLine" id="cb97-5" data-line-number="5">  <span class="kw">plotOutput</span>(<span class="st">&quot;distPlot&quot;</span>)</a>
<a class="sourceLine" id="cb97-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb97-7" data-line-number="7"></a>
<a class="sourceLine" id="cb97-8" data-line-number="8">server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</a>
<a class="sourceLine" id="cb97-9" data-line-number="9">  output<span class="op">$</span>distPlot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</a>
<a class="sourceLine" id="cb97-10" data-line-number="10">    <span class="kw">hist</span>(<span class="kw">rnorm</span>(input<span class="op">$</span>obs))</a>
<a class="sourceLine" id="cb97-11" data-line-number="11">  })</a>
<a class="sourceLine" id="cb97-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb97-13" data-line-number="13"><span class="kw">shinyApp</span>(ui, server)</a></code></pre></div>
<p>Figure <a href="survival-kit-shiny.html#fig:shiny-initial-inputs">4.8</a> shows how to access Shiny’s initial input value with <code>Shiny.shinyapp.$initialInput.obs</code>. After changing the slider position, its value is given by <code>Shiny.shinyapp.$inputValues.obs</code>. <code>$initialInput</code> and <code>$inputValues</code> contains way more elements but we are only interested by the slider in this example.</p>
<div class="figure"><span id="fig:shiny-initial-inputs"></span>
<img src="images/survival-kit/shiny-init-input.png" alt="Explore initial input values" width="994" />
<p class="caption">
Figure 4.8: Explore initial input values
</p>
</div>
<p>I acknowledge, the practical interest might be limited but still good to know for debugging purposes.</p>
</div>
</div>
</div>
<div id="custom-handlers-from-r-to-javascript" class="section level2">
<h2><span class="header-section-number">4.5</span> Custom handlers: from R to JavaScript</h2>
<p>Shiny contains tools to ease the communication between R and JavaScript. This is what happens in the last part. If you remember, we were playing with a <code>selectInput</code> and a <code>datatable</code>. How does R send messages to JavaScript?</p>
<p>Shiny is made of input and output. Yet there is a third parameter you can pass to the server function called session. The <a href="https://shiny.rstudio.com/reference/shiny/1.4.0/session.html">session</a> object contains informations on the current session like clientData, the namespace ns (if working inside modules), as well as methods (yes methods since session is an R6 class). Among those methods, we are interested by 2 of them:</p>
<ul>
<li><code>sendCustomMessage(type, message)</code>: &gt; Custom messages have no meaning to Shiny itself; they are used soley to convey information to custom JavaScript logic in the browser</li>
<li><code>sendInputMessage()</code>: &gt; if the input is present and bound on the page at the time the message is received, then the input binding object’s receiveMessage(el, message) method will be called</li>
</ul>
<p>While <code>sendInputMessage</code> is the R side of the input features, <code>sendCustomMessage</code> simply allows to communicate between R and JavaScript.
Basically a R function :</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">sayHelloToJS &lt;-<span class="st"> </span><span class="cf">function</span>(text, session) {</a>
<a class="sourceLine" id="cb98-2" data-line-number="2">  session<span class="op">$</span><span class="kw">sendCustomMessage</span>(<span class="dt">type =</span> <span class="st">&#39;say-hello&#39;</span>, <span class="dt">message =</span> text)</a>
<a class="sourceLine" id="cb98-3" data-line-number="3">}</a></code></pre></div>
<p>We need a JavaScript receptor, handle by the <code>addCustomMessageHandler</code> method:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="va">Shiny</span>.<span class="at">AddCustomMessageHandler</span>(<span class="st">&#39;say-hello&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="at">alert</span>(<span class="vs">`R says </span><span class="sc">${</span>message<span class="sc">}</span><span class="vs"> to you!`</span>)</a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="op">}</span>)</a></code></pre></div>
<p>The type parameter is obviously critical to make the connection between R and JavaScript and 2 different message handlers must have different types to avoid conflicts.</p>
<p>TO DO: picture showing the communication</p>

</div>
</div>




</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>Refer to Chapter <a href="survival-kit-javascript.html#survival-kit-javascript">3</a> if you don’t remember how to export an object and make it available to all JS files.<a href="survival-kit-shiny.html#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="survival-kit-javascript.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="htmltools-overview.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/survival-kit-shiny.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["outstanding-shiny-ui.pdf", "outstanding-shiny-ui.epub", "outstanding-shiny-ui.mobi"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
