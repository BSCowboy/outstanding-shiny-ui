<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 24 Reconstruct {shinyMobile} | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/core-js-2.5.3/shim.min.js"></script><script src="libs/react-16.12.0/react.min.js"></script><script src="libs/react-16.12.0/react-dom.min.js"></script><script src="libs/reactwidget-1.0.0/react-tools.js"></script><link href="libs/font-awesome-5.13.0/css/all.min.css" rel="stylesheet">
<link href="libs/font-awesome-5.13.0/css/v4-shims.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="css/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">2</span> Discover Shiny dependencies</a></li>
<li class="book-part">From R to HTML: discover and master {htmltools}:</li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">3</span> htmltools overview</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li class="book-part">Beautify with CSS and Sass</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">5</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">6</span> Introduction to SASS</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">7</span> Beautify with {fresh}</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">8</span> Beautify with {bslib}</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">9</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">10</span> R and JS</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">11</span> Shinyâ€™s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">12</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">13</span> Hidden gems about inputs</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">14</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">15</span> Template selection</a></li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">16</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">17</span> Template skeleton</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">18</span> Testing and validating templates elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">19</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">20</span> Adding more interactivity</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">21</span> Introduction to {charpente}</a></li>
<li><a class="" href="workflow-rpg.html"><span class="header-section-number">22</span> A RPG game with Shiny</a></li>
<li class="book-part">Case study 2: Mobile development with Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="active" href="mobile-shinyMobile.html"><span class="header-section-number">24</span> Reconstruct {shinyMobile}</a></li>
<li><a class="" href="mobile-pwa.html"><span class="header-section-number">25</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">26</span> Design widgets</a></li>
<li><a class="" href="mobile-going-further.html"><span class="header-section-number">27</span> Going further</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">28</span> R + Shiny + React: welcome {reactR}</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mobile-shinyMobile" class="section level1">
<h1>
<span class="header-section-number">24</span> Reconstruct <code>{shinyMobile}</code><a class="anchor" aria-label="anchor" href="#mobile-shinyMobile"><i class="fas fa-link"></i></a>
</h1>
<div class="importantblock">
<p>This section has been written and tested with Framework7 <code>5.7.14</code>.
Some feature may change in future releases.
However, fear not, the process follows the same general principles.</p>
</div>
<div class="warningbox">
<p>As a reminder, the code examples shown throughout this chapter are gathered in the <code>{OSUICode}</code> package accessible <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code">here</a>.</p>
</div>
<div id="introduction-to-framework7" class="section level2">
<h2>
<span class="header-section-number">24.1</span> Introduction to Framework7<a class="anchor" aria-label="anchor" href="#introduction-to-framework7"><i class="fas fa-link"></i></a>
</h2>
<p>Framework7 is the HTML/CSS/JavaScript engine that fuels <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a>.
It is a flexible toolkit to build native looking web apps or progressive
web apps (PWA). It has an incredibly rich ecosystem:</p>
<ul>
<li>Provides a core JavaScript API, React API, Vue API, Svelte API.</li>
<li>A CLI to ease the creation of PWA, provide boilerplate and started templates.</li>
<li>A full set of native <a href="https://framework7.io/icons/">icons</a>.</li>
<li>Hundreds of components with different look for iOS and material design, even desktop.</li>
<li>A comprehensive set of <a href="https://framework7.io/docs/">documentation</a>.</li>
<li>A supportive <a href="https://forum.framework7.io/">community</a>.</li>
</ul>
</div>
<div id="initiate-the-package" class="section level2">
<h2>
<span class="header-section-number">24.2</span> Initiate the package<a class="anchor" aria-label="anchor" href="#initiate-the-package"><i class="fas fa-link"></i></a>
</h2>
<p>This is time to initialize the package structure and extract the Framework7 dependencies.
To get an idea of the package file structure, we run:</p>
<div class="sourceCode" id="cb570"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/charpente">charpente</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/get_dependency_assets.html">get_dependency_assets</a></span><span class="op">(</span><span class="st">"framework7"</span><span class="op">)</span></code></pre></div>
<pre><code>## â„¹ Trying with https://data.jsdelivr.com/v1/package/npm/framework7</code></pre>
<pre><code>## âœ“ Success!</code></pre>
<pre><code>## â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</code></pre>
<pre><code>## $url
## [1] "https://cdn.jsdelivr.net/npm/framework7@6.0.11/"
## 
## $files
##  [1] "esm"                           "core"                         
##  [3] "components"                    "cjs"                          
##  [5] "bundle"                        "less"                         
##  [7] "lite"                          "lite-bundle"                  
##  [9] "modules"                       "types"                        
## [11] "framework7.css"                "framework7.d.ts"              
## [13] "framework7.js"                 "framework7.js.map"            
## [15] "framework7.less"               "framework7.min.css"           
## [17] "framework7.min.js"             "framework7.min.js.map"        
## [19] "framework7-bundle.css"         "framework7-bundle.js"         
## [21] "framework7-bundle.js.map"      "framework7-bundle.less"       
## [23] "framework7-bundle.min.css"     "framework7-bundle.min.js"     
## [25] "framework7-bundle.min.js.map"  "framework7-bundle-rtl.css"    
## [27] "framework7-bundle-rtl.min.css" "framework7-rtl.css"           
## [29] "framework7-rtl.min.css"        "LICENSE"                      
## [31] "package.json"                  "postinstall.js"               
## [33] "README.md"                    
## 
## $hasSubfolders
## [1] FALSE</code></pre>
<p>We browse to the <a href="https://framework7.io/docs/package.html">package</a> structure page,
which provides details about necessary components. We are going to use the bundle version since
the lite approach is missing several components, particularly Framework7 widgets. We therefore only need <code>framework7.bundle.min.js</code> and <code>framework7.bundle.min.css</code>, which is the <code>create_dependency</code> default options:</p>
<div class="sourceCode" id="cb575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"shinyMobile"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_charpente.html">create_charpente</a></span><span class="op">(</span><span class="va">path</span>, license <span class="op">=</span> <span class="st">"mit"</span><span class="op">)</span></code></pre></div>
<p>Once the package created and opened, we download Framework7 dependencies, specifying
the latest stable version, that is <code>5.7.14</code>, and targeting <code>bundle.min</code> files:</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency</a></span><span class="op">(</span><span class="st">"framework7"</span>, tag <span class="op">=</span> <span class="st">"5.7.14"</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/charpente/man/charpente_options.html">charpente_options</a></span><span class="op">(</span>bundle <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Besides, this generates the <code>framework7-dependencies.R</code> script:</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">add_framework7_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">framework7_deps</span> <span class="op">&lt;-</span> <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"framework7"</span>,
  version <span class="op">=</span> <span class="st">"5.7.14"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"framework7-5.7.14"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"js/framework7.bundle.min.js"</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/framework7.bundle.min.css"</span>,
  package <span class="op">=</span> <span class="st">"shinyMobile"</span>,
 <span class="op">)</span>
 <span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">framework7_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="framework7-layouts" class="section level2">
<h2>
<span class="header-section-number">24.3</span> Framework7 Layouts<a class="anchor" aria-label="anchor" href="#framework7-layouts"><i class="fas fa-link"></i></a>
</h2>
<p>Framework7 has three predefined layouts (Figure <a href="mobile-shinyMobile.html#fig:mobile-framework7-layouts">24.1</a>):</p>
<ul>
<li>
<strong>Single page</strong> layout.</li>
<li>
<strong>Multi tabs</strong> layout.</li>
<li>
<strong>Split</strong> layout, targeting tablet/desktop. It is composed of a sidebar and a main panel.</li>
</ul>
<div class="figure">
<span id="fig:mobile-framework7-layouts"></span>
<img src="images/mobile/mobile-shinymobile-single-layout.png" alt="Framework7 layouts" width="33%"><img src="images/mobile/mobile-shinymobile-tabs-layout.png" alt="Framework7 layouts" width="33%"><img src="images/mobile/mobile-shinymobile-split-layout.png" alt="Framework7 layouts" width="33%"><p class="caption">
FIGURE 24.1: Framework7 layouts
</p>
</div>
<p>Letâ€™s start simple and choose the single page layout, whose corresponding HTML is
given by:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb578-1"><a href="mobile-shinyMobile.html#cb578-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb578-2"><a href="mobile-shinyMobile.html#cb578-2"></a><span class="kw">&lt;html&gt;</span></span>
<span id="cb578-3"><a href="mobile-shinyMobile.html#cb578-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb578-4"><a href="mobile-shinyMobile.html#cb578-4"></a>    <span class="co">&lt;!-- Required meta tags--&gt;</span></span>
<span id="cb578-5"><a href="mobile-shinyMobile.html#cb578-5"></a>    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">"utf-8"</span><span class="kw">&gt;</span></span>
<span id="cb578-6"><a href="mobile-shinyMobile.html#cb578-6"></a>    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"viewport"</span><span class="ot"> content=</span><span class="st">"width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover"</span><span class="kw">&gt;</span></span>
<span id="cb578-7"><a href="mobile-shinyMobile.html#cb578-7"></a>    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"apple-mobile-web-app-capable"</span><span class="ot"> content=</span><span class="st">"yes"</span><span class="kw">&gt;</span></span>
<span id="cb578-8"><a href="mobile-shinyMobile.html#cb578-8"></a>    <span class="co">&lt;!-- Color theme for statusbar (Android only) --&gt;</span></span>
<span id="cb578-9"><a href="mobile-shinyMobile.html#cb578-9"></a>    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"theme-color"</span><span class="ot"> content=</span><span class="st">"#2196f3"</span><span class="kw">&gt;</span></span>
<span id="cb578-10"><a href="mobile-shinyMobile.html#cb578-10"></a>    <span class="co">&lt;!-- Your app title --&gt;</span></span>
<span id="cb578-11"><a href="mobile-shinyMobile.html#cb578-11"></a>    <span class="kw">&lt;title&gt;</span>My App<span class="kw">&lt;/title&gt;</span></span>
<span id="cb578-12"><a href="mobile-shinyMobile.html#cb578-12"></a>    <span class="co">&lt;!-- Path to Framework7 Library Bundle CSS --&gt;</span></span>
<span id="cb578-13"><a href="mobile-shinyMobile.html#cb578-13"></a>    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span><span class="ot"> href=</span><span class="st">"path/to/framework7.bundle.min.css"</span><span class="kw">&gt;</span></span>
<span id="cb578-14"><a href="mobile-shinyMobile.html#cb578-14"></a>    <span class="co">&lt;!-- Path to your custom app styles--&gt;</span></span>
<span id="cb578-15"><a href="mobile-shinyMobile.html#cb578-15"></a>    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">"stylesheet"</span><span class="ot"> href=</span><span class="st">"path/to/my-app.css"</span><span class="kw">&gt;</span></span>
<span id="cb578-16"><a href="mobile-shinyMobile.html#cb578-16"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb578-17"><a href="mobile-shinyMobile.html#cb578-17"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb578-18"><a href="mobile-shinyMobile.html#cb578-18"></a>    <span class="co">&lt;!-- App root element --&gt;</span></span>
<span id="cb578-19"><a href="mobile-shinyMobile.html#cb578-19"></a>    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">"app"</span><span class="kw">&gt;</span></span>
<span id="cb578-20"><a href="mobile-shinyMobile.html#cb578-20"></a></span>
<span id="cb578-21"><a href="mobile-shinyMobile.html#cb578-21"></a>      <span class="co">&lt;!-- Your main view, should have "view-main" class --&gt;</span></span>
<span id="cb578-22"><a href="mobile-shinyMobile.html#cb578-22"></a>      <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"view view-main"</span><span class="kw">&gt;</span></span>
<span id="cb578-23"><a href="mobile-shinyMobile.html#cb578-23"></a>        <span class="co">&lt;!-- Initial Page, "data-name" contains page name --&gt;</span></span>
<span id="cb578-24"><a href="mobile-shinyMobile.html#cb578-24"></a>        <span class="kw">&lt;div</span><span class="ot"> data-name=</span><span class="st">"home"</span><span class="ot"> class=</span><span class="st">"page"</span><span class="kw">&gt;</span></span>
<span id="cb578-25"><a href="mobile-shinyMobile.html#cb578-25"></a></span>
<span id="cb578-26"><a href="mobile-shinyMobile.html#cb578-26"></a>          <span class="co">&lt;!-- Top Navbar --&gt;</span></span>
<span id="cb578-27"><a href="mobile-shinyMobile.html#cb578-27"></a>          <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"navbar"</span><span class="kw">&gt;</span></span>
<span id="cb578-28"><a href="mobile-shinyMobile.html#cb578-28"></a>            <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"navbar-bg"</span><span class="kw">&gt;&lt;/div&gt;</span></span>
<span id="cb578-29"><a href="mobile-shinyMobile.html#cb578-29"></a>            <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"navbar-inner"</span><span class="kw">&gt;</span></span>
<span id="cb578-30"><a href="mobile-shinyMobile.html#cb578-30"></a>              <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"title"</span><span class="kw">&gt;</span>Awesome App<span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-31"><a href="mobile-shinyMobile.html#cb578-31"></a>            <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-32"><a href="mobile-shinyMobile.html#cb578-32"></a>          <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-33"><a href="mobile-shinyMobile.html#cb578-33"></a></span>
<span id="cb578-34"><a href="mobile-shinyMobile.html#cb578-34"></a>          <span class="co">&lt;!-- Bottom Toolbar --&gt;</span></span>
<span id="cb578-35"><a href="mobile-shinyMobile.html#cb578-35"></a>          <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"toolbar toolbar-bottom"</span><span class="kw">&gt;</span></span>
<span id="cb578-36"><a href="mobile-shinyMobile.html#cb578-36"></a>            <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"toolbar-inner"</span><span class="kw">&gt;</span></span>
<span id="cb578-37"><a href="mobile-shinyMobile.html#cb578-37"></a>              <span class="co">&lt;!-- Toolbar links --&gt;</span></span>
<span id="cb578-38"><a href="mobile-shinyMobile.html#cb578-38"></a>              <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">"#"</span><span class="ot"> class=</span><span class="st">"link"</span><span class="kw">&gt;</span>Link 1<span class="kw">&lt;/a&gt;</span></span>
<span id="cb578-39"><a href="mobile-shinyMobile.html#cb578-39"></a>              <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">"#"</span><span class="ot"> class=</span><span class="st">"link"</span><span class="kw">&gt;</span>Link 2<span class="kw">&lt;/a&gt;</span></span>
<span id="cb578-40"><a href="mobile-shinyMobile.html#cb578-40"></a>            <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-41"><a href="mobile-shinyMobile.html#cb578-41"></a>          <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-42"><a href="mobile-shinyMobile.html#cb578-42"></a></span>
<span id="cb578-43"><a href="mobile-shinyMobile.html#cb578-43"></a>          <span class="co">&lt;!-- Scrollable page content --&gt;</span></span>
<span id="cb578-44"><a href="mobile-shinyMobile.html#cb578-44"></a>          <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">"page-content"</span><span class="kw">&gt;</span></span>
<span id="cb578-45"><a href="mobile-shinyMobile.html#cb578-45"></a>            <span class="kw">&lt;p&gt;</span>Page content goes here<span class="kw">&lt;/p&gt;</span></span>
<span id="cb578-46"><a href="mobile-shinyMobile.html#cb578-46"></a>            <span class="co">&lt;!-- Link to another page --&gt;</span></span>
<span id="cb578-47"><a href="mobile-shinyMobile.html#cb578-47"></a>            <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">"/about/"</span><span class="kw">&gt;</span>About app<span class="kw">&lt;/a&gt;</span></span>
<span id="cb578-48"><a href="mobile-shinyMobile.html#cb578-48"></a>          <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-49"><a href="mobile-shinyMobile.html#cb578-49"></a>        <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-50"><a href="mobile-shinyMobile.html#cb578-50"></a>      <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-51"><a href="mobile-shinyMobile.html#cb578-51"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb578-52"><a href="mobile-shinyMobile.html#cb578-52"></a>    <span class="co">&lt;!-- Path to Framework7 Library Bundle JS--&gt;</span></span>
<span id="cb578-53"><a href="mobile-shinyMobile.html#cb578-53"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">"text/javascript"</span><span class="ot"> src=</span><span class="st">"path/to/framework7.bundle.min.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb578-54"><a href="mobile-shinyMobile.html#cb578-54"></a>    <span class="co">&lt;!-- Path to your app js--&gt;</span></span>
<span id="cb578-55"><a href="mobile-shinyMobile.html#cb578-55"></a>    <span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">"text/javascript"</span><span class="ot"> src=</span><span class="st">"path/to/my-app.js"</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb578-56"><a href="mobile-shinyMobile.html#cb578-56"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb578-57"><a href="mobile-shinyMobile.html#cb578-57"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>The <code>head</code> tag contains meta tags, some of them required for the PWA features, discussed in the next Chapter <a href="mobile-pwa.html#mobile-pwa">25</a>.
The most important part is the dependencies that will be included there. Note that
the order matters: Framework7 dependencies go first, other dependencies follow.
The <code>body</code> tag is composed of several layers. The first one is the <code>app</code> root element, which
is crucial to the template initialization. Weâ€™ll come back on that point in the next section.
Then we find the <code>view view-main</code> component, inside which is located the <code>page</code>, containing
the <code>navbar</code>, <code>toolbar</code> (bottom bar) and the <code>page content</code>. Altough, Framework7 inserts JavaScript code
at the end of the body, we can include them in the <code>head</code> as well.</p>
<p>Leveraging <code>html_2_R</code>, we convert the above code to R and extract the <code>f7_page</code> function. We replace
the title content by a title parameter, paying attention to remove all CSS and JS links, as they are already included with the <code>add_dependencies</code> function applied to <code>body</code>. The page content is contained in a <code>...</code> parameter.
We also move the navbar and toolbar content to create 2 other layout functions:</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"apple-mobile-web-app-capable"</span>,
        content <span class="op">=</span> <span class="st">"yes"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"theme-color"</span>,
        content <span class="op">=</span> <span class="st">"#2196f3"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
        <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
          id <span class="op">=</span> <span class="st">"app"</span>,
          <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
            class <span class="op">=</span> <span class="st">"view view-main"</span>,
            <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
              class <span class="op">=</span> <span class="st">"page"</span>,
              <span class="va">navbar</span>,
              <span class="va">toolbar</span>,
              <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
                class <span class="op">=</span> <span class="st">"page-content"</span>,
                <span class="va">...</span>
              <span class="op">)</span>
            <span class="op">)</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>,
      deps <span class="op">=</span> <span class="st">"framework7"</span>,
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Below are the <code>navbar</code> and <code>toolbar</code> components. The navbar has only a title parameter and
the toolbar may contain items in a <code>...</code> parameter. In practice they may contain more element,
but this is enough for now:</p>
<div class="sourceCode" id="cb580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_navbar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">title</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"navbar"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"navbar-bg"</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      class <span class="op">=</span> <span class="st">"navbar-inner"</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
        class <span class="op">=</span> <span class="st">"title"</span>,
        <span class="va">title</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">f7_toolbar</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"toolbar toolbar-bottom"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      class <span class="op">=</span> <span class="st">"toolbar-inner"</span>,
      <span class="va">...</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="noteblock">
<p>Donâ€™t forget to regularly insert roxygen documentation with the insert roxygen skeleton
RStudio feature.</p>
</div>
<p>At that point, we can try to run a simple shiny app. Best practice is to save the <code>app.R</code> file in
the <code>inst/examples</code> folder:</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/load_all.html">load_all</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  <span class="st">"Test"</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Title"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>which displays nothing, but returns no error. We actually forgot the app initialization step.</p>
</div>
<div id="app-initialization-1" class="section level2">
<h2>
<span class="header-section-number">24.4</span> App initialization<a class="anchor" aria-label="anchor" href="#app-initialization-1"><i class="fas fa-link"></i></a>
</h2>
<p>This step is mandatory to activate all template components (router, panels, â€¦).
We create a custom script with <code>create_js</code>, which automatically updates the <a href="https://github.com/RinteRface/charpente">charpente</a> provided <code>main.js</code> entry point:</p>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_js</a></span><span class="op">(</span><span class="st">"init"</span><span class="op">)</span></code></pre></div>
<p>and add the following piece of JS inside:</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb583-1"><a href="mobile-shinyMobile.html#cb583-1"></a><span class="at">$</span>( document ).<span class="at">ready</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb583-2"><a href="mobile-shinyMobile.html#cb583-2"></a>  app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(<span class="op">{</span></span>
<span id="cb583-3"><a href="mobile-shinyMobile.html#cb583-3"></a>    <span class="co">// App root element</span></span>
<span id="cb583-4"><a href="mobile-shinyMobile.html#cb583-4"></a>    <span class="dt">root</span><span class="op">:</span> <span class="st">'#app'</span><span class="op">,</span></span>
<span id="cb583-5"><a href="mobile-shinyMobile.html#cb583-5"></a>    <span class="co">// App Name</span></span>
<span id="cb583-6"><a href="mobile-shinyMobile.html#cb583-6"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb583-7"><a href="mobile-shinyMobile.html#cb583-7"></a>    <span class="co">// other options</span></span>
<span id="cb583-8"><a href="mobile-shinyMobile.html#cb583-8"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb583-9"><a href="mobile-shinyMobile.html#cb583-9"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Importantly, we made <code>app</code> global so as to access it in other scopes. There is currently
no easy way to workaround this issue.</p>
<div class="warningbox">
<p>Most of the code inside <code>init.js</code> is wrapped in a function that waits the document to be ready before interacting with the DOM. This is necessary since the configuration is retrieved from a <code>script</code> DOM element inserted when the application starts, thus not immediately available. If you try to remove the <code>$( document ).ready(function(...)});</code>, an error will be raised since the configuration cannot be properly retrieved (timing issue).</p>
</div>
<p>This script creates the app instance necessary to leverage Framework7 <a href="https://framework7.io/docs/app.html#app-methods-properties">methods</a>,
initialize other widgets, interact with layout elements and listen to app events (offline, online, â€¦).
Since the root element is a direct child of the body, the <code>root</code> property is not
mandatory. The full configuration list may be found <a href="https://framework7.io/docs/app.html">here</a>.
The next step consists in initializing the main view, we add this line right after the app creation:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb584-1"><a href="mobile-shinyMobile.html#cb584-1"></a><span class="kw">var</span> mainView <span class="op">=</span> <span class="va">app</span>.<span class="va">views</span>.<span class="at">create</span>(<span class="st">'.view-main'</span>)<span class="op">;</span></span></code></pre></div>
<p>Once done, we compress the corresponding JS file to create the <code>shinyMobile.min.js</code> code
and update the <code>f7_page</code> to include the new dependency, after the Framework7 one:</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># updated f7_page</span>
<span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"apple-mobile-web-app-capable"</span>,
        content <span class="op">=</span> <span class="st">"yes"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"theme-color"</span>,
        content <span class="op">=</span> <span class="st">"#2196f3"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
        <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
          id <span class="op">=</span> <span class="st">"app"</span>,
          <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
            class <span class="op">=</span> <span class="st">"view view-main"</span>,
            <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
              class <span class="op">=</span> <span class="st">"page"</span>,
              <span class="va">navbar</span>,
              <span class="va">toolbar</span>,
              <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
                class <span class="op">=</span> <span class="st">"page-content"</span>,
                <span class="va">...</span>
              <span class="op">)</span>
            <span class="op">)</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>,
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"framework7"</span>, <span class="st">"shinyMobile"</span><span class="op">)</span>,
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/load_all.html">load_all</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The working app is shown on Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-firstapp">24.2</a>.
The right panel displays the developer tools inside which we can seamlessly debug the JS code, by
leveraging source maps.</p>
<div class="figure">
<span id="fig:mobile-shinyMobile-firstapp"></span>
<img src="images/mobile/mobile-shinyMobile-firstapp.png" alt="First working {shinyMobile} app" width="100%"><p class="caption">
FIGURE 24.2: First working {shinyMobile} app
</p>
</div>
<p>From now, we can add a welcome notification message with the <a href="https://framework7.io/docs/notification.html">notification</a> API. There are 2 steps:</p>
<ul>
<li>Create the notification instance with <code>app.notification.create(parameters)</code>.</li>
<li>Tell the app to open the notification at start with <code>app.notification.open()</code>.</li>
</ul>
<p>We add the following code to <code>init.js</code> and call <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code>:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb586-1"><a href="mobile-shinyMobile.html#cb586-1"></a><span class="kw">var</span> notification <span class="op">=</span> <span class="va">app</span>.<span class="va">notification</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb586-2"><a href="mobile-shinyMobile.html#cb586-2"></a>  <span class="dt">text</span><span class="op">:</span> <span class="st">'Welcome to shinyMobile!'</span><span class="op">,</span></span>
<span id="cb586-3"><a href="mobile-shinyMobile.html#cb586-3"></a>  <span class="dt">on</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb586-4"><a href="mobile-shinyMobile.html#cb586-4"></a>    <span class="dt">opened</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb586-5"><a href="mobile-shinyMobile.html#cb586-5"></a>      <span class="va">console</span>.<span class="at">log</span>(<span class="st">'Notification opened'</span>)</span>
<span id="cb586-6"><a href="mobile-shinyMobile.html#cb586-6"></a>    <span class="op">}</span></span>
<span id="cb586-7"><a href="mobile-shinyMobile.html#cb586-7"></a>  <span class="op">}</span></span>
<span id="cb586-8"><a href="mobile-shinyMobile.html#cb586-8"></a><span class="op">}</span>).<span class="at">open</span>()<span class="op">;</span></span></code></pre></div>
<p>It opens at app start up and closes on swipe gesture. The Framework7 API is quite easy to
understand and extremely powerful. Chapter <a href="mobile-widgets.html#mobile-widgets">26</a> gives a better introduction to the main
Framework7 widgets.</p>
</div>
<div id="app-configuration" class="section level2">
<h2>
<span class="header-section-number">24.5</span> App configuration<a class="anchor" aria-label="anchor" href="#app-configuration"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="https://framework7.io/docs/app.html">app</a> object has a tremendous amount of methods and parameters.
In this section, we briefly describe the most significant and how to set them up.
Among all parameters, there are metadata parameters like <strong>name</strong> and <strong>version</strong>. Once the app initialized, all
app parameters are accessible with the <code>.</code> notation. For instance, if you set a version number, it is accessible later
with <code>app.version</code>.</p>
<div id="global-theme" class="section level3">
<h3>
<span class="header-section-number">24.5.1</span> Global theme<a class="anchor" aria-label="anchor" href="#global-theme"><i class="fas fa-link"></i></a>
</h3>
<p>One of the most important parameter is the <strong>theme</strong> that controls the overall app design (Figure <a href="mobile-shinyMobile.html#fig:mobile-framework7-themes">24.3</a>):</p>
<ul>
<li>
<code>ios</code> corresponds the iOS design.</li>
<li>
<code>md</code> stands for material design.</li>
<li>
<code>aurora</code> is a desktop optimized design.</li>
</ul>
<p>As this parameter is set to <code>auto</code>, Framework7 detects the
current device stored in <code>app.device</code>, and accordingly adapt the design. Nothing prevents you from forcing the
iOS layout on android devices, even though being quite irrelevant. Here are many properties to <a href="https://framework7.io/docs/device.html">review</a>.</p>
<div class="figure">
<span id="fig:mobile-framework7-themes"></span>
<img src="images/mobile/mobile-shinymobile-slider-ios.png" alt="Framework7 skins: iOS (left), md (right)." width="50%"><img src="images/mobile/mobile-shinymobile-slider-md.png" alt="Framework7 skins: iOS (left), md (right)." width="50%"><p class="caption">
FIGURE 24.3: Framework7 skins: iOS (left), md (right).
</p>
</div>
</div>
<div id="events-1" class="section level3">
<h3>
<span class="header-section-number">24.5.2</span> Events<a class="anchor" aria-label="anchor" href="#events-1"><i class="fas fa-link"></i></a>
</h3>
<p>The app is able to emit events whenever relevant like <code>init</code>, <code>resize</code>, <code>online</code>, <code>offline</code>, which
allows to add interactivity:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb587-1"><a href="mobile-shinyMobile.html#cb587-1"></a>app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(<span class="op">{</span></span>
<span id="cb587-2"><a href="mobile-shinyMobile.html#cb587-2"></a>  <span class="dt">on</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb587-3"><a href="mobile-shinyMobile.html#cb587-3"></a>    <span class="dt">init</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb587-4"><a href="mobile-shinyMobile.html#cb587-4"></a>      <span class="va">console</span>.<span class="at">log</span>(<span class="st">'App initialized'</span>)<span class="op">;</span></span>
<span id="cb587-5"><a href="mobile-shinyMobile.html#cb587-5"></a>    <span class="op">},</span></span>
<span id="cb587-6"><a href="mobile-shinyMobile.html#cb587-6"></a>    <span class="co">// other events</span></span>
<span id="cb587-7"><a href="mobile-shinyMobile.html#cb587-7"></a>  <span class="op">}</span></span>
<span id="cb587-8"><a href="mobile-shinyMobile.html#cb587-8"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="components-configuration" class="section level3">
<h3>
<span class="header-section-number">24.5.3</span> Components configuration<a class="anchor" aria-label="anchor" href="#components-configuration"><i class="fas fa-link"></i></a>
</h3>
<p>All Framework7 components are highly customizable. Yet, if you know that some
parameters are not going to change, it is a good idea to make them global and share them
across all instances. For example, notifications have global options. Letâ€™s add this code
to the <code>init.js</code> script directly inside the <code>var app = new Framework7({ ... })</code>:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb588-1"><a href="mobile-shinyMobile.html#cb588-1"></a>notification<span class="op">:</span> <span class="op">{</span></span>
<span id="cb588-2"><a href="mobile-shinyMobile.html#cb588-2"></a>  <span class="dt">title</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb588-3"><a href="mobile-shinyMobile.html#cb588-3"></a>  <span class="dt">closeTimeout</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb588-4"><a href="mobile-shinyMobile.html#cb588-4"></a><span class="op">}</span></span></code></pre></div>
<p>This means all notifications will close after 3 seconds and have the <code>My App</code> title.
We add another notification to the <code>init.js</code> script with a delay of 1 second so as to
test this global feature. Note the use of the internal Framework7 <a href="https://framework7.io/docs/utils.html#nexttick">utils</a> <code>app.utils.nextTick</code>, which is nothing more than a <code>setTimeout</code>. At this point, <code>init.js</code> should look like this:</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb589-1"><a href="mobile-shinyMobile.html#cb589-1"></a><span class="at">$</span>( document ).<span class="at">ready</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb589-2"><a href="mobile-shinyMobile.html#cb589-2"></a> <span class="co">// create app instance</span></span>
<span id="cb589-3"><a href="mobile-shinyMobile.html#cb589-3"></a> app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(<span class="op">{</span></span>
<span id="cb589-4"><a href="mobile-shinyMobile.html#cb589-4"></a>    <span class="co">// App root element</span></span>
<span id="cb589-5"><a href="mobile-shinyMobile.html#cb589-5"></a>    <span class="dt">root</span><span class="op">:</span> <span class="st">'#app'</span><span class="op">,</span></span>
<span id="cb589-6"><a href="mobile-shinyMobile.html#cb589-6"></a>    <span class="co">// App Name</span></span>
<span id="cb589-7"><a href="mobile-shinyMobile.html#cb589-7"></a>    <span class="dt">name</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb589-8"><a href="mobile-shinyMobile.html#cb589-8"></a>    <span class="co">// other options</span></span>
<span id="cb589-9"><a href="mobile-shinyMobile.html#cb589-9"></a>    <span class="dt">notification</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb589-10"><a href="mobile-shinyMobile.html#cb589-10"></a>      <span class="dt">title</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb589-11"><a href="mobile-shinyMobile.html#cb589-11"></a>      <span class="dt">closeTimeout</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb589-12"><a href="mobile-shinyMobile.html#cb589-12"></a>    <span class="op">}</span></span>
<span id="cb589-13"><a href="mobile-shinyMobile.html#cb589-13"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb589-14"><a href="mobile-shinyMobile.html#cb589-14"></a></span>
<span id="cb589-15"><a href="mobile-shinyMobile.html#cb589-15"></a>  <span class="co">// init main view</span></span>
<span id="cb589-16"><a href="mobile-shinyMobile.html#cb589-16"></a>  <span class="kw">var</span> mainView <span class="op">=</span> <span class="va">app</span>.<span class="va">views</span>.<span class="at">create</span>(<span class="st">'.view-main'</span>)<span class="op">;</span></span>
<span id="cb589-17"><a href="mobile-shinyMobile.html#cb589-17"></a></span>
<span id="cb589-18"><a href="mobile-shinyMobile.html#cb589-18"></a></span>
<span id="cb589-19"><a href="mobile-shinyMobile.html#cb589-19"></a>  <span class="kw">var</span> notification <span class="op">=</span> <span class="va">app</span>.<span class="va">notification</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb589-20"><a href="mobile-shinyMobile.html#cb589-20"></a>    <span class="dt">text</span><span class="op">:</span> <span class="st">'Hello, how are you?'</span><span class="op">,</span></span>
<span id="cb589-21"><a href="mobile-shinyMobile.html#cb589-21"></a>    <span class="dt">on</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb589-22"><a href="mobile-shinyMobile.html#cb589-22"></a>      <span class="dt">opened</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb589-23"><a href="mobile-shinyMobile.html#cb589-23"></a>        <span class="va">console</span>.<span class="at">log</span>(<span class="st">'Notification opened'</span>)<span class="op">;</span></span>
<span id="cb589-24"><a href="mobile-shinyMobile.html#cb589-24"></a>      <span class="op">}</span></span>
<span id="cb589-25"><a href="mobile-shinyMobile.html#cb589-25"></a>    <span class="op">}</span></span>
<span id="cb589-26"><a href="mobile-shinyMobile.html#cb589-26"></a>  <span class="op">}</span>).<span class="at">open</span>()<span class="op">;</span></span>
<span id="cb589-27"><a href="mobile-shinyMobile.html#cb589-27"></a>  </span>
<span id="cb589-28"><a href="mobile-shinyMobile.html#cb589-28"></a>  </span>
<span id="cb589-29"><a href="mobile-shinyMobile.html#cb589-29"></a>  <span class="kw">var</span> otherMessage <span class="op">=</span> <span class="va">app</span>.<span class="va">notification</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb589-30"><a href="mobile-shinyMobile.html#cb589-30"></a>    <span class="dt">text</span><span class="op">:</span> <span class="st">'You look great!'</span></span>
<span id="cb589-31"><a href="mobile-shinyMobile.html#cb589-31"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb589-32"><a href="mobile-shinyMobile.html#cb589-32"></a>  </span>
<span id="cb589-33"><a href="mobile-shinyMobile.html#cb589-33"></a>  <span class="co">// equivalent to setTimeout ...</span></span>
<span id="cb589-34"><a href="mobile-shinyMobile.html#cb589-34"></a>  <span class="va">app</span>.<span class="va">utils</span>.<span class="at">nextTick</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb589-35"><a href="mobile-shinyMobile.html#cb589-35"></a>    <span class="va">otherMessage</span>.<span class="at">open</span>()<span class="op">;</span></span>
<span id="cb589-36"><a href="mobile-shinyMobile.html#cb589-36"></a>  <span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb589-37"><a href="mobile-shinyMobile.html#cb589-37"></a>  </span>
<span id="cb589-38"><a href="mobile-shinyMobile.html#cb589-38"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="other-elements" class="section level3">
<h3>
<span class="header-section-number">24.5.4</span> Other elements<a class="anchor" aria-label="anchor" href="#other-elements"><i class="fas fa-link"></i></a>
</h3>
<p>Framework7 provides mobile specific modules like <code>touch</code>, which is a long press event (here 750 ms).
This is something you can usually do on many mobile apps. To activate that feature, we pass
the following configuration to the app parameters list, namely inside <code>app = new Framework7({...});</code>:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb590-1"><a href="mobile-shinyMobile.html#cb590-1"></a>touch<span class="op">:</span> <span class="op">{</span></span>
<span id="cb590-2"><a href="mobile-shinyMobile.html#cb590-2"></a>  <span class="dt">tapHold</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb590-3"><a href="mobile-shinyMobile.html#cb590-3"></a><span class="op">}</span></span></code></pre></div>
<p>We create a button element and add it the <code>taphold</code> event in <code>init.js</code>:</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb591-1"><a href="mobile-shinyMobile.html#cb591-1"></a><span class="at">$</span>(<span class="st">'#mybutton'</span>).<span class="at">on</span>(<span class="st">'taphold'</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb591-2"><a href="mobile-shinyMobile.html#cb591-2"></a>  <span class="va">app</span>.<span class="va">dialog</span>.<span class="at">alert</span>(<span class="st">'Tap hold fired!'</span>)<span class="op">;</span></span>
<span id="cb591-3"><a href="mobile-shinyMobile.html#cb591-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>The <code>app.R</code> script should look like:</p>
<div class="sourceCode" id="cb592"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  <span class="st">"Test"</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
    class <span class="op">=</span> <span class="st">"list inset"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span>
        <span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>
          href <span class="op">=</span> <span class="st">"#"</span>,
          id <span class="op">=</span> <span class="st">"mybutton"</span>,
          class <span class="op">=</span> <span class="st">"list-button color-red"</span>,
          <span class="st">"Large Red Button"</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Title"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<div class="warningbox">
<p>Once the app is running, donâ€™t forget to open the developer tools and
set the device on mobile mode (iPhone or android) since <code>taphold</code> does not fire
on desktop (Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-taphold">24.4</a>).</p>
</div>
<p><code>taphold</code> also triggers events related to the click like text selection, which
one may want to disable. If so, we have to add the following code to <code>init.js</code>, making sure
to check that <code>touch</code> exists:</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb593-1"><a href="mobile-shinyMobile.html#cb593-1"></a><span class="co">// tapHold custom css</span></span>
<span id="cb593-2"><a href="mobile-shinyMobile.html#cb593-2"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">"touch"</span>)) <span class="op">{</span></span>
<span id="cb593-3"><a href="mobile-shinyMobile.html#cb593-3"></a>  <span class="cf">if</span> (<span class="va">app</span>.<span class="va">params</span>.<span class="at">tapHold</span>) <span class="op">{</span></span>
<span id="cb593-4"><a href="mobile-shinyMobile.html#cb593-4"></a>    <span class="at">$</span>(<span class="st">"&lt;style&gt;"</span>)</span>
<span id="cb593-5"><a href="mobile-shinyMobile.html#cb593-5"></a>      .<span class="at">prop</span>(<span class="st">"type"</span><span class="op">,</span> <span class="st">"text/css"</span>)</span>
<span id="cb593-6"><a href="mobile-shinyMobile.html#cb593-6"></a>      .<span class="at">html</span>(</span>
<span id="cb593-7"><a href="mobile-shinyMobile.html#cb593-7"></a>        <span class="vs">`-moz-user-select: none;</span></span>
<span id="cb593-8"><a href="mobile-shinyMobile.html#cb593-8"></a><span class="vs">        -webkit-user-select: none;</span></span>
<span id="cb593-9"><a href="mobile-shinyMobile.html#cb593-9"></a><span class="vs">        user-select: none;`</span></span>
<span id="cb593-10"><a href="mobile-shinyMobile.html#cb593-10"></a>      )</span>
<span id="cb593-11"><a href="mobile-shinyMobile.html#cb593-11"></a>      .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb593-12"><a href="mobile-shinyMobile.html#cb593-12"></a>  <span class="op">}</span></span>
<span id="cb593-13"><a href="mobile-shinyMobile.html#cb593-13"></a><span class="op">}</span></span></code></pre></div>
<p>It disables classic text selection after a long press in the window.</p>
<div class="figure">
<span id="fig:mobile-shinyMobile-taphold"></span>
<img src="images/mobile/mobile-shinymobile-taphold.png" alt="Long press or taphold event" width="100%"><p class="caption">
FIGURE 24.4: Long press or taphold event
</p>
</div>
<p>An important remark is the click handling in Framework7. Framework7 has its own internal <a href="https://framework7.io/docs/view.html">router</a> that allows to pass data between pages and perform quite
advanced actions. Do you remember the <code>app.views.create('.view-main');</code> step? This real purpose is actually to
activate the internal router. While extremely convenient for classic web apps,
this feature is not completely suited for Shiny that does not natively support multi pages apps.
The recent <a href="https://github.com/ColinFay/brochure">work</a> in the field is promising and plays well
with <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> (see <a href="https://github.com/RinteRface/shinyMobile/issues/136">here</a>) but this is out of the scope of this chapter. The internal router has strong implications, for instance clicking on
<code>&lt;a href="https://www.google.com/"&gt;Click me&lt;/a&gt;</code> will fail (while it works like
a charm for a classic shiny app), as shown below:</p>
<div class="sourceCode" id="cb594"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mylink</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://www.google.com/"</span>, <span class="st">"Click me"</span><span class="op">)</span>

<span class="co"># shinyMobile</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
  <span class="va">mylink</span>,
  navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Title"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span>

<span class="co"># classic shiny</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="va">mylink</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>To fix this issue, Framework7 has a <code>clicks</code> module options, accepting any valid CSS selector.
Below is the default configuration:</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb595-1"><a href="mobile-shinyMobile.html#cb595-1"></a>clicks<span class="op">:</span> <span class="op">{</span></span>
<span id="cb595-2"><a href="mobile-shinyMobile.html#cb595-2"></a>  <span class="dt">externalLinks</span><span class="op">:</span> <span class="st">'.external'</span><span class="op">,</span></span>
<span id="cb595-3"><a href="mobile-shinyMobile.html#cb595-3"></a><span class="op">}</span></span></code></pre></div>
<p>Consequently, in order to skip the internal router, links must have the <code>.external</code> class.</p>
<div class="importantblock">
<p>One might be tempted to target all <code>a</code> elements: this is a bad idea,
as it also target tabs navigation, which eventually fails! Therefore, it is best
practice to add the <code>external</code> class to all the necessary links like <code><a href="https://rdrr.io/pkg/htmltools/man/builder.html">a(href = "https://www.google.com/", "Click me", class = "external")</a></code></p>
</div>
</div>
<div id="allow-end-user-configuration" class="section level3">
<h3>
<span class="header-section-number">24.5.5</span> Allow end-user configuration<a class="anchor" aria-label="anchor" href="#allow-end-user-configuration"><i class="fas fa-link"></i></a>
</h3>
<p>In the above sections, we described some parameters to configure the app. Yet,
we did setup all values directly in JavaScript. How do we allow the end user to provide
his very own parameters?</p>
<p>The idea is the following:</p>
<ul>
<li>We create an options argument in the <code>f7_page</code> function which accepts a list
of parameters.</li>
<li>We convert it to the JSON format and store it in a tag, ideally next to the <code>body</code> element.</li>
<li>We recover those data on the JS side and update the app initialization method.</li>
</ul>
<p>The <code>f7_page</code> may be accordingly modified:</p>
<div class="sourceCode" id="cb596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">config_tag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"application/json"</span>,
    `data-for` <span class="op">=</span> <span class="st">"app"</span>,
    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">options</span>,
      auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>,
      json_verbatim <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span>

  <span class="co"># create body_tag</span>
  <span class="va">body_tag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"app"</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
        class <span class="op">=</span> <span class="st">"view view-main"</span>,
        <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
          class <span class="op">=</span> <span class="st">"page"</span>,
          <span class="va">navbar</span>,
          <span class="va">toolbar</span>,
          <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
            class <span class="op">=</span> <span class="st">"page-content"</span>,
            <span class="va">...</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    <span class="va">config_tag</span>
  <span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"apple-mobile-web-app-capable"</span>,
        content <span class="op">=</span> <span class="st">"yes"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"theme-color"</span>,
        content <span class="op">=</span> <span class="st">"#2196f3"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">body_tag</span>,
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"framework7"</span>, <span class="st">"shinyMobile"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The above code still deserves some explanations, even though we exploit a method already defined in section <a href="shiny-input-system.html#secondary-inputs">11.2</a>. We convert the options list to a JSON with <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">jsonlite::toJSON</a></code> and embed it in a script tag.
The <code>data-for</code> attribute with the <strong>id</strong> attribute guarantees the uniqueness of our configuration script.</p>
<div class="sourceCode" id="cb597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">config_tag</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">tags</a></span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"application/json"</span>,
    `data-for` <span class="op">=</span> <span class="st">"app"</span>,
    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">options</span>,
      auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>,
      json_verbatim <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>We then create an intermediate <code>body_tag</code> component where we insert the configuration tag.
On the JS side, the data collection must occur before the app initialization and is quite easy
with the jQuery <code>find</code> method:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb598-1"><a href="mobile-shinyMobile.html#cb598-1"></a><span class="kw">var</span> config <span class="op">=</span> <span class="at">$</span>(document).<span class="at">find</span>(<span class="st">"script[data-for='app']"</span>)<span class="op">;</span></span>
<span id="cb598-2"><a href="mobile-shinyMobile.html#cb598-2"></a>config <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="va">config</span>.<span class="at">html</span>())<span class="op">;</span></span></code></pre></div>
<p>We can accordingly update the app initialization:</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb599-1"><a href="mobile-shinyMobile.html#cb599-1"></a>app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(<span class="op">{</span></span>
<span id="cb599-2"><a href="mobile-shinyMobile.html#cb599-2"></a>  <span class="co">// App root element</span></span>
<span id="cb599-3"><a href="mobile-shinyMobile.html#cb599-3"></a>  <span class="dt">root</span><span class="op">:</span> <span class="st">'#app'</span><span class="op">,</span></span>
<span id="cb599-4"><a href="mobile-shinyMobile.html#cb599-4"></a>  <span class="co">// App Name</span></span>
<span id="cb599-5"><a href="mobile-shinyMobile.html#cb599-5"></a>  <span class="dt">name</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb599-6"><a href="mobile-shinyMobile.html#cb599-6"></a>  <span class="dt">version</span><span class="op">:</span> <span class="va">config</span>.<span class="at">version</span><span class="op">,</span></span>
<span id="cb599-7"><a href="mobile-shinyMobile.html#cb599-7"></a>  <span class="co">// other options</span></span>
<span id="cb599-8"><a href="mobile-shinyMobile.html#cb599-8"></a>  <span class="dt">theme</span><span class="op">:</span> <span class="va">config</span>.<span class="at">theme</span><span class="op">,</span></span>
<span id="cb599-9"><a href="mobile-shinyMobile.html#cb599-9"></a>  <span class="dt">notification</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb599-10"><a href="mobile-shinyMobile.html#cb599-10"></a>    <span class="dt">title</span><span class="op">:</span> <span class="st">'My App'</span><span class="op">,</span></span>
<span id="cb599-11"><a href="mobile-shinyMobile.html#cb599-11"></a>    <span class="dt">closeTimeout</span><span class="op">:</span> <span class="dv">3000</span><span class="op">,</span></span>
<span id="cb599-12"><a href="mobile-shinyMobile.html#cb599-12"></a>  <span class="op">},</span></span>
<span id="cb599-13"><a href="mobile-shinyMobile.html#cb599-13"></a>  <span class="dt">touch</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb599-14"><a href="mobile-shinyMobile.html#cb599-14"></a>    <span class="dt">tapHold</span><span class="op">:</span> <span class="va">config</span>.<span class="at">taphold</span><span class="op">,</span></span>
<span id="cb599-15"><a href="mobile-shinyMobile.html#cb599-15"></a>  <span class="op">},</span></span>
<span id="cb599-16"><a href="mobile-shinyMobile.html#cb599-16"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>What happens if the user forgets to supply the version number? <code>data.version</code> is undefined
and the app still works! The biggest advantage of this approach is the fact that all <code>TRUE</code>
and <code>FALSE</code> (R) are converted to <code>true</code> and <code>false</code> (JS), which avoids unnecessary conversion steps.
However, we are still missing many potential configuration options. For instance, with the above code,
only <code>root</code>, <code>name</code>, <code>version</code>, <code>theme</code>, <code>notifications</code>, <code>touch</code> are considered. If the user
provides any other option, it is ignored.</p>
<p>In theory, this is what we could do to make sure that all elements are considered:</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb600-1"><a href="mobile-shinyMobile.html#cb600-1"></a>app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(config)<span class="op">;</span></span></code></pre></div>
<p>It is assumed that the user exactly knows what to provide in the list, especially mandatory elements.
Knowing the tremendous number of options, it might be slightly too complex for a new user.
What we suggest is to extract the most important components as direct <code>f7_page</code> parameters and
keep less important parameters in the options list. For example,
if you think that <strong>theme</strong> is crucial (and it truly is), you could do:</p>
<div class="sourceCode" id="cb601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">theme</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ios"</span>, <span class="st">"md"</span>, <span class="st">"aurora"</span><span class="op">)</span>, 
                    <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">theme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">theme</span><span class="op">)</span>
  <span class="va">options</span><span class="op">$</span><span class="va">theme</span> <span class="op">&lt;-</span> <span class="va">theme</span>
  
  <span class="va">config_tag</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">tags</a></span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"application/json"</span>,
    `data-for` <span class="op">=</span> <span class="st">"app"</span>,
    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">options</span>,
      auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>,
      json_verbatim <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
<span class="co"># ...</span>
  
<span class="op">}</span></code></pre></div>
<p>which makes the API a bit more accessible (event though more complex to maintain)
and you only need to add one line of documentation in the roxygen part. Alternatively, you could also put all parameters in <strong>options</strong> and provide a default value for <code>f7Page</code> like:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="mobile-shinyMobile.html#cb602-1"></a>\itemize{</span>
<span id="cb602-2"><a href="mobile-shinyMobile.html#cb602-2"></a><span class="co">#'  \item \code{theme}: App skin: "ios", "md", "auto" or "aurora".</span></span>
<span id="cb602-3"><a href="mobile-shinyMobile.html#cb602-3"></a><span class="co">#'  \item \code{dark}: Dark layout. TRUE or FALSE.</span></span>
<span id="cb602-4"><a href="mobile-shinyMobile.html#cb602-4"></a><span class="co">#'  \item \code{filled}: Whether to fill the \link{f7Navbar} and \link{f7Toolbar} with</span></span>
<span id="cb602-5"><a href="mobile-shinyMobile.html#cb602-5"></a><span class="co">#'  the current selected color. FALSE by default.</span></span>
<span id="cb602-6"><a href="mobile-shinyMobile.html#cb602-6"></a><span class="co">#'  \item \code{color}: Color theme: See \url{http://framework7.io/docs/color-themes.html}.</span></span>
<span id="cb602-7"><a href="mobile-shinyMobile.html#cb602-7"></a><span class="co">#'  Expect a name like blue or red. If NULL, use the default color.</span></span>
<span id="cb602-8"><a href="mobile-shinyMobile.html#cb602-8"></a><span class="co">#'  \item \code{pullToRefresh}: Whether to active the pull to refresh feature. Default to FALSE.</span></span>
<span id="cb602-9"><a href="mobile-shinyMobile.html#cb602-9"></a><span class="co">#'  See \url{https://v5.framework7.io/docs/pull-to-refresh.html#examples}.</span></span>
<span id="cb602-10"><a href="mobile-shinyMobile.html#cb602-10"></a><span class="co">#'  \item \code{iosTranslucentBars}: Enable translucent effect (blur background) on navigation bars for iOS theme (on iOS devices).</span></span>
<span id="cb602-11"><a href="mobile-shinyMobile.html#cb602-11"></a><span class="co">#'  FALSE by default.</span></span>
<span id="cb602-12"><a href="mobile-shinyMobile.html#cb602-12"></a><span class="co">#' }</span></span>
<span id="cb602-13"><a href="mobile-shinyMobile.html#cb602-13"></a><span class="co">#' Touch module options \url{https://v5.framework7.io/docs/app.html#app-parameters}:</span></span>
<span id="cb602-14"><a href="mobile-shinyMobile.html#cb602-14"></a><span class="co">#' \itemize {</span></span>
<span id="cb602-15"><a href="mobile-shinyMobile.html#cb602-15"></a><span class="co">#'  \item \code{tapHold}:  It triggers (if enabled) after a sustained, complete touch event.</span></span>
<span id="cb602-16"><a href="mobile-shinyMobile.html#cb602-16"></a><span class="co">#'  By default it is disabled. Note, that Tap Hold is a part of built-in Fast Clicks library,</span></span>
<span id="cb602-17"><a href="mobile-shinyMobile.html#cb602-17"></a><span class="co">#'  so Fast Clicks should be also enabled.</span></span>
<span id="cb602-18"><a href="mobile-shinyMobile.html#cb602-18"></a><span class="co">#'  \item \code{tapHoldDelay}: Determines how long (in ms) the user must hold their tap before the taphold event is fired on the target element.</span></span>
<span id="cb602-19"><a href="mobile-shinyMobile.html#cb602-19"></a><span class="co">#'  Default to 750 ms.</span></span>
<span id="cb602-20"><a href="mobile-shinyMobile.html#cb602-20"></a><span class="co">#'  \item \code{iosTouchRipple}: Default to FALSE. Enables touch ripple effect for iOS theme.</span></span>
<span id="cb602-21"><a href="mobile-shinyMobile.html#cb602-21"></a><span class="co">#' }</span></span>
<span id="cb602-22"><a href="mobile-shinyMobile.html#cb602-22"></a><span class="co">#' Navbar options \url{https://v5.framework7.io/docs/navbar.html#navbar-app-parameters}:</span></span>
<span id="cb602-23"><a href="mobile-shinyMobile.html#cb602-23"></a><span class="co">#' \itemize {</span></span>
<span id="cb602-24"><a href="mobile-shinyMobile.html#cb602-24"></a><span class="co">#'  \item \code{iosCenterTitle}: Default to TRUE. When enabled then it will try to position</span></span>
<span id="cb602-25"><a href="mobile-shinyMobile.html#cb602-25"></a><span class="co">#'  title at the center in iOS theme. Sometime (with some custom design) it may not needed.</span></span>
<span id="cb602-26"><a href="mobile-shinyMobile.html#cb602-26"></a><span class="co">#'  \item \code{hideOnPageScroll}: Default to FALSE. Will hide Navbars on page scroll.</span></span>
<span id="cb602-27"><a href="mobile-shinyMobile.html#cb602-27"></a><span class="co">#' }</span></span>
<span id="cb602-28"><a href="mobile-shinyMobile.html#cb602-28"></a><span class="co">#' Toolbar options \url{https://v5.framework7.io/docs/toolbar-tabbar.html#toolbar-app-parameters}:</span></span>
<span id="cb602-29"><a href="mobile-shinyMobile.html#cb602-29"></a><span class="co">#' \itemize {</span></span>
<span id="cb602-30"><a href="mobile-shinyMobile.html#cb602-30"></a><span class="co">#'  \item \code{hideOnPageScroll}: Default to FALSE. Will hide tabs on page scroll.</span></span>
<span id="cb602-31"><a href="mobile-shinyMobile.html#cb602-31"></a><span class="co">#' }</span></span>
<span id="cb602-32"><a href="mobile-shinyMobile.html#cb602-32"></a><span class="co">#'</span></span>
<span id="cb602-33"><a href="mobile-shinyMobile.html#cb602-33"></a><span class="co">#' In any case, you must follow the same structure as provided in the function arguments.</span></span>
<span id="cb602-34"><a href="mobile-shinyMobile.html#cb602-34"></a>f7Page &lt;-<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb602-35"><a href="mobile-shinyMobile.html#cb602-35"></a>  <span class="co"># other parameters are not mentionned</span></span>
<span id="cb602-36"><a href="mobile-shinyMobile.html#cb602-36"></a>  <span class="dt">options =</span> <span class="kw">list</span>(</span>
<span id="cb602-37"><a href="mobile-shinyMobile.html#cb602-37"></a>    <span class="dt">theme =</span> <span class="kw">c</span>(<span class="st">"ios"</span>, <span class="st">"md"</span>, <span class="st">"auto"</span>, <span class="st">"aurora"</span>),</span>
<span id="cb602-38"><a href="mobile-shinyMobile.html#cb602-38"></a>    <span class="dt">dark =</span> <span class="ot">TRUE</span>,</span>
<span id="cb602-39"><a href="mobile-shinyMobile.html#cb602-39"></a>    <span class="dt">filled =</span> <span class="ot">FALSE</span>,</span>
<span id="cb602-40"><a href="mobile-shinyMobile.html#cb602-40"></a>    <span class="dt">color =</span> <span class="st">"#007aff"</span>,</span>
<span id="cb602-41"><a href="mobile-shinyMobile.html#cb602-41"></a>    <span class="dt">touch =</span> <span class="kw">list</span>(</span>
<span id="cb602-42"><a href="mobile-shinyMobile.html#cb602-42"></a>      <span class="dt">tapHold =</span> <span class="ot">TRUE</span>,</span>
<span id="cb602-43"><a href="mobile-shinyMobile.html#cb602-43"></a>      <span class="dt">tapHoldDelay =</span> <span class="dv">750</span>,</span>
<span id="cb602-44"><a href="mobile-shinyMobile.html#cb602-44"></a>      <span class="dt">iosTouchRipple =</span> <span class="ot">FALSE</span></span>
<span id="cb602-45"><a href="mobile-shinyMobile.html#cb602-45"></a>    ),</span>
<span id="cb602-46"><a href="mobile-shinyMobile.html#cb602-46"></a>    <span class="dt">iosTranslucentBars =</span> <span class="ot">FALSE</span>,</span>
<span id="cb602-47"><a href="mobile-shinyMobile.html#cb602-47"></a>    <span class="dt">navbar =</span> <span class="kw">list</span>(</span>
<span id="cb602-48"><a href="mobile-shinyMobile.html#cb602-48"></a>      <span class="dt">iosCenterTitle =</span> <span class="ot">TRUE</span>,</span>
<span id="cb602-49"><a href="mobile-shinyMobile.html#cb602-49"></a>      <span class="dt">hideNavOnPageScroll =</span> <span class="ot">TRUE</span></span>
<span id="cb602-50"><a href="mobile-shinyMobile.html#cb602-50"></a>    ),</span>
<span id="cb602-51"><a href="mobile-shinyMobile.html#cb602-51"></a>    <span class="dt">toolbar =</span> <span class="kw">list</span>(</span>
<span id="cb602-52"><a href="mobile-shinyMobile.html#cb602-52"></a>      <span class="dt">hideNavOnPageScroll =</span> <span class="ot">FALSE</span></span>
<span id="cb602-53"><a href="mobile-shinyMobile.html#cb602-53"></a>    ),</span>
<span id="cb602-54"><a href="mobile-shinyMobile.html#cb602-54"></a>    <span class="co"># whatever option ...</span></span>
<span id="cb602-55"><a href="mobile-shinyMobile.html#cb602-55"></a>  )</span>
<span id="cb602-56"><a href="mobile-shinyMobile.html#cb602-56"></a>) {</span>
<span id="cb602-57"><a href="mobile-shinyMobile.html#cb602-57"></a>  <span class="co"># function body ...</span></span>
<span id="cb602-58"><a href="mobile-shinyMobile.html#cb602-58"></a>}</span></code></pre></div>
<p>and write <code>var app = new Framework7(config);</code> on the JS side.</p>
<p>This is a good compromise since it avoids to create too many parameters, without sacrificing the
documentation. Donâ€™t forget that since <code>config</code> is an object,
you may add any other properties, methods, on the fly with the <code>.</code> notation or <code>app.utils.extend</code>.</p>
<div class="noteblock">
<p>You finally may ask why we put <code>dark</code>, <code>color</code> and <code>filled</code> in the options list given they
are not part of the app API parameters. As any unknown parameter is not considered
by the <code>Framework7</code> class, we can definitely keep them here, which is easier to treat on the JS side.</p>
</div>
</div>
<div id="modify-configuration" class="section level3">
<h3>
<span class="header-section-number">24.5.6</span> Modify configuration<a class="anchor" aria-label="anchor" href="#modify-configuration"><i class="fas fa-link"></i></a>
</h3>
<p>As previously stated, the app configuration is passed during the initialization process, through
<code>new Framework7(config)</code>. What if the user wants to programmatically change these options
when the app is running?</p>
<p>Since app parameters are located in <code>app.params</code>, the idea would be to extend that list:</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb603-1"><a href="mobile-shinyMobile.html#cb603-1"></a><span class="kw">var</span> newParams <span class="op">=</span> <span class="op">{</span></span>
<span id="cb603-2"><a href="mobile-shinyMobile.html#cb603-2"></a>  <span class="dt">dialog</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb603-3"><a href="mobile-shinyMobile.html#cb603-3"></a>    <span class="dt">buttonOk</span><span class="op">:</span>  <span class="st">"Yeaaaah!"</span><span class="op">,</span></span>
<span id="cb603-4"><a href="mobile-shinyMobile.html#cb603-4"></a>    <span class="dt">buttonCancel</span><span class="op">:</span> <span class="st">"Ouuups!"</span></span>
<span id="cb603-5"><a href="mobile-shinyMobile.html#cb603-5"></a>  <span class="op">}</span></span>
<span id="cb603-6"><a href="mobile-shinyMobile.html#cb603-6"></a><span class="op">}</span></span>
<span id="cb603-7"><a href="mobile-shinyMobile.html#cb603-7"></a><span class="va">app</span>.<span class="va">utils</span>.<span class="at">extend</span>(<span class="va">app</span>.<span class="at">params</span><span class="op">,</span> newParams)<span class="op">;</span></span></code></pre></div>
<p>The above example changes the default buttons text for all modal dialog.</p>
<div class="warningbox">
<p>As far as we know, some options wonâ€™t work like the <strong>global theme</strong>, which
would require to re-initialize the app and is obviously not possible.</p>
</div>
</div>
<div id="mobile-global-data" class="section level3">
<h3>
<span class="header-section-number">24.5.7</span> Global data and methods<a class="anchor" aria-label="anchor" href="#mobile-global-data"><i class="fas fa-link"></i></a>
</h3>
<p>The Framework7 <strong>data</strong> parameters allows to store global elements, data, and use them in different scripts.
To illustrate this feature, we consider the <code>tooltip</code> <a href="https://v5.framework7.io/docs/tooltip.html">example</a>.
A tooltip is a help text generally displayed on hover (or click) over a specific element.
They are commonly used to improve user experience in all websites.
Framework7 provides two tooltips APIs:</p>
<ul>
<li>A purely UI side API where the tooltip is attached to a tag.</li>
<li>A server side API where the tooltip is dynamically injected in the page content.</li>
</ul>
<p>While the first approach is obviously not interesting for us since it does not involve any
single line of JS, the second approach heavily relies on the <code>app.data</code> object. This is the one
we choose to explain. On the R side, we consider two functions:</p>
<ul>
<li>
<code>addF7Tooltip</code> that sends a custom message to JS called <code>add_tooltip</code>. This
message is composed of the tooltip options (content, â€¦), as well as the selector
on which to apply the tooltip (<strong>id</strong> or <strong>selector</strong> for custom CSS selector).</li>
<li>
<code>updateF7Tooltip</code> that sends a custom message to JS, <code>update_tooltip</code> to change
the tooltip state (active/inactive) and its content.</li>
</ul>
<p>Their code is defined below:</p>
<div class="sourceCode" id="cb604"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">validateSelector</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span>, <span class="va">selector</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">selector</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Please choose either target or selector!"</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>


<span class="va">sendCustomMessage</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">type</span>, <span class="va">message</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>
    <span class="va">type</span>,
    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
      <span class="va">message</span>,
      auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>,
      json_verbatim <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="st">"%OR%"</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">)</span> <span class="va">a</span> <span class="kw">else</span> <span class="va">b</span>

<span class="va">addF7Tooltip</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">selector</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">options</span>,
                         <span class="va">session</span> <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># We use already defined popover functions</span>
  <span class="fu">validateSelector</span><span class="op">(</span><span class="va">id</span>, <span class="va">selector</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"#"</span>, <span class="va">session</span><span class="op">$</span><span class="fu">ns</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>
  <span class="va">options</span><span class="op">$</span><span class="va">targetEl</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">%OR%</span> <span class="va">selector</span>
  <span class="fu">sendCustomMessage</span><span class="op">(</span><span class="st">"add_tooltip"</span>, <span class="va">options</span>, <span class="va">session</span><span class="op">)</span>
<span class="op">}</span>


<span class="va">updateF7Tooltip</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">selector</span> <span class="op">=</span> <span class="cn">NULL</span>,
                            <span class="va">action</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"toggle"</span>, <span class="st">"update"</span><span class="op">)</span>, <span class="va">text</span> <span class="op">=</span> <span class="cn">NULL</span>,
                            <span class="va">session</span> <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">validateSelector</span><span class="op">(</span><span class="va">id</span>, <span class="va">selector</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"#"</span>, <span class="va">session</span><span class="op">$</span><span class="fu">ns</span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span>
  <span class="va">targetEl</span> <span class="op">&lt;-</span> <span class="va">id</span> <span class="op">%OR%</span> <span class="va">selector</span>
  <span class="va">message</span> <span class="op">&lt;-</span> <span class="fu">dropNulls</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>targetEl <span class="op">=</span> <span class="va">targetEl</span>, action <span class="op">=</span> <span class="va">action</span>, text <span class="op">=</span> <span class="va">text</span><span class="op">)</span><span class="op">)</span>
  <span class="fu">sendCustomMessage</span><span class="op">(</span><span class="st">"update_tooltip"</span>, <span class="va">message</span>, <span class="va">session</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Framework7 does not provide any native <code>enable/disable</code> method, which means that once the
tooltip is activated on a given element, it is visible forever, unless destroyed.
The main purpose of <code>updateF7Tooltip</code> is to avoid this, by temporarily disabling any tooltip and
reactivating it later.</p>
<p>The JS part to activate the tooltip is <code>tooltips.js</code>:</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb605-1"><a href="mobile-shinyMobile.html#cb605-1"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'add_tooltip'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb605-2"><a href="mobile-shinyMobile.html#cb605-2"></a>  <span class="va">app</span>.<span class="va">tooltip</span>.<span class="at">create</span>(message).<span class="at">show</span>()<span class="op">;</span></span>
<span id="cb605-3"><a href="mobile-shinyMobile.html#cb605-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>As mentioned earlier, this is fine since <code>message</code> is a JSON element. We can also chain methods
like <code>app.tooltip.create(message).show();</code>. There is however a problem: <code>add_tooltip</code> is fired
each time the user triggers a specific element on the R side. It means the tooltip instance is
created each time, which is not optimal. To fix this issue, we create a tooltips cache in the <code>app.data</code>
object and accordingly modify <code>init.js</code>:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb606-1"><a href="mobile-shinyMobile.html#cb606-1"></a><span class="va">config</span>.<span class="at">data</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb606-2"><a href="mobile-shinyMobile.html#cb606-2"></a>  <span class="cf">return</span> <span class="op">{</span></span>
<span id="cb606-3"><a href="mobile-shinyMobile.html#cb606-3"></a>    <span class="dt">tooltips</span><span class="op">:</span> []</span>
<span id="cb606-4"><a href="mobile-shinyMobile.html#cb606-4"></a>  <span class="op">};</span></span>
<span id="cb606-5"><a href="mobile-shinyMobile.html#cb606-5"></a><span class="op">};</span></span></code></pre></div>
<p>Importantly, <code>app.data</code> must be a function returning one or multiple elements. We first
return an empty <code>tooltips</code> array and update the <code>tooltips.js</code> file so that we:</p>
<ul>
<li>Check if the tooltip instance is already in the cached <code>app.data</code> before creating an instance.
If is is already there, nothing has to be done.</li>
<li>Each time we create a new instance, we save it in the <code>app.data</code> cache to retrieve it later.</li>
</ul>
<div class="sourceCode" id="cb607"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb607-1"><a href="mobile-shinyMobile.html#cb607-1"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'add_tooltip'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb607-2"><a href="mobile-shinyMobile.html#cb607-2"></a>  <span class="co">// We store all created instances in app data so that we don't</span></span>
<span id="cb607-3"><a href="mobile-shinyMobile.html#cb607-3"></a>  <span class="co">// recreate them later if they exist ...</span></span>
<span id="cb607-4"><a href="mobile-shinyMobile.html#cb607-4"></a>  <span class="cf">if</span> (<span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">===</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb607-5"><a href="mobile-shinyMobile.html#cb607-5"></a>    <span class="co">// create instance</span></span>
<span id="cb607-6"><a href="mobile-shinyMobile.html#cb607-6"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="va">app</span>.<span class="va">tooltip</span>.<span class="at">create</span>(message)<span class="op">;</span></span>
<span id="cb607-7"><a href="mobile-shinyMobile.html#cb607-7"></a>    <span class="co">// Open tooltip</span></span>
<span id="cb607-8"><a href="mobile-shinyMobile.html#cb607-8"></a>    <span class="va">t</span>.<span class="at">show</span>()<span class="op">;</span></span>
<span id="cb607-9"><a href="mobile-shinyMobile.html#cb607-9"></a>    <span class="co">// Storage in app data (tooltips array)</span></span>
<span id="cb607-10"><a href="mobile-shinyMobile.html#cb607-10"></a>    <span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">=</span> t<span class="op">;</span></span>
<span id="cb607-11"><a href="mobile-shinyMobile.html#cb607-11"></a>  <span class="op">}</span></span>
<span id="cb607-12"><a href="mobile-shinyMobile.html#cb607-12"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Notice how we store the current instance: <code>app.data.tooltips[message.targetEl] = t;</code>.
The reference is given by <code>message.targetEl</code> that is the target to apply the tooltip on.
When multiple tooltips are created, we may search for them by target name, which is
a reasonable choice. For instance <code>app.data.tooltips["#mybutton"]</code> points to the
tooltip associated to the element having <code>#mybutton</code> as id. So far so good!</p>
<p>How do we enable/disable tooltip then? This is the <code>updateF7Tooltip</code>
R function role. The corresponding JS handler:</p>
<ul>
<li>Checks if the specified tooltip instance exists and only update if it is the case.</li>
<li>Handles two situations: update the tooltip content or toggle the tooltip visibility (
It is actually more than just showing/hiding the tooltip. Remember that each tooltip is shown
on hover so applying hide on a visible tooltip will only have effect until the user
hover again over the same tooltip, which is useless).</li>
</ul>
<p><code>updateF7Tooltip</code> sends three elements to JS: the tooltip target element <code>message.targetEl</code>, the optional new text, that is <code>message.text</code> and the action to perform <code>message.action</code> (either update or toggle state).
Letâ€™s first update the tooltip element. In <code>tooltip.js</code>, we add:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb608-1"><a href="mobile-shinyMobile.html#cb608-1"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'update_tooltip'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb608-2"><a href="mobile-shinyMobile.html#cb608-2"></a>  <span class="co">// Don't do anything if the instance is not there in app data</span></span>
<span id="cb608-3"><a href="mobile-shinyMobile.html#cb608-3"></a>  <span class="cf">if</span> (<span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">!==</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb608-4"><a href="mobile-shinyMobile.html#cb608-4"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>]<span class="op">;</span></span>
<span id="cb608-5"><a href="mobile-shinyMobile.html#cb608-5"></a>    <span class="cf">if</span> (<span class="va">message</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">"update"</span>) <span class="op">{</span></span>
<span id="cb608-6"><a href="mobile-shinyMobile.html#cb608-6"></a>      <span class="va">t</span>.<span class="at">setText</span>(<span class="va">message</span>.<span class="at">text</span>)<span class="op">;</span></span>
<span id="cb608-7"><a href="mobile-shinyMobile.html#cb608-7"></a>    <span class="op">}</span></span>
<span id="cb608-8"><a href="mobile-shinyMobile.html#cb608-8"></a>  <span class="op">}</span></span>
<span id="cb608-9"><a href="mobile-shinyMobile.html#cb608-9"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>The corresponding tooltip instance is accessed in <code>app.data</code> with <code>app.data.tooltips[message.targetEl]</code>
and stored in a local variable, <code>t</code>. We apply <code>setText</code> only if the user action corresponds to <code>update</code>.</p>
<p>We handle the <code>toggle</code> case. The first thing to check is whether the current instance is active.
We do it with the <code>app.tooltip.get</code> method targeted on <code>message.targetEl</code>. If the instance is
alive, we get an object, while we obtain undefined if it does not exist. We then call the <code>app.tooltip.destroy</code> method
on the current instance:</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb609-1"><a href="mobile-shinyMobile.html#cb609-1"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'update_tooltip'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb609-2"><a href="mobile-shinyMobile.html#cb609-2"></a>  <span class="co">// Don't do anything if the instance is not there in app data</span></span>
<span id="cb609-3"><a href="mobile-shinyMobile.html#cb609-3"></a>  <span class="cf">if</span> (<span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">!==</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb609-4"><a href="mobile-shinyMobile.html#cb609-4"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="va">app</span>.<span class="va">tooltip</span>.<span class="at">get</span>(<span class="va">message</span>.<span class="at">targetEl</span>)<span class="op">;</span></span>
<span id="cb609-5"><a href="mobile-shinyMobile.html#cb609-5"></a>    <span class="cf">if</span> (<span class="va">message</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">"update"</span>) <span class="op">{</span></span>
<span id="cb609-6"><a href="mobile-shinyMobile.html#cb609-6"></a>      <span class="va">t</span>.<span class="at">setText</span>(<span class="va">message</span>.<span class="at">text</span>)<span class="op">;</span></span>
<span id="cb609-7"><a href="mobile-shinyMobile.html#cb609-7"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">message</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">"toggle"</span>) <span class="op">{</span></span>
<span id="cb609-8"><a href="mobile-shinyMobile.html#cb609-8"></a>      <span class="co">// destroy</span></span>
<span id="cb609-9"><a href="mobile-shinyMobile.html#cb609-9"></a>      <span class="cf">if</span> (t) <span class="op">{</span></span>
<span id="cb609-10"><a href="mobile-shinyMobile.html#cb609-10"></a>        <span class="va">t</span>.<span class="at">destroy</span>()<span class="op">;</span></span>
<span id="cb609-11"><a href="mobile-shinyMobile.html#cb609-11"></a>      <span class="op">}</span></span>
<span id="cb609-12"><a href="mobile-shinyMobile.html#cb609-12"></a>    <span class="op">}</span></span>
<span id="cb609-13"><a href="mobile-shinyMobile.html#cb609-13"></a>  <span class="op">}</span></span>
<span id="cb609-14"><a href="mobile-shinyMobile.html#cb609-14"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Wait a moment! There are 2 issues with this code. The first is that <code>t</code> is a variable pointing
to the current instance. If we destroy that instance, <code>t</code> will point to a destoyed element the next time it is called, and any action like <code>setText</code> will raise an error. The trick is to create a deep clone with <code>Object.assign</code> that wonâ€™t be affected by the <code>destroy</code> method, save the deep clone in the <code>app.data</code> cache and destroy the old instance. Therefore we update the <code>tooltips.js</code> script:</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb610-1"><a href="mobile-shinyMobile.html#cb610-1"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'update_tooltip'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb610-2"><a href="mobile-shinyMobile.html#cb610-2"></a>  <span class="cf">if</span> (<span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">!==</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb610-3"><a href="mobile-shinyMobile.html#cb610-3"></a>    <span class="co">// Try to get the instance</span></span>
<span id="cb610-4"><a href="mobile-shinyMobile.html#cb610-4"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="va">app</span>.<span class="va">tooltip</span>.<span class="at">get</span>(<span class="va">message</span>.<span class="at">targetEl</span>)<span class="op">;</span></span>
<span id="cb610-5"><a href="mobile-shinyMobile.html#cb610-5"></a>    <span class="cf">if</span> (<span class="va">message</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">"update"</span>) <span class="op">{</span></span>
<span id="cb610-6"><a href="mobile-shinyMobile.html#cb610-6"></a>      <span class="cf">if</span> (t) <span class="op">{</span></span>
<span id="cb610-7"><a href="mobile-shinyMobile.html#cb610-7"></a>        <span class="va">t</span>.<span class="at">setText</span>(<span class="va">message</span>.<span class="at">text</span>)<span class="op">;</span></span>
<span id="cb610-8"><a href="mobile-shinyMobile.html#cb610-8"></a>      <span class="op">}</span></span>
<span id="cb610-9"><a href="mobile-shinyMobile.html#cb610-9"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">message</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">"toggle"</span>) <span class="op">{</span></span>
<span id="cb610-10"><a href="mobile-shinyMobile.html#cb610-10"></a>      <span class="cf">if</span> (t) <span class="op">{</span></span>
<span id="cb610-11"><a href="mobile-shinyMobile.html#cb610-11"></a>        <span class="co">// create copy that won't be modified if t is destroyed!</span></span>
<span id="cb610-12"><a href="mobile-shinyMobile.html#cb610-12"></a>        <span class="kw">var</span> cachedTooltip <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> t)<span class="op">;</span></span>
<span id="cb610-13"><a href="mobile-shinyMobile.html#cb610-13"></a>        <span class="co">// save copy to replace the deleted one in the app data</span></span>
<span id="cb610-14"><a href="mobile-shinyMobile.html#cb610-14"></a>        <span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">=</span> cachedTooltip<span class="op">;</span></span>
<span id="cb610-15"><a href="mobile-shinyMobile.html#cb610-15"></a>        <span class="co">// destroy current instance</span></span>
<span id="cb610-16"><a href="mobile-shinyMobile.html#cb610-16"></a>        <span class="va">t</span>.<span class="at">destroy</span>()<span class="op">;</span></span>
<span id="cb610-17"><a href="mobile-shinyMobile.html#cb610-17"></a>      <span class="op">}</span> </span>
<span id="cb610-18"><a href="mobile-shinyMobile.html#cb610-18"></a>    <span class="op">}</span></span>
<span id="cb610-19"><a href="mobile-shinyMobile.html#cb610-19"></a>  <span class="op">}</span></span>
<span id="cb610-20"><a href="mobile-shinyMobile.html#cb610-20"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>We also check whether the instance is alive before updating it. We are still missing the <code>re-activation</code> step that consists in rebuilding the tooltip instance based on the cached data <code>app.data.tooltips[message.targetEl]</code> previously saved. All parameters are contained in the <code>params</code> object (instance element):</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb611-1"><a href="mobile-shinyMobile.html#cb611-1"></a><span class="co">// Capture parameters</span></span>
<span id="cb611-2"><a href="mobile-shinyMobile.html#cb611-2"></a><span class="kw">var</span> pars <span class="op">=</span> <span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>].<span class="at">params</span><span class="op">;</span></span>
<span id="cb611-3"><a href="mobile-shinyMobile.html#cb611-3"></a><span class="co">// Recreate the tooltip based on the copy configuration</span></span>
<span id="cb611-4"><a href="mobile-shinyMobile.html#cb611-4"></a>t <span class="op">=</span> <span class="va">app</span>.<span class="va">tooltip</span>.<span class="at">create</span>(pars)<span class="op">;</span></span>
<span id="cb611-5"><a href="mobile-shinyMobile.html#cb611-5"></a><span class="co">// Replace the app data instance</span></span>
<span id="cb611-6"><a href="mobile-shinyMobile.html#cb611-6"></a><span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">=</span> t<span class="op">;</span></span></code></pre></div>
<p>The final JS code is:</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb612-1"><a href="mobile-shinyMobile.html#cb612-1"></a><span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">'update_tooltip'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb612-2"><a href="mobile-shinyMobile.html#cb612-2"></a>  <span class="cf">if</span> (<span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">!==</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb612-3"><a href="mobile-shinyMobile.html#cb612-3"></a>    <span class="co">// Try to get the instance</span></span>
<span id="cb612-4"><a href="mobile-shinyMobile.html#cb612-4"></a>    <span class="kw">var</span> t <span class="op">=</span> <span class="va">app</span>.<span class="va">tooltip</span>.<span class="at">get</span>(<span class="va">message</span>.<span class="at">targetEl</span>)<span class="op">;</span></span>
<span id="cb612-5"><a href="mobile-shinyMobile.html#cb612-5"></a>    <span class="cf">if</span> (<span class="va">message</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">"update"</span>) <span class="op">{</span></span>
<span id="cb612-6"><a href="mobile-shinyMobile.html#cb612-6"></a>      <span class="cf">if</span> (t) <span class="op">{</span></span>
<span id="cb612-7"><a href="mobile-shinyMobile.html#cb612-7"></a>        <span class="va">t</span>.<span class="at">setText</span>(<span class="va">message</span>.<span class="at">text</span>)<span class="op">;</span></span>
<span id="cb612-8"><a href="mobile-shinyMobile.html#cb612-8"></a>      <span class="op">}</span></span>
<span id="cb612-9"><a href="mobile-shinyMobile.html#cb612-9"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (<span class="va">message</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">"toggle"</span>) <span class="op">{</span></span>
<span id="cb612-10"><a href="mobile-shinyMobile.html#cb612-10"></a>      <span class="cf">if</span> (t) <span class="op">{</span></span>
<span id="cb612-11"><a href="mobile-shinyMobile.html#cb612-11"></a>        <span class="co">// create copy that won't be modified if t is destroyed!</span></span>
<span id="cb612-12"><a href="mobile-shinyMobile.html#cb612-12"></a>        <span class="kw">var</span> cachedTooltip <span class="op">=</span> <span class="va">Object</span>.<span class="at">assign</span>(<span class="op">{},</span> t)<span class="op">;</span></span>
<span id="cb612-13"><a href="mobile-shinyMobile.html#cb612-13"></a>        <span class="co">// save copy to replace the deleted one in the app data</span></span>
<span id="cb612-14"><a href="mobile-shinyMobile.html#cb612-14"></a>        <span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">=</span> cachedTooltip<span class="op">;</span></span>
<span id="cb612-15"><a href="mobile-shinyMobile.html#cb612-15"></a>        <span class="co">// destroy current instance</span></span>
<span id="cb612-16"><a href="mobile-shinyMobile.html#cb612-16"></a>        <span class="va">t</span>.<span class="at">destroy</span>()<span class="op">;</span></span>
<span id="cb612-17"><a href="mobile-shinyMobile.html#cb612-17"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb612-18"><a href="mobile-shinyMobile.html#cb612-18"></a>        <span class="co">// Parameters</span></span>
<span id="cb612-19"><a href="mobile-shinyMobile.html#cb612-19"></a>        <span class="kw">var</span> pars <span class="op">=</span> <span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>].<span class="at">params</span><span class="op">;</span></span>
<span id="cb612-20"><a href="mobile-shinyMobile.html#cb612-20"></a>        <span class="co">// recreate the tooltip based on the copy configuration</span></span>
<span id="cb612-21"><a href="mobile-shinyMobile.html#cb612-21"></a>        t <span class="op">=</span> <span class="va">app</span>.<span class="va">tooltip</span>.<span class="at">create</span>(pars)<span class="op">;</span></span>
<span id="cb612-22"><a href="mobile-shinyMobile.html#cb612-22"></a>        <span class="va">app</span>.<span class="va">data</span>.<span class="at">tooltips</span>[<span class="va">message</span>.<span class="at">targetEl</span>] <span class="op">=</span> t<span class="op">;</span></span>
<span id="cb612-23"><a href="mobile-shinyMobile.html#cb612-23"></a>      <span class="op">}</span></span>
<span id="cb612-24"><a href="mobile-shinyMobile.html#cb612-24"></a>    <span class="op">}</span></span>
<span id="cb612-25"><a href="mobile-shinyMobile.html#cb612-25"></a>  <span class="op">}</span></span>
<span id="cb612-26"><a href="mobile-shinyMobile.html#cb612-26"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Similarly <strong>methods</strong> hosts all global app methods. These are functions you may re-use in different parts. Like for <code>app.data</code>, we access them with <code>app.methods</code>.</p>
<div class="importantblock">
<p><code>app.data</code> has been removed since Framework7 6.0.0!</p>
</div>
</div>
</div>
<div id="theming-and-colors" class="section level2">
<h2>
<span class="header-section-number">24.6</span> Theming and colors<a class="anchor" aria-label="anchor" href="#theming-and-colors"><i class="fas fa-link"></i></a>
</h2>
<p>Framework7 offers 15 color <a href="https://framework7.io/docs/color-themes.html?theme=light&amp;bars=empty&amp;color=%09+%23673ab7">themes</a> with a dark/light global appearance. To apply them, we add <code>color-theme-COLOR</code> to the
parent element. Best practice is to target the <code>body</code> since it is the parent of all the page
content, thereby ensuring global consistency. The dark theme is triggered by adding the
<code>theme-dark</code> class to <code>html</code>. Since <code>body</code> belongs to <code>f7_page</code> but not <code>html</code> (added by
Shiny at startup), we can apply the color in R, while the dark mode has to be activated
from JS:</p>
<div class="sourceCode" id="cb613"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">theme</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ios"</span>, <span class="st">"md"</span>, <span class="st">"aurora"</span><span class="op">)</span>, 
                    <span class="va">color</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">body_cl</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">color</span><span class="op">)</span><span class="op">)</span> <span class="va">body_cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"color-theme-color"</span><span class="op">)</span>
  
  <span class="co"># Modify the body tag to add a class</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
    class <span class="op">=</span> <span class="va">body_cl</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"app"</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
        class <span class="op">=</span> <span class="st">"view view-main"</span>,
        <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
          class <span class="op">=</span> <span class="st">"page"</span>,
          <span class="va">navbar</span>,
          <span class="va">toolbar</span>,
          <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
            class <span class="op">=</span> <span class="st">"page-content"</span>,
            <span class="va">...</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    <span class="va">config_tag</span>
  <span class="op">)</span>
  
  <span class="co"># ...</span>
  
<span class="op">}</span></code></pre></div>
<p>This approach assumes the user to pass the color name as parameter like <code>pink</code>, <code>yellow</code>.
What if we want to allow more flexibility and add any existing HEX color?
Framework7 has tools, namely <code>app.utils.colorThemeCSSProperties</code>, that is a JS method
creating the required CSS on the fly depending on the provided HEX color. For instance, if we select a
cyberpunk green color:</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb614-1"><a href="mobile-shinyMobile.html#cb614-1"></a><span class="va">app</span>.<span class="va">utils</span>.<span class="at">colorThemeCSSProperties</span>(<span class="st">'#42f5a1'</span>)<span class="op">;</span></span>
<span id="cb614-2"><a href="mobile-shinyMobile.html#cb614-2"></a><span class="co">// /* Custom color theme */</span></span>
<span id="cb614-3"><a href="mobile-shinyMobile.html#cb614-3"></a><span class="co">// {</span></span>
<span id="cb614-4"><a href="mobile-shinyMobile.html#cb614-4"></a><span class="co">//   "--f7-theme-color": "#42f5a1";</span></span>
<span id="cb614-5"><a href="mobile-shinyMobile.html#cb614-5"></a><span class="co">//   "--f7-theme-color-rgb": "66, 245, 161";</span></span>
<span id="cb614-6"><a href="mobile-shinyMobile.html#cb614-6"></a><span class="co">//   "--f7-theme-color-shade": "#1bf38e";</span></span>
<span id="cb614-7"><a href="mobile-shinyMobile.html#cb614-7"></a><span class="co">//   "--f7-theme-color-tint": "#69f7b4";</span></span>
<span id="cb614-8"><a href="mobile-shinyMobile.html#cb614-8"></a><span class="co">// }</span></span></code></pre></div>
<p>The commented code has to be injected in the app CSS. I personally donâ€™t think its a problem
to look for a specific HEX code, knowing that many tools can help. Therefore, I prefer the
second approach. We edit the <code>init.js</code> code by adding the following JS snippet:</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb615-1"><a href="mobile-shinyMobile.html#cb615-1"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'color'</span>)) <span class="op">{</span></span>
<span id="cb615-2"><a href="mobile-shinyMobile.html#cb615-2"></a>  <span class="kw">var</span> colorCSS <span class="op">=</span> <span class="va">app</span>.<span class="va">utils</span>.<span class="at">colorThemeCSSProperties</span>(<span class="va">config</span>.<span class="at">color</span>)<span class="op">;</span></span>
<span id="cb615-3"><a href="mobile-shinyMobile.html#cb615-3"></a>  <span class="at">$</span>(<span class="st">'&lt;style&gt;'</span>)</span>
<span id="cb615-4"><a href="mobile-shinyMobile.html#cb615-4"></a>    .<span class="at">prop</span>(<span class="st">'type'</span><span class="op">,</span> <span class="st">'text/css'</span>)</span>
<span id="cb615-5"><a href="mobile-shinyMobile.html#cb615-5"></a>    .<span class="at">html</span>(<span class="vs">`:root {</span></span>
<span id="cb615-6"><a href="mobile-shinyMobile.html#cb615-6"></a><span class="vs">      --f7-theme-color: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb615-7"><a href="mobile-shinyMobile.html#cb615-7"></a><span class="vs">      --f7-theme-color-rgb: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-rgb"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb615-8"><a href="mobile-shinyMobile.html#cb615-8"></a><span class="vs">      --f7-theme-color-shade: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-shade"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb615-9"><a href="mobile-shinyMobile.html#cb615-9"></a><span class="vs">      --f7-theme-color-tint: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-tint"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb615-10"><a href="mobile-shinyMobile.html#cb615-10"></a><span class="vs">    }`</span>)</span>
<span id="cb615-11"><a href="mobile-shinyMobile.html#cb615-11"></a>    .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb615-12"><a href="mobile-shinyMobile.html#cb615-12"></a><span class="op">}</span></span></code></pre></div>
<p><code>config.hasOwnProperty('color')</code> ensures that this code does not run if color is missing from the
provided config. Then, we generate an object containing the theme color properties with <code>app.utils.colorThemeCSSProperties(config.color)</code>.
Importantly, as this is an object, we canâ€™t insert it in a string. However, we can extract its
properties 1 by 1 to generate the relevant piece of CSS. Then we add a <code>style</code> tag to the <code>head</code>
containing the following CSS rule:</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb616-1"><a href="mobile-shinyMobile.html#cb616-1"></a><span class="co">/* Custom color theme */</span></span>
<span id="cb616-2"><a href="mobile-shinyMobile.html#cb616-2"></a><span class="in">:root</span> {</span>
<span id="cb616-3"><a href="mobile-shinyMobile.html#cb616-3"></a>  --f7-theme-color: <span class="cn">#42f5a1</span><span class="op">;</span></span>
<span id="cb616-4"><a href="mobile-shinyMobile.html#cb616-4"></a>  --f7-theme-color-rgb: <span class="dv">66</span><span class="op">,</span> <span class="dv">245</span><span class="op">,</span> <span class="dv">161</span><span class="op">;</span></span>
<span id="cb616-5"><a href="mobile-shinyMobile.html#cb616-5"></a>  --f7-theme-color-shade: <span class="cn">#1bf38e</span><span class="op">;</span></span>
<span id="cb616-6"><a href="mobile-shinyMobile.html#cb616-6"></a>  --f7-theme-color-tint: <span class="cn">#69f7b4</span><span class="op">;</span></span>
<span id="cb616-7"><a href="mobile-shinyMobile.html#cb616-7"></a>}</span></code></pre></div>
<p>For each property like <code>--f7-theme-color</code>, we recover the corresponding value in the
<code>colorCSS</code> object, that is <code>colorCSS["--f7-theme-color"]</code>. Once done, recompile the JS
with <code>build_js</code> and try with the following app:</p>
<div class="sourceCode" id="cb617"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/load_all.html">load_all</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
        class <span class="op">=</span> <span class="st">"list inset"</span>,
        <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span>
            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span>
                <span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>
                    href <span class="op">=</span> <span class="st">"#"</span>,
                    id <span class="op">=</span> <span class="st">"mybutton"</span>,
                    class <span class="op">=</span> <span class="st">"list-button"</span>,
                    <span class="st">"Large Green Button"</span>
                <span class="op">)</span>
            <span class="op">)</span>
        <span class="op">)</span>
    <span class="op">)</span>,
    navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Title"</span><span class="op">)</span>,
    toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"shinyMobile"</span>,
    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theme <span class="op">=</span> <span class="st">"ios"</span>, version <span class="op">=</span> <span class="st">"1.0.0"</span>, taphold <span class="op">=</span> <span class="cn">TRUE</span>, color <span class="op">=</span> <span class="st">"#42f5a1"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>We can go further and apply the <code>filled</code> theme, which is an alternative design where all
<code>navbar</code>, <code>toolbar</code>, â€¦ are filled with the theme color. In that case, we add the following CSS:</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb618-1"><a href="mobile-shinyMobile.html#cb618-1"></a><span class="co">/* Invert navigation bars to fill style */</span></span>
<span id="cb618-2"><a href="mobile-shinyMobile.html#cb618-2"></a><span class="in">:root</span><span class="op">,</span></span>
<span id="cb618-3"><a href="mobile-shinyMobile.html#cb618-3"></a><span class="in">:root</span><span class="fu">.theme-dark</span><span class="op">,</span></span>
<span id="cb618-4"><a href="mobile-shinyMobile.html#cb618-4"></a><span class="in">:root</span> <span class="fu">.theme-dark</span> {</span>
<span id="cb618-5"><a href="mobile-shinyMobile.html#cb618-5"></a>  --f7-bars-bg-color: <span class="fu">var(</span><span class="va">--f7-theme-color</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-6"><a href="mobile-shinyMobile.html#cb618-6"></a>  --f7-bars-bg-color-rgb: <span class="fu">var(</span><span class="va">--f7-theme-color-rgb</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-7"><a href="mobile-shinyMobile.html#cb618-7"></a>  --f7-bars-translucent-opacity: <span class="dv">0.9</span><span class="op">;</span></span>
<span id="cb618-8"><a href="mobile-shinyMobile.html#cb618-8"></a>  --f7-bars-text-color: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb618-9"><a href="mobile-shinyMobile.html#cb618-9"></a>  --f7-bars-link-color: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb618-10"><a href="mobile-shinyMobile.html#cb618-10"></a>  --f7-navbar-subtitle-text-color: <span class="fu">rgba(</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">0.85</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-11"><a href="mobile-shinyMobile.html#cb618-11"></a>  --f7-bars-border-color: <span class="dv">transparent</span><span class="op">;</span></span>
<span id="cb618-12"><a href="mobile-shinyMobile.html#cb618-12"></a>  --f7-tabbar-link-active-color: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb618-13"><a href="mobile-shinyMobile.html#cb618-13"></a>  --f7-tabbar-link-inactive-color: <span class="fu">rgba(</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">0.54</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-14"><a href="mobile-shinyMobile.html#cb618-14"></a>  --f7-sheet-border-color: <span class="dv">transparent</span><span class="op">;</span></span>
<span id="cb618-15"><a href="mobile-shinyMobile.html#cb618-15"></a>  --f7-tabbar-link-active-border-color: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb618-16"><a href="mobile-shinyMobile.html#cb618-16"></a>}</span>
<span id="cb618-17"><a href="mobile-shinyMobile.html#cb618-17"></a><span class="fu">.appbar</span><span class="op">,</span></span>
<span id="cb618-18"><a href="mobile-shinyMobile.html#cb618-18"></a><span class="fu">.navbar</span><span class="op">,</span></span>
<span id="cb618-19"><a href="mobile-shinyMobile.html#cb618-19"></a><span class="fu">.toolbar</span><span class="op">,</span></span>
<span id="cb618-20"><a href="mobile-shinyMobile.html#cb618-20"></a><span class="fu">.subnavbar</span><span class="op">,</span></span>
<span id="cb618-21"><a href="mobile-shinyMobile.html#cb618-21"></a><span class="fu">.calendar-header</span><span class="op">,</span></span>
<span id="cb618-22"><a href="mobile-shinyMobile.html#cb618-22"></a><span class="fu">.calendar-footer</span> {</span>
<span id="cb618-23"><a href="mobile-shinyMobile.html#cb618-23"></a>  --f7-touch-ripple-color: <span class="fu">var(</span><span class="va">--f7-touch-ripple-white</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-24"><a href="mobile-shinyMobile.html#cb618-24"></a>  --f7-link-highlight-color: <span class="fu">var(</span><span class="va">--f7-link-highlight-white</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-25"><a href="mobile-shinyMobile.html#cb618-25"></a>  --f7-button-text-color: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb618-26"><a href="mobile-shinyMobile.html#cb618-26"></a>  --f7-button-pressed-bg-color: <span class="fu">rgba(</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">0.1</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-27"><a href="mobile-shinyMobile.html#cb618-27"></a>}</span>
<span id="cb618-28"><a href="mobile-shinyMobile.html#cb618-28"></a><span class="fu">.navbar-large-transparent</span><span class="op">,</span></span>
<span id="cb618-29"><a href="mobile-shinyMobile.html#cb618-29"></a><span class="fu">.navbar-large.navbar-transparent</span> {</span>
<span id="cb618-30"><a href="mobile-shinyMobile.html#cb618-30"></a>  --f7-navbar-large-title-text-color: <span class="cn">#000</span><span class="op">;</span></span>
<span id="cb618-31"><a href="mobile-shinyMobile.html#cb618-31"></a></span>
<span id="cb618-32"><a href="mobile-shinyMobile.html#cb618-32"></a>  <span class="va">--r</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb618-33"><a href="mobile-shinyMobile.html#cb618-33"></a>  <span class="va">--g</span>: <span class="dv">122</span><span class="op">;</span></span>
<span id="cb618-34"><a href="mobile-shinyMobile.html#cb618-34"></a>  <span class="va">--b</span>: <span class="dv">255</span><span class="op">;</span></span>
<span id="cb618-35"><a href="mobile-shinyMobile.html#cb618-35"></a>  <span class="va">--progress</span>: <span class="fu">var(</span><span class="va">--f7-navbar-large-collapse-progress</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb618-36"><a href="mobile-shinyMobile.html#cb618-36"></a>  --f7-bars-link-color: <span class="fu">rgb(</span></span>
<span id="cb618-37"><a href="mobile-shinyMobile.html#cb618-37"></a>    calc(var(--r<span class="fu">)</span> + (<span class="dv">255</span> - <span class="fu">var(</span><span class="va">--r</span><span class="fu">)</span>) * <span class="fu">var(</span><span class="va">--progress</span><span class="fu">)</span>)<span class="op">,</span></span>
<span id="cb618-38"><a href="mobile-shinyMobile.html#cb618-38"></a>    <span class="fu">calc(var(</span><span class="va">--g</span><span class="fu">)</span> <span class="op">+</span> (<span class="dv">255</span> <span class="op">-</span> <span class="fu">var(</span><span class="va">--g</span><span class="fu">)</span>) <span class="op">*</span> <span class="fu">var(</span><span class="va">--progress</span><span class="fu">))</span><span class="op">,</span></span>
<span id="cb618-39"><a href="mobile-shinyMobile.html#cb618-39"></a>    <span class="fu">calc(var(</span><span class="va">--b</span><span class="fu">)</span> <span class="op">+</span> (<span class="dv">255</span> <span class="op">-</span> <span class="fu">var(</span><span class="va">--b</span><span class="fu">)</span>) <span class="op">*</span> <span class="fu">var(</span><span class="va">--progress</span><span class="fu">))</span></span>
<span id="cb618-40"><a href="mobile-shinyMobile.html#cb618-40"></a>  )<span class="op">;</span></span>
<span id="cb618-41"><a href="mobile-shinyMobile.html#cb618-41"></a>}</span>
<span id="cb618-42"><a href="mobile-shinyMobile.html#cb618-42"></a><span class="fu">.theme-dark</span> <span class="fu">.navbar-large-transparent</span><span class="op">,</span></span>
<span id="cb618-43"><a href="mobile-shinyMobile.html#cb618-43"></a><span class="fu">.theme-dark</span> <span class="fu">.navbar-large.navbar-transparent</span> {</span>
<span id="cb618-44"><a href="mobile-shinyMobile.html#cb618-44"></a>  --f7-navbar-large-title-text-color: <span class="cn">#fff</span><span class="op">;</span></span>
<span id="cb618-45"><a href="mobile-shinyMobile.html#cb618-45"></a>}</span></code></pre></div>
<p>Like above, we do this on the JS side in <code>init.js</code>:</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb619-1"><a href="mobile-shinyMobile.html#cb619-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'filled'</span>)) <span class="va">config</span>.<span class="at">filled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb619-2"><a href="mobile-shinyMobile.html#cb619-2"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">filled</span>) <span class="op">{</span></span>
<span id="cb619-3"><a href="mobile-shinyMobile.html#cb619-3"></a>  <span class="kw">var</span> filledCSS <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb619-4"><a href="mobile-shinyMobile.html#cb619-4"></a><span class="vs">    :root,</span></span>
<span id="cb619-5"><a href="mobile-shinyMobile.html#cb619-5"></a><span class="vs">    :root.theme-dark,</span></span>
<span id="cb619-6"><a href="mobile-shinyMobile.html#cb619-6"></a><span class="vs">    :root .theme-dark {</span></span>
<span id="cb619-7"><a href="mobile-shinyMobile.html#cb619-7"></a><span class="vs">      --f7-bars-bg-color: var(--f7-theme-color);</span></span>
<span id="cb619-8"><a href="mobile-shinyMobile.html#cb619-8"></a><span class="vs">      --f7-bars-bg-color-rgb: var(--f7-theme-color-rgb);</span></span>
<span id="cb619-9"><a href="mobile-shinyMobile.html#cb619-9"></a><span class="vs">      --f7-bars-translucent-opacity: 0.9;</span></span>
<span id="cb619-10"><a href="mobile-shinyMobile.html#cb619-10"></a><span class="vs">      --f7-bars-text-color: #fff;</span></span>
<span id="cb619-11"><a href="mobile-shinyMobile.html#cb619-11"></a><span class="vs">      --f7-bars-link-color: #fff;</span></span>
<span id="cb619-12"><a href="mobile-shinyMobile.html#cb619-12"></a><span class="vs">      --f7-navbar-subtitle-text-color: rgba(255,255,255,0.85);</span></span>
<span id="cb619-13"><a href="mobile-shinyMobile.html#cb619-13"></a><span class="vs">      --f7-bars-border-color: transparent;</span></span>
<span id="cb619-14"><a href="mobile-shinyMobile.html#cb619-14"></a><span class="vs">      --f7-tabbar-link-active-color: #fff;</span></span>
<span id="cb619-15"><a href="mobile-shinyMobile.html#cb619-15"></a><span class="vs">      --f7-tabbar-link-inactive-color: rgba(255,255,255,0.54);</span></span>
<span id="cb619-16"><a href="mobile-shinyMobile.html#cb619-16"></a><span class="vs">      --f7-sheet-border-color: transparent;</span></span>
<span id="cb619-17"><a href="mobile-shinyMobile.html#cb619-17"></a><span class="vs">      --f7-tabbar-link-active-border-color: #fff;</span></span>
<span id="cb619-18"><a href="mobile-shinyMobile.html#cb619-18"></a><span class="vs">    }</span></span>
<span id="cb619-19"><a href="mobile-shinyMobile.html#cb619-19"></a><span class="vs">    .appbar,</span></span>
<span id="cb619-20"><a href="mobile-shinyMobile.html#cb619-20"></a><span class="vs">    .navbar,</span></span>
<span id="cb619-21"><a href="mobile-shinyMobile.html#cb619-21"></a><span class="vs">    .toolbar,</span></span>
<span id="cb619-22"><a href="mobile-shinyMobile.html#cb619-22"></a><span class="vs">    .subnavbar,</span></span>
<span id="cb619-23"><a href="mobile-shinyMobile.html#cb619-23"></a><span class="vs">    .calendar-header,</span></span>
<span id="cb619-24"><a href="mobile-shinyMobile.html#cb619-24"></a><span class="vs">    .calendar-footer {</span></span>
<span id="cb619-25"><a href="mobile-shinyMobile.html#cb619-25"></a><span class="vs">      --f7-touch-ripple-color: var(--f7-touch-ripple-white);</span></span>
<span id="cb619-26"><a href="mobile-shinyMobile.html#cb619-26"></a><span class="vs">      --f7-link-highlight-color: var(--f7-link-highlight-white);</span></span>
<span id="cb619-27"><a href="mobile-shinyMobile.html#cb619-27"></a><span class="vs">      --f7-button-text-color: #fff;</span></span>
<span id="cb619-28"><a href="mobile-shinyMobile.html#cb619-28"></a><span class="vs">      --f7-button-pressed-bg-color: rgba(255,255,255,0.1);</span></span>
<span id="cb619-29"><a href="mobile-shinyMobile.html#cb619-29"></a><span class="vs">    }</span></span>
<span id="cb619-30"><a href="mobile-shinyMobile.html#cb619-30"></a><span class="vs">    .navbar-large-transparent,</span></span>
<span id="cb619-31"><a href="mobile-shinyMobile.html#cb619-31"></a><span class="vs">    .navbar-large.navbar-transparent {</span></span>
<span id="cb619-32"><a href="mobile-shinyMobile.html#cb619-32"></a><span class="vs">      --f7-navbar-large-title-text-color: #000;</span></span>
<span id="cb619-33"><a href="mobile-shinyMobile.html#cb619-33"></a><span class="vs">    </span></span>
<span id="cb619-34"><a href="mobile-shinyMobile.html#cb619-34"></a><span class="vs">      --r: 0;</span></span>
<span id="cb619-35"><a href="mobile-shinyMobile.html#cb619-35"></a><span class="vs">      --g: 122;</span></span>
<span id="cb619-36"><a href="mobile-shinyMobile.html#cb619-36"></a><span class="vs">      --b: 255;</span></span>
<span id="cb619-37"><a href="mobile-shinyMobile.html#cb619-37"></a><span class="vs">      --progress: var(--f7-navbar-large-collapse-progress);</span></span>
<span id="cb619-38"><a href="mobile-shinyMobile.html#cb619-38"></a><span class="vs">      --f7-bars-link-color: rgb(</span></span>
<span id="cb619-39"><a href="mobile-shinyMobile.html#cb619-39"></a><span class="vs">        calc(var(--r) + (255 - var(--r)) * var(--progress)),</span></span>
<span id="cb619-40"><a href="mobile-shinyMobile.html#cb619-40"></a><span class="vs">        calc(var(--g) + (255 - var(--g)) * var(--progress)),</span></span>
<span id="cb619-41"><a href="mobile-shinyMobile.html#cb619-41"></a><span class="vs">        calc(var(--b) + (255 - var(--b)) * var(--progress))</span></span>
<span id="cb619-42"><a href="mobile-shinyMobile.html#cb619-42"></a><span class="vs">      );</span></span>
<span id="cb619-43"><a href="mobile-shinyMobile.html#cb619-43"></a><span class="vs">    }</span></span>
<span id="cb619-44"><a href="mobile-shinyMobile.html#cb619-44"></a><span class="vs">    .theme-dark .navbar-large-transparent,</span></span>
<span id="cb619-45"><a href="mobile-shinyMobile.html#cb619-45"></a><span class="vs">    .theme-dark .navbar-large.navbar-transparent {</span></span>
<span id="cb619-46"><a href="mobile-shinyMobile.html#cb619-46"></a><span class="vs">      --f7-navbar-large-title-text-color: #fff;</span></span>
<span id="cb619-47"><a href="mobile-shinyMobile.html#cb619-47"></a><span class="vs">  }`</span><span class="op">;</span></span>
<span id="cb619-48"><a href="mobile-shinyMobile.html#cb619-48"></a>  </span>
<span id="cb619-49"><a href="mobile-shinyMobile.html#cb619-49"></a>  <span class="at">$</span>(<span class="st">'&lt;style&gt;'</span>)</span>
<span id="cb619-50"><a href="mobile-shinyMobile.html#cb619-50"></a>    .<span class="at">prop</span>(<span class="st">'type'</span><span class="op">,</span> <span class="st">'text/css'</span>)</span>
<span id="cb619-51"><a href="mobile-shinyMobile.html#cb619-51"></a>    .<span class="at">html</span>(<span class="vs">`</span><span class="sc">${</span>filledCSS<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb619-52"><a href="mobile-shinyMobile.html#cb619-52"></a>    .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb619-53"><a href="mobile-shinyMobile.html#cb619-53"></a><span class="op">}</span></span></code></pre></div>
<p>The result is displayed on Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-theming">24.5</a>. Donâ€™t forget
to pass the <code>filled</code> property to the config list.</p>
<div class="figure">
<span id="fig:mobile-shinyMobile-theming"></span>
<img src="images/mobile/mobile-shinymobile-theming.png" alt="Filled green color theme" width="100%"><p class="caption">
FIGURE 24.5: Filled green color theme
</p>
</div>
<p>Letâ€™s finish this section with the dark mode. We leverage the Framework7 app method
element since we could also toggle the dark mode under other circumstances. We add a
<code>toggleDarkTheme</code> function to the methods object then trigger it depending on the value
of the config. If the user donâ€™t provide any value, we set <code>config.dark</code> to <code>false</code>:</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb620-1"><a href="mobile-shinyMobile.html#cb620-1"></a><span class="va">config</span>.<span class="at">methods</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb620-2"><a href="mobile-shinyMobile.html#cb620-2"></a>  <span class="dt">toggleDarkTheme</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb620-3"><a href="mobile-shinyMobile.html#cb620-3"></a>    <span class="kw">var</span> self <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb620-4"><a href="mobile-shinyMobile.html#cb620-4"></a>    <span class="kw">var</span> $html <span class="op">=</span> <span class="va">self</span>.<span class="at">$</span>(<span class="st">'html'</span>)<span class="op">;</span></span>
<span id="cb620-5"><a href="mobile-shinyMobile.html#cb620-5"></a>    <span class="va">$html</span>.<span class="at">toggleClass</span>(<span class="st">'theme-dark'</span>)<span class="op">;</span></span>
<span id="cb620-6"><a href="mobile-shinyMobile.html#cb620-6"></a>  <span class="op">}</span></span>
<span id="cb620-7"><a href="mobile-shinyMobile.html#cb620-7"></a><span class="op">}</span></span>
<span id="cb620-8"><a href="mobile-shinyMobile.html#cb620-8"></a></span>
<span id="cb620-9"><a href="mobile-shinyMobile.html#cb620-9"></a><span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'dark'</span>)) <span class="va">config</span>.<span class="at">dark</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb620-10"><a href="mobile-shinyMobile.html#cb620-10"></a></span>
<span id="cb620-11"><a href="mobile-shinyMobile.html#cb620-11"></a><span class="cf">if</span> (<span class="va">config</span>.<span class="at">dark</span>) <span class="op">{</span></span>
<span id="cb620-12"><a href="mobile-shinyMobile.html#cb620-12"></a>  <span class="va">app</span>.<span class="va">methods</span>.<span class="at">toggleDarkTheme</span>()<span class="op">;</span></span>
<span id="cb620-13"><a href="mobile-shinyMobile.html#cb620-13"></a><span class="op">}</span></span></code></pre></div>
<p>At this point <code>init.js</code> should be:</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb621-1"><a href="mobile-shinyMobile.html#cb621-1"></a><span class="at">$</span>( document ).<span class="at">ready</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb621-2"><a href="mobile-shinyMobile.html#cb621-2"></a>  <span class="co">// collect all data elements stored in body</span></span>
<span id="cb621-3"><a href="mobile-shinyMobile.html#cb621-3"></a>  <span class="kw">var</span> config <span class="op">=</span> <span class="at">$</span>(document).<span class="at">find</span>(<span class="st">"script[data-for='app']"</span>)<span class="op">;</span></span>
<span id="cb621-4"><a href="mobile-shinyMobile.html#cb621-4"></a>  config <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="va">config</span>.<span class="at">html</span>())<span class="op">;</span></span>
<span id="cb621-5"><a href="mobile-shinyMobile.html#cb621-5"></a></span>
<span id="cb621-6"><a href="mobile-shinyMobile.html#cb621-6"></a>  <span class="co">// always erase existing root value just in case the user changes the root.</span></span>
<span id="cb621-7"><a href="mobile-shinyMobile.html#cb621-7"></a>  <span class="co">// This may be harmful</span></span>
<span id="cb621-8"><a href="mobile-shinyMobile.html#cb621-8"></a>  <span class="va">config</span>.<span class="at">root</span> <span class="op">=</span> <span class="st">"#app"</span><span class="op">;</span></span>
<span id="cb621-9"><a href="mobile-shinyMobile.html#cb621-9"></a>  </span>
<span id="cb621-10"><a href="mobile-shinyMobile.html#cb621-10"></a>  <span class="co">// store app methods</span></span>
<span id="cb621-11"><a href="mobile-shinyMobile.html#cb621-11"></a>  <span class="va">config</span>.<span class="at">methods</span> <span class="op">=</span>  <span class="op">{</span></span>
<span id="cb621-12"><a href="mobile-shinyMobile.html#cb621-12"></a>      <span class="dt">toggleDarkTheme</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb621-13"><a href="mobile-shinyMobile.html#cb621-13"></a>        <span class="kw">var</span> self <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb621-14"><a href="mobile-shinyMobile.html#cb621-14"></a>        <span class="kw">var</span> $html <span class="op">=</span> <span class="va">self</span>.<span class="at">$</span>(<span class="st">"html"</span>)<span class="op">;</span></span>
<span id="cb621-15"><a href="mobile-shinyMobile.html#cb621-15"></a>        <span class="va">$html</span>.<span class="at">toggleClass</span>(<span class="st">"theme-dark"</span>)<span class="op">;</span></span>
<span id="cb621-16"><a href="mobile-shinyMobile.html#cb621-16"></a>      <span class="op">}</span></span>
<span id="cb621-17"><a href="mobile-shinyMobile.html#cb621-17"></a>    <span class="op">};</span></span>
<span id="cb621-18"><a href="mobile-shinyMobile.html#cb621-18"></a></span>
<span id="cb621-19"><a href="mobile-shinyMobile.html#cb621-19"></a>  <span class="co">// create app instance</span></span>
<span id="cb621-20"><a href="mobile-shinyMobile.html#cb621-20"></a>  app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(config)<span class="op">;</span></span>
<span id="cb621-21"><a href="mobile-shinyMobile.html#cb621-21"></a></span>
<span id="cb621-22"><a href="mobile-shinyMobile.html#cb621-22"></a>  <span class="co">// init main view</span></span>
<span id="cb621-23"><a href="mobile-shinyMobile.html#cb621-23"></a>  <span class="kw">var</span> mainView <span class="op">=</span> <span class="va">app</span>.<span class="va">views</span>.<span class="at">create</span>(<span class="st">'.view-main'</span>)<span class="op">;</span></span>
<span id="cb621-24"><a href="mobile-shinyMobile.html#cb621-24"></a>  </span>
<span id="cb621-25"><a href="mobile-shinyMobile.html#cb621-25"></a>  <span class="co">// tapHold custom css</span></span>
<span id="cb621-26"><a href="mobile-shinyMobile.html#cb621-26"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">"touch"</span>)) <span class="op">{</span></span>
<span id="cb621-27"><a href="mobile-shinyMobile.html#cb621-27"></a>    <span class="cf">if</span> (<span class="va">config</span>.<span class="va">touch</span>.<span class="at">tapHold</span>) <span class="op">{</span></span>
<span id="cb621-28"><a href="mobile-shinyMobile.html#cb621-28"></a>      <span class="at">$</span>(<span class="st">"&lt;style&gt;"</span>)</span>
<span id="cb621-29"><a href="mobile-shinyMobile.html#cb621-29"></a>        .<span class="at">prop</span>(<span class="st">"type"</span><span class="op">,</span> <span class="st">"text/css"</span>)</span>
<span id="cb621-30"><a href="mobile-shinyMobile.html#cb621-30"></a>        .<span class="at">html</span>(</span>
<span id="cb621-31"><a href="mobile-shinyMobile.html#cb621-31"></a>          <span class="vs">`</span></span>
<span id="cb621-32"><a href="mobile-shinyMobile.html#cb621-32"></a><span class="vs">          -moz-user-select: none;</span></span>
<span id="cb621-33"><a href="mobile-shinyMobile.html#cb621-33"></a><span class="vs">          -webkit-user-select: none;</span></span>
<span id="cb621-34"><a href="mobile-shinyMobile.html#cb621-34"></a><span class="vs">          user-select: none;`</span></span>
<span id="cb621-35"><a href="mobile-shinyMobile.html#cb621-35"></a>        )</span>
<span id="cb621-36"><a href="mobile-shinyMobile.html#cb621-36"></a>        .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb621-37"><a href="mobile-shinyMobile.html#cb621-37"></a>    <span class="op">}</span></span>
<span id="cb621-38"><a href="mobile-shinyMobile.html#cb621-38"></a>  <span class="op">}</span></span>
<span id="cb621-39"><a href="mobile-shinyMobile.html#cb621-39"></a></span>
<span id="cb621-40"><a href="mobile-shinyMobile.html#cb621-40"></a>  <span class="kw">var</span> notification <span class="op">=</span> <span class="va">app</span>.<span class="va">notification</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb621-41"><a href="mobile-shinyMobile.html#cb621-41"></a>    <span class="dt">text</span><span class="op">:</span> <span class="st">'Hello, how are you?'</span><span class="op">,</span></span>
<span id="cb621-42"><a href="mobile-shinyMobile.html#cb621-42"></a>    <span class="dt">on</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb621-43"><a href="mobile-shinyMobile.html#cb621-43"></a>      <span class="dt">opened</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb621-44"><a href="mobile-shinyMobile.html#cb621-44"></a>        <span class="va">console</span>.<span class="at">log</span>(<span class="st">'Notification opened'</span>)<span class="op">;</span></span>
<span id="cb621-45"><a href="mobile-shinyMobile.html#cb621-45"></a>      <span class="op">}</span></span>
<span id="cb621-46"><a href="mobile-shinyMobile.html#cb621-46"></a>    <span class="op">}</span></span>
<span id="cb621-47"><a href="mobile-shinyMobile.html#cb621-47"></a>  <span class="op">}</span>).<span class="at">open</span>()<span class="op">;</span></span>
<span id="cb621-48"><a href="mobile-shinyMobile.html#cb621-48"></a></span>
<span id="cb621-49"><a href="mobile-shinyMobile.html#cb621-49"></a>  <span class="kw">var</span> otherMessage <span class="op">=</span> <span class="va">app</span>.<span class="va">notification</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb621-50"><a href="mobile-shinyMobile.html#cb621-50"></a>    <span class="dt">text</span><span class="op">:</span> <span class="st">'You look great!'</span></span>
<span id="cb621-51"><a href="mobile-shinyMobile.html#cb621-51"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb621-52"><a href="mobile-shinyMobile.html#cb621-52"></a></span>
<span id="cb621-53"><a href="mobile-shinyMobile.html#cb621-53"></a>  <span class="co">// equivalent to setTimeout ...</span></span>
<span id="cb621-54"><a href="mobile-shinyMobile.html#cb621-54"></a>  <span class="va">app</span>.<span class="va">utils</span>.<span class="at">nextTick</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb621-55"><a href="mobile-shinyMobile.html#cb621-55"></a>    <span class="va">otherMessage</span>.<span class="at">open</span>()<span class="op">;</span></span>
<span id="cb621-56"><a href="mobile-shinyMobile.html#cb621-56"></a>  <span class="op">},</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb621-57"><a href="mobile-shinyMobile.html#cb621-57"></a></span>
<span id="cb621-58"><a href="mobile-shinyMobile.html#cb621-58"></a>  <span class="co">// taphold test</span></span>
<span id="cb621-59"><a href="mobile-shinyMobile.html#cb621-59"></a>  <span class="at">$</span>(<span class="st">'#mybutton'</span>).<span class="at">on</span>(<span class="st">'taphold'</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb621-60"><a href="mobile-shinyMobile.html#cb621-60"></a>    <span class="va">app</span>.<span class="va">dialog</span>.<span class="at">alert</span>(<span class="st">'Tap hold fired!'</span>)<span class="op">;</span></span>
<span id="cb621-61"><a href="mobile-shinyMobile.html#cb621-61"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb621-62"><a href="mobile-shinyMobile.html#cb621-62"></a></span>
<span id="cb621-63"><a href="mobile-shinyMobile.html#cb621-63"></a>  <span class="co">// Set color theme</span></span>
<span id="cb621-64"><a href="mobile-shinyMobile.html#cb621-64"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'color'</span>)) <span class="op">{</span></span>
<span id="cb621-65"><a href="mobile-shinyMobile.html#cb621-65"></a>    <span class="kw">var</span> colorCSS <span class="op">=</span> <span class="va">app</span>.<span class="va">utils</span>.<span class="at">colorThemeCSSProperties</span>(<span class="va">config</span>.<span class="at">color</span>)<span class="op">;</span></span>
<span id="cb621-66"><a href="mobile-shinyMobile.html#cb621-66"></a>    <span class="at">$</span>(<span class="st">'&lt;style&gt;'</span>)</span>
<span id="cb621-67"><a href="mobile-shinyMobile.html#cb621-67"></a>      .<span class="at">prop</span>(<span class="st">'type'</span><span class="op">,</span> <span class="st">'text/css'</span>)</span>
<span id="cb621-68"><a href="mobile-shinyMobile.html#cb621-68"></a>      .<span class="at">html</span>(<span class="vs">`:root {</span></span>
<span id="cb621-69"><a href="mobile-shinyMobile.html#cb621-69"></a><span class="vs">        --f7-theme-color: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb621-70"><a href="mobile-shinyMobile.html#cb621-70"></a><span class="vs">        --f7-theme-color-rgb: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-rgb"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb621-71"><a href="mobile-shinyMobile.html#cb621-71"></a><span class="vs">        --f7-theme-color-shade: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-shade"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb621-72"><a href="mobile-shinyMobile.html#cb621-72"></a><span class="vs">        --f7-theme-color-tint: </span><span class="sc">${</span>colorCSS[<span class="st">"--f7-theme-color-tint"</span>]<span class="sc">}</span><span class="vs">;</span></span>
<span id="cb621-73"><a href="mobile-shinyMobile.html#cb621-73"></a><span class="vs">      }`</span>)</span>
<span id="cb621-74"><a href="mobile-shinyMobile.html#cb621-74"></a>      .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb621-75"><a href="mobile-shinyMobile.html#cb621-75"></a>  <span class="op">}</span></span>
<span id="cb621-76"><a href="mobile-shinyMobile.html#cb621-76"></a></span>
<span id="cb621-77"><a href="mobile-shinyMobile.html#cb621-77"></a>  <span class="co">// Filled theme</span></span>
<span id="cb621-78"><a href="mobile-shinyMobile.html#cb621-78"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'filled'</span>)) <span class="va">config</span>.<span class="at">filled</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb621-79"><a href="mobile-shinyMobile.html#cb621-79"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">filled</span>) <span class="op">{</span></span>
<span id="cb621-80"><a href="mobile-shinyMobile.html#cb621-80"></a>    <span class="kw">var</span> filledCSS <span class="op">=</span> <span class="vs">`</span></span>
<span id="cb621-81"><a href="mobile-shinyMobile.html#cb621-81"></a><span class="vs">      :root,</span></span>
<span id="cb621-82"><a href="mobile-shinyMobile.html#cb621-82"></a><span class="vs">      :root.theme-dark,</span></span>
<span id="cb621-83"><a href="mobile-shinyMobile.html#cb621-83"></a><span class="vs">      :root .theme-dark {</span></span>
<span id="cb621-84"><a href="mobile-shinyMobile.html#cb621-84"></a><span class="vs">        --f7-bars-bg-color: var(--f7-theme-color);</span></span>
<span id="cb621-85"><a href="mobile-shinyMobile.html#cb621-85"></a><span class="vs">        --f7-bars-bg-color-rgb: var(--f7-theme-color-rgb);</span></span>
<span id="cb621-86"><a href="mobile-shinyMobile.html#cb621-86"></a><span class="vs">        --f7-bars-translucent-opacity: 0.9;</span></span>
<span id="cb621-87"><a href="mobile-shinyMobile.html#cb621-87"></a><span class="vs">        --f7-bars-text-color: #fff;</span></span>
<span id="cb621-88"><a href="mobile-shinyMobile.html#cb621-88"></a><span class="vs">        --f7-bars-link-color: #fff;</span></span>
<span id="cb621-89"><a href="mobile-shinyMobile.html#cb621-89"></a><span class="vs">        --f7-navbar-subtitle-text-color: rgba(255,255,255,0.85);</span></span>
<span id="cb621-90"><a href="mobile-shinyMobile.html#cb621-90"></a><span class="vs">        --f7-bars-border-color: transparent;</span></span>
<span id="cb621-91"><a href="mobile-shinyMobile.html#cb621-91"></a><span class="vs">        --f7-tabbar-link-active-color: #fff;</span></span>
<span id="cb621-92"><a href="mobile-shinyMobile.html#cb621-92"></a><span class="vs">        --f7-tabbar-link-inactive-color: rgba(255,255,255,0.54);</span></span>
<span id="cb621-93"><a href="mobile-shinyMobile.html#cb621-93"></a><span class="vs">        --f7-sheet-border-color: transparent;</span></span>
<span id="cb621-94"><a href="mobile-shinyMobile.html#cb621-94"></a><span class="vs">        --f7-tabbar-link-active-border-color: #fff;</span></span>
<span id="cb621-95"><a href="mobile-shinyMobile.html#cb621-95"></a><span class="vs">      }</span></span>
<span id="cb621-96"><a href="mobile-shinyMobile.html#cb621-96"></a><span class="vs">      .appbar,</span></span>
<span id="cb621-97"><a href="mobile-shinyMobile.html#cb621-97"></a><span class="vs">      .navbar,</span></span>
<span id="cb621-98"><a href="mobile-shinyMobile.html#cb621-98"></a><span class="vs">      .toolbar,</span></span>
<span id="cb621-99"><a href="mobile-shinyMobile.html#cb621-99"></a><span class="vs">      .subnavbar,</span></span>
<span id="cb621-100"><a href="mobile-shinyMobile.html#cb621-100"></a><span class="vs">      .calendar-header,</span></span>
<span id="cb621-101"><a href="mobile-shinyMobile.html#cb621-101"></a><span class="vs">      .calendar-footer {</span></span>
<span id="cb621-102"><a href="mobile-shinyMobile.html#cb621-102"></a><span class="vs">        --f7-touch-ripple-color: var(--f7-touch-ripple-white);</span></span>
<span id="cb621-103"><a href="mobile-shinyMobile.html#cb621-103"></a><span class="vs">        --f7-link-highlight-color: var(--f7-link-highlight-white);</span></span>
<span id="cb621-104"><a href="mobile-shinyMobile.html#cb621-104"></a><span class="vs">        --f7-button-text-color: #fff;</span></span>
<span id="cb621-105"><a href="mobile-shinyMobile.html#cb621-105"></a><span class="vs">        --f7-button-pressed-bg-color: rgba(255,255,255,0.1);</span></span>
<span id="cb621-106"><a href="mobile-shinyMobile.html#cb621-106"></a><span class="vs">      }</span></span>
<span id="cb621-107"><a href="mobile-shinyMobile.html#cb621-107"></a><span class="vs">      .navbar-large-transparent,</span></span>
<span id="cb621-108"><a href="mobile-shinyMobile.html#cb621-108"></a><span class="vs">      .navbar-large.navbar-transparent {</span></span>
<span id="cb621-109"><a href="mobile-shinyMobile.html#cb621-109"></a><span class="vs">        --f7-navbar-large-title-text-color: #000;</span></span>
<span id="cb621-110"><a href="mobile-shinyMobile.html#cb621-110"></a><span class="vs">      </span></span>
<span id="cb621-111"><a href="mobile-shinyMobile.html#cb621-111"></a><span class="vs">        --r: 0;</span></span>
<span id="cb621-112"><a href="mobile-shinyMobile.html#cb621-112"></a><span class="vs">        --g: 122;</span></span>
<span id="cb621-113"><a href="mobile-shinyMobile.html#cb621-113"></a><span class="vs">        --b: 255;</span></span>
<span id="cb621-114"><a href="mobile-shinyMobile.html#cb621-114"></a><span class="vs">        --progress: var(--f7-navbar-large-collapse-progress);</span></span>
<span id="cb621-115"><a href="mobile-shinyMobile.html#cb621-115"></a><span class="vs">        --f7-bars-link-color: rgb(</span></span>
<span id="cb621-116"><a href="mobile-shinyMobile.html#cb621-116"></a><span class="vs">          calc(var(--r) + (255 - var(--r)) * var(--progress)),</span></span>
<span id="cb621-117"><a href="mobile-shinyMobile.html#cb621-117"></a><span class="vs">          calc(var(--g) + (255 - var(--g)) * var(--progress)),</span></span>
<span id="cb621-118"><a href="mobile-shinyMobile.html#cb621-118"></a><span class="vs">          calc(var(--b) + (255 - var(--b)) * var(--progress))</span></span>
<span id="cb621-119"><a href="mobile-shinyMobile.html#cb621-119"></a><span class="vs">        );</span></span>
<span id="cb621-120"><a href="mobile-shinyMobile.html#cb621-120"></a><span class="vs">      }</span></span>
<span id="cb621-121"><a href="mobile-shinyMobile.html#cb621-121"></a><span class="vs">      .theme-dark .navbar-large-transparent,</span></span>
<span id="cb621-122"><a href="mobile-shinyMobile.html#cb621-122"></a><span class="vs">      .theme-dark .navbar-large.navbar-transparent {</span></span>
<span id="cb621-123"><a href="mobile-shinyMobile.html#cb621-123"></a><span class="vs">        --f7-navbar-large-title-text-color: #fff;</span></span>
<span id="cb621-124"><a href="mobile-shinyMobile.html#cb621-124"></a><span class="vs">    }`</span><span class="op">;</span></span>
<span id="cb621-125"><a href="mobile-shinyMobile.html#cb621-125"></a>    </span>
<span id="cb621-126"><a href="mobile-shinyMobile.html#cb621-126"></a>    <span class="at">$</span>(<span class="st">'&lt;style&gt;'</span>)</span>
<span id="cb621-127"><a href="mobile-shinyMobile.html#cb621-127"></a>      .<span class="at">prop</span>(<span class="st">'type'</span><span class="op">,</span> <span class="st">'text/css'</span>)</span>
<span id="cb621-128"><a href="mobile-shinyMobile.html#cb621-128"></a>      .<span class="at">html</span>(<span class="vs">`</span><span class="sc">${</span>filledCSS<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb621-129"><a href="mobile-shinyMobile.html#cb621-129"></a>      .<span class="at">appendTo</span>(<span class="st">"head"</span>)<span class="op">;</span></span>
<span id="cb621-130"><a href="mobile-shinyMobile.html#cb621-130"></a>  <span class="op">}</span></span>
<span id="cb621-131"><a href="mobile-shinyMobile.html#cb621-131"></a></span>
<span id="cb621-132"><a href="mobile-shinyMobile.html#cb621-132"></a>  <span class="co">// dark mode</span></span>
<span id="cb621-133"><a href="mobile-shinyMobile.html#cb621-133"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="va">config</span>.<span class="at">hasOwnProperty</span>(<span class="st">'dark'</span>)) <span class="va">config</span>.<span class="at">dark</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb621-134"><a href="mobile-shinyMobile.html#cb621-134"></a>  <span class="cf">if</span> (<span class="va">config</span>.<span class="at">dark</span>) <span class="op">{</span></span>
<span id="cb621-135"><a href="mobile-shinyMobile.html#cb621-135"></a>    <span class="va">app</span>.<span class="va">methods</span>.<span class="at">toggleDarkTheme</span>()<span class="op">;</span></span>
<span id="cb621-136"><a href="mobile-shinyMobile.html#cb621-136"></a>  <span class="op">}</span></span>
<span id="cb621-137"><a href="mobile-shinyMobile.html#cb621-137"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>and the dark mode app example:</p>
<div class="sourceCode" id="cb622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_page.html">f7_page</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
        class <span class="op">=</span> <span class="st">"list inset"</span>,
        <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span>
            <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span>
                <span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>
                    href <span class="op">=</span> <span class="st">"#"</span>,
                    id <span class="op">=</span> <span class="st">"mybutton"</span>,
                    class <span class="op">=</span> <span class="st">"list-button"</span>,
                    <span class="st">"Large Green Button"</span>
                <span class="op">)</span>
            <span class="op">)</span>
        <span class="op">)</span>
    <span class="op">)</span>,
    navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_navbar.html">f7_navbar</a></span><span class="op">(</span><span class="st">"Title"</span><span class="op">)</span>,
    toolbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/OSUICode/man/f7_toolbar.html">f7_toolbar</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"shinyMobile"</span>,
    options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      theme <span class="op">=</span> <span class="st">"ios"</span>, 
      version <span class="op">=</span> <span class="st">"1.0.0"</span>, 
      taphold <span class="op">=</span> <span class="cn">TRUE</span>, 
      color <span class="op">=</span> <span class="st">"#42f5a1"</span>, 
      filled <span class="op">=</span> <span class="cn">TRUE</span>, 
      dark <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>The overall expected result is shown Figure <a href="mobile-shinyMobile.html#fig:mobile-shinyMobile-dark">24.6</a>.</p>
<div class="figure">
<span id="fig:mobile-shinyMobile-dark"></span>
<img src="images/mobile/mobile-shinymobile-dark.png" alt="Dark mode in {shinyMobile}" width="100%"><p class="caption">
FIGURE 24.6: Dark mode in {shinyMobile}
</p>
</div>
<p>You may run in the R console:</p>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyAppDir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shinyMobile/simple"</span>, package <span class="op">=</span> <span class="st">"OSUICode"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="modularize-js-code" class="section level2">
<h2>
<span class="header-section-number">24.7</span> Modularize JS code<a class="anchor" aria-label="anchor" href="#modularize-js-code"><i class="fas fa-link"></i></a>
</h2>
<p>As shown above, the <code>init.js</code> code starts to grow and this is not a good sign.
In this section, we show how to utilize the <code>import</code> and <code>export</code> statements, possible
owing to the <code>esbuild</code> JS bundler. Note that this is a more modern version of writing equivalent to the <code>module.exports</code> and <code>require</code> shown in <a href="survival-kit-javascript.html#about-js-modules">9.4.6.1</a>.</p>
<p>In the R console, we run <code><a href="https://rdrr.io/pkg/charpente/man/create_file.html">create_js("helpers_config", reference = FALSE)</a></code>, which creates a new JS script but does not import it in the <code>main.js</code> <code>esbuild</code> entry point. Inside we extract a function containing all steps to set up the app configuration object:</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb624-1"><a href="mobile-shinyMobile.html#cb624-1"></a><span class="im">export</span> <span class="kw">const</span> setConfig <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb624-2"><a href="mobile-shinyMobile.html#cb624-2"></a>  <span class="co">// collect all data elements stored in body</span></span>
<span id="cb624-3"><a href="mobile-shinyMobile.html#cb624-3"></a> <span class="kw">let</span> config <span class="op">=</span> <span class="at">$</span>(document).<span class="at">find</span>(<span class="st">"script[data-for='app']"</span>)<span class="op">;</span></span>
<span id="cb624-4"><a href="mobile-shinyMobile.html#cb624-4"></a> config <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="va">config</span>.<span class="at">html</span>())<span class="op">;</span></span>
<span id="cb624-5"><a href="mobile-shinyMobile.html#cb624-5"></a></span>
<span id="cb624-6"><a href="mobile-shinyMobile.html#cb624-6"></a> <span class="co">// always erase existing root value just in case the user changes the root.</span></span>
<span id="cb624-7"><a href="mobile-shinyMobile.html#cb624-7"></a> <span class="co">// This may be harmful</span></span>
<span id="cb624-8"><a href="mobile-shinyMobile.html#cb624-8"></a> <span class="va">config</span>.<span class="at">root</span> <span class="op">=</span> <span class="st">"#app"</span><span class="op">;</span></span>
<span id="cb624-9"><a href="mobile-shinyMobile.html#cb624-9"></a></span>
<span id="cb624-10"><a href="mobile-shinyMobile.html#cb624-10"></a>  <span class="co">// store app methods</span></span>
<span id="cb624-11"><a href="mobile-shinyMobile.html#cb624-11"></a>  <span class="va">config</span>.<span class="at">methods</span> <span class="op">=</span>  <span class="op">{</span></span>
<span id="cb624-12"><a href="mobile-shinyMobile.html#cb624-12"></a>    <span class="dt">toggleDarkTheme</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb624-13"><a href="mobile-shinyMobile.html#cb624-13"></a>      <span class="kw">let</span> self <span class="op">=</span> <span class="kw">this</span><span class="op">;</span></span>
<span id="cb624-14"><a href="mobile-shinyMobile.html#cb624-14"></a>      <span class="kw">let</span> $html <span class="op">=</span> <span class="va">self</span>.<span class="at">$</span>(<span class="st">"html"</span>)<span class="op">;</span></span>
<span id="cb624-15"><a href="mobile-shinyMobile.html#cb624-15"></a>      <span class="va">$html</span>.<span class="at">toggleClass</span>(<span class="st">"theme-dark"</span>)<span class="op">;</span></span>
<span id="cb624-16"><a href="mobile-shinyMobile.html#cb624-16"></a>    <span class="op">}</span></span>
<span id="cb624-17"><a href="mobile-shinyMobile.html#cb624-17"></a>  <span class="op">};</span></span>
<span id="cb624-18"><a href="mobile-shinyMobile.html#cb624-18"></a></span>
<span id="cb624-19"><a href="mobile-shinyMobile.html#cb624-19"></a>  <span class="co">// check if the app is intended to be a PWA</span></span>
<span id="cb624-20"><a href="mobile-shinyMobile.html#cb624-20"></a>  <span class="kw">let</span> isPWA <span class="op">=</span> <span class="at">$</span>(<span class="st">'body'</span>).<span class="at">attr</span>(<span class="st">'data-pwa'</span>) <span class="op">===</span> <span class="st">"true"</span><span class="op">;</span></span>
<span id="cb624-21"><a href="mobile-shinyMobile.html#cb624-21"></a></span>
<span id="cb624-22"><a href="mobile-shinyMobile.html#cb624-22"></a>  <span class="cf">if</span> (isPWA) <span class="op">{</span></span>
<span id="cb624-23"><a href="mobile-shinyMobile.html#cb624-23"></a>    <span class="va">config</span>.<span class="at">serviceWorker</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb624-24"><a href="mobile-shinyMobile.html#cb624-24"></a>      <span class="dt">path</span><span class="op">:</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span> <span class="op">+</span> <span class="st">"service-worker.js"</span><span class="op">,</span></span>
<span id="cb624-25"><a href="mobile-shinyMobile.html#cb624-25"></a>      <span class="dt">scope</span><span class="op">:</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span></span>
<span id="cb624-26"><a href="mobile-shinyMobile.html#cb624-26"></a>    <span class="op">};</span></span>
<span id="cb624-27"><a href="mobile-shinyMobile.html#cb624-27"></a>  <span class="op">}</span></span>
<span id="cb624-28"><a href="mobile-shinyMobile.html#cb624-28"></a></span>
<span id="cb624-29"><a href="mobile-shinyMobile.html#cb624-29"></a>  <span class="co">// Widgets cache</span></span>
<span id="cb624-30"><a href="mobile-shinyMobile.html#cb624-30"></a>  <span class="va">config</span>.<span class="at">data</span> <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb624-31"><a href="mobile-shinyMobile.html#cb624-31"></a>    <span class="cf">return</span> <span class="op">{</span></span>
<span id="cb624-32"><a href="mobile-shinyMobile.html#cb624-32"></a>      <span class="co">// any other widget type to cache ...</span></span>
<span id="cb624-33"><a href="mobile-shinyMobile.html#cb624-33"></a>      <span class="dt">gauge</span><span class="op">:</span> []</span>
<span id="cb624-34"><a href="mobile-shinyMobile.html#cb624-34"></a>    <span class="op">};</span></span>
<span id="cb624-35"><a href="mobile-shinyMobile.html#cb624-35"></a>  <span class="op">};</span></span>
<span id="cb624-36"><a href="mobile-shinyMobile.html#cb624-36"></a></span>
<span id="cb624-37"><a href="mobile-shinyMobile.html#cb624-37"></a>  <span class="cf">return</span> config<span class="op">;</span></span>
<span id="cb624-38"><a href="mobile-shinyMobile.html#cb624-38"></a><span class="op">}</span></span></code></pre></div>
<p>This function does not have any argument and must return the <code>config</code> variable that will be subsequently injected in <code>new Framework7(config)</code> to initialize the app. In the <code>init.js</code> script, we import the <code>setConfig()</code> function and call it within <code>$( document ).ready</code>:</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb625-1"><a href="mobile-shinyMobile.html#cb625-1"></a><span class="im">import</span> <span class="op">{</span> setConfig <span class="op">}</span> <span class="im">from</span> <span class="st">'./helpers_config.js'</span></span>
<span id="cb625-2"><a href="mobile-shinyMobile.html#cb625-2"></a></span>
<span id="cb625-3"><a href="mobile-shinyMobile.html#cb625-3"></a><span class="at">$</span>( document ).<span class="at">ready</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb625-4"><a href="mobile-shinyMobile.html#cb625-4"></a>  <span class="kw">let</span> config <span class="op">=</span> <span class="at">setConfig</span>()<span class="op">;</span></span>
<span id="cb625-5"><a href="mobile-shinyMobile.html#cb625-5"></a>  <span class="co">// create app instance</span></span>
<span id="cb625-6"><a href="mobile-shinyMobile.html#cb625-6"></a>  app <span class="op">=</span> <span class="kw">new</span> <span class="at">Framework7</span>(config)<span class="op">;</span></span>
<span id="cb625-7"><a href="mobile-shinyMobile.html#cb625-7"></a>  <span class="co">// ...</span></span>
<span id="cb625-8"><a href="mobile-shinyMobile.html#cb625-8"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>We can bundle our code with <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code>. We invite the reader to modularize the other features mentioned above, the final product being available <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/tree/master/srcjs">here</a>. Alternatively, you may run in the R console and open the HTML inspector to check the JS code:</p>
<div class="sourceCode" id="cb626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyAppDir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"shinyMobile/pwa"</span>, package <span class="op">=</span> <span class="st">"OSUICode"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="warningbox">
<p>If the function has a side effect, for instance modify a variable located in another scope, it must return the transformed variable output, so that it can be tracked at the upper level.</p>
</div>
<p>We have now set all foundations. In the next chapter, we see how to convert a <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> app (and any vanilla shiny app) into a progressive web app.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="mobile-shiny-intro.html"><span class="header-section-number">23</span> Introduction</a></div>
<div class="next"><a href="mobile-pwa.html"><span class="header-section-number">25</span> {shinyMobile} and PWA</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mobile-shinyMobile"><span class="header-section-number">24</span> Reconstruct {shinyMobile}</a></li>
<li><a class="nav-link" href="#introduction-to-framework7"><span class="header-section-number">24.1</span> Introduction to Framework7</a></li>
<li><a class="nav-link" href="#initiate-the-package"><span class="header-section-number">24.2</span> Initiate the package</a></li>
<li><a class="nav-link" href="#framework7-layouts"><span class="header-section-number">24.3</span> Framework7 Layouts</a></li>
<li><a class="nav-link" href="#app-initialization-1"><span class="header-section-number">24.4</span> App initialization</a></li>
<li>
<a class="nav-link" href="#app-configuration"><span class="header-section-number">24.5</span> App configuration</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#global-theme"><span class="header-section-number">24.5.1</span> Global theme</a></li>
<li><a class="nav-link" href="#events-1"><span class="header-section-number">24.5.2</span> Events</a></li>
<li><a class="nav-link" href="#components-configuration"><span class="header-section-number">24.5.3</span> Components configuration</a></li>
<li><a class="nav-link" href="#other-elements"><span class="header-section-number">24.5.4</span> Other elements</a></li>
<li><a class="nav-link" href="#allow-end-user-configuration"><span class="header-section-number">24.5.5</span> Allow end-user configuration</a></li>
<li><a class="nav-link" href="#modify-configuration"><span class="header-section-number">24.5.6</span> Modify configuration</a></li>
<li><a class="nav-link" href="#mobile-global-data"><span class="header-section-number">24.5.7</span> Global data and methods</a></li>
</ul>
</li>
<li><a class="nav-link" href="#theming-and-colors"><span class="header-section-number">24.6</span> Theming and colors</a></li>
<li><a class="nav-link" href="#modularize-js-code"><span class="header-section-number">24.7</span> Modularize JS code</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/mobile-shinyMobile.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/mobile-shinyMobile.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It was last built on 2021-02-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
