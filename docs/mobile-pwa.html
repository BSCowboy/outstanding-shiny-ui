<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 25 {shinyMobile} and PWA | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- CSS --><link rel="stylesheet" href="css/style.css">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.2/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.2/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.1.9000/tabs.js"></script><script src="libs/bs3compat-0.2.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="foreword.html">Foreword</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">2</span> Discover Shiny dependencies</a></li>
<li class="book-part">From R to HTML: discover and master {htmltools}:</li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">3</span> htmltools overview</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li class="book-part">Beautify with CSS and SASS</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">5</span> CSS for Shiny</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">6</span> Introduction to SASS</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">7</span> Beautify with fresh</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">8</span> Beautify with bslib</a></li>
<li><a class="" href="beautify-other-tools.html"><span class="header-section-number">9</span> Other tools</a></li>
<li class="book-part">Unleash interactivity with JavaScript</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Shiny’s internal: session and websockets</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Hidden gems about inputs</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Dynamically manage content with handlers</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Template skeleton</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">19</span> Testing and validating templates elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">20</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">21</span> Adding more interactivity</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li class="book-part">Case study 2: Mobile development with Shiny</li>
<li><a class="" href="mobile-shiny-intro.html"><span class="header-section-number">23</span> Introduction</a></li>
<li><a class="" href="mobile-shinyMobile.html"><span class="header-section-number">24</span> Reconstruct {shinyMobile}</a></li>
<li><a class="active" href="mobile-pwa.html"><span class="header-section-number">25</span> {shinyMobile} and PWA</a></li>
<li><a class="" href="mobile-widgets.html"><span class="header-section-number">26</span> Design widgets</a></li>
<li class="book-part">Going further</li>
<li><a class="" href="going-further-reactR.html"><span class="header-section-number">27</span> R + Shiny + React: welcome {reactR}</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source</a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="mobile-pwa" class="section level1">
<h1>
<span class="header-section-number">25</span> <code>{shinyMobile}</code> and PWA<a class="anchor" aria-label="anchor" href="#mobile-pwa"><i class="fas fa-link"></i></a>
</h1>
<p>Transforming a classic Shiny app into a PWA is a game changer for end users.
The first step is to setup a valid web manifest with icons and favicon.</p>
<div id="disclaimers" class="section level2">
<h2>
<span class="header-section-number">25.1</span> Disclaimers<a class="anchor" aria-label="anchor" href="#disclaimers"><i class="fas fa-link"></i></a>
</h2>
<p>Some of the PWA features won’t work with <a href="https://medium.com/@firt/progressive-web-apps-on-ios-are-here-d00430dee3a7">iOS</a>, like the
install prompt.</p>
</div>
<div id="introduction-5" class="section level2">
<h2>
<span class="header-section-number">25.2</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-5"><i class="fas fa-link"></i></a>
</h2>
<p>Below, we review one by one the steps necessary to convert a shiny app to a PWA.
To get a goo idea of what we exactly miss, we leverage the <code>Application</code> tab of the
developer tools.</p>
<p>The overall expected result is shown Figure <a href="mobile-pwa.html#fig:mobile-pwa">25.1</a>. Alternatively, one
may use the Google Lighthouse utility to provide a general diagnosis to the app.
There are many categories like performance, accessibility. In our case, let’s just select
the PWA category, select the mobile device radio and click on generate a report.</p>
<div class="figure">
<span id="fig:mobile-pwa"></span>
<img src="images/mobile/mobile-pwa-application.png" alt="Application tab of the developers tools" width="50%"><img src="images/mobile/mobile-pwa-lighthouse.png" alt="Application tab of the developers tools" width="50%"><p class="caption">
FIGURE 25.1: Application tab of the developers tools
</p>
</div>
<p>According to the diagnostic result displayed on Figure <a href="mobile-pwa.html#fig:mobile-pwa-lighthouse-result">25.2</a>, we miss many elements:</p>
<ul>
<li>No manifest.</li>
<li>No service worker.</li>
<li>No icons.</li>
</ul>
<div class="figure">
<span id="fig:mobile-pwa-lighthouse-result"></span>
<img src="images/mobile/mobile-pwa-lighthouse-result.png" alt="Lighthouse audit result" width="100%"><p class="caption">
FIGURE 25.2: Lighthouse audit result
</p>
</div>
</div>
<div id="charpente-and-pwa-tools" class="section level2">
<h2>
<span class="header-section-number">25.3</span> <code>{charpente}</code> and PWA tools<a class="anchor" aria-label="anchor" href="#charpente-and-pwa-tools"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/RinteRface/charpente">charpente</a> has tools to help designing a PWA. The <code>set_pwa</code> function is a wrapper
that does all the previously mentioned step in only one line of code. There are however few
prerequisites:</p>
<ul>
<li>The app must belong to a package.</li>
<li>The function must target the app directory.</li>
</ul>
<p>As a reminder, the demonstration apps are located within the <code>inst/examples</code> folder.
We create the <code>pwa-app</code> sub-folder and the <code>app.R</code> file:</p>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://shiny.rstudio.com">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">f7_page</span><span class="op">(</span>
  <span class="st">"Test"</span>,
  navbar <span class="op">=</span> <span class="fu">f7_navbar</span><span class="op">(</span><span class="st">"Title"</span><span class="op">)</span>,
  toolbar <span class="op">=</span> <span class="fu">f7_toolbar</span><span class="op">(</span><span class="op">)</span>,
  title <span class="op">=</span> <span class="st">"shinyMobile"</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>Then we set the PWA configuration:</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/set_pwa.html">set_pwa</a></span><span class="op">(</span><span class="st">"inst/examples/pwa-app"</span><span class="op">)</span></code></pre></div>
<p>This function generates a <code>manifest.webmanifest</code> file, downloads the Google PWA compatibility
script, adds a custom dependency pointing to the <code>manifest.webmanifest</code> file and a <code>144x144</code> icon file,
copies a boilerplate <code>service-worker.js</code> with its <code>offline.html</code> page and optionally registers the
service worker (code borrowed from <a href="https://web.dev/offline-fallback-page/#registering-the-service-worker">web.dev</a>:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb578-1"><a href="mobile-pwa.html#cb578-1"></a><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">'load'</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb578-2"><a href="mobile-pwa.html#cb578-2"></a>  <span class="cf">if</span> (<span class="st">'serviceWorker'</span> <span class="kw">in</span> navigator) <span class="op">{</span></span>
<span id="cb578-3"><a href="mobile-pwa.html#cb578-3"></a>    <span class="kw">var</span> pathname <span class="op">=</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span><span class="op">;</span></span>
<span id="cb578-4"><a href="mobile-pwa.html#cb578-4"></a>    <span class="va">navigator</span>.<span class="at">serviceWorker</span></span>
<span id="cb578-5"><a href="mobile-pwa.html#cb578-5"></a>      .<span class="at">register</span>(pathname <span class="op">+</span> <span class="st">'service-worker.js'</span><span class="op">,</span> <span class="op">{</span> <span class="dt">scope</span><span class="op">:</span> pathname<span class="op">}</span>)</span>
<span id="cb578-6"><a href="mobile-pwa.html#cb578-6"></a>      .<span class="at">then</span>(<span class="kw">function</span>() <span class="op">{</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">'Service Worker Registered'</span>)<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb578-7"><a href="mobile-pwa.html#cb578-7"></a>  <span class="op">};</span></span>
<span id="cb578-8"><a href="mobile-pwa.html#cb578-8"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>In the <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> case, as Framework7 already registers any linked service
worker, we don’t need that initialization script. Therefore, we actually call:</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/charpente/man/set_pwa.html">set_pwa</a></span><span class="op">(</span><span class="st">"inst/examples/pwa-app"</span>, register_service_worker <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Importantly, this functions does not handle icon creation. There are tools such as
<a href="https://appsco.pe/developer/splash-screens">appsco</a> and
<a href="https://app-manifest.firebaseapp.com">app-manifest</a>, to create
those custom icons and splash screens, if you need to.</p>
<p>Below we give more detail</p>
<div id="create-the-manifest" class="section level3">
<h3>
<span class="header-section-number">25.3.1</span> Create the manifest<a class="anchor" aria-label="anchor" href="#create-the-manifest"><i class="fas fa-link"></i></a>
</h3>
<p>We want to create a JSON configuration file like this:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb580-1"><a href="mobile-pwa.html#cb580-1"></a><span class="op">{</span></span>
<span id="cb580-2"><a href="mobile-pwa.html#cb580-2"></a>  <span class="st">"short_name"</span><span class="op">:</span> <span class="st">"My App"</span><span class="op">,</span></span>
<span id="cb580-3"><a href="mobile-pwa.html#cb580-3"></a>  <span class="st">"name"</span><span class="op">:</span> <span class="st">"Super amazing app"</span><span class="op">,</span></span>
<span id="cb580-4"><a href="mobile-pwa.html#cb580-4"></a>  <span class="st">"description"</span><span class="op">:</span> <span class="st">"This app is just mind blowing"</span><span class="op">,</span></span>
<span id="cb580-5"><a href="mobile-pwa.html#cb580-5"></a>  <span class="st">"icons"</span><span class="op">:</span> [</span>
<span id="cb580-6"><a href="mobile-pwa.html#cb580-6"></a>    <span class="op">{</span></span>
<span id="cb580-7"><a href="mobile-pwa.html#cb580-7"></a>      <span class="st">"src"</span><span class="op">:</span> <span class="st">"icons/icon.png"</span><span class="op">,</span></span>
<span id="cb580-8"><a href="mobile-pwa.html#cb580-8"></a>      <span class="st">"type"</span><span class="op">:</span> <span class="st">"image/png"</span><span class="op">,</span></span>
<span id="cb580-9"><a href="mobile-pwa.html#cb580-9"></a>      <span class="st">"sizes"</span><span class="op">:</span> <span class="st">"192x192"</span></span>
<span id="cb580-10"><a href="mobile-pwa.html#cb580-10"></a>    <span class="op">}</span></span>
<span id="cb580-11"><a href="mobile-pwa.html#cb580-11"></a>    <span class="co">// ...</span></span>
<span id="cb580-12"><a href="mobile-pwa.html#cb580-12"></a>  ]<span class="op">,</span></span>
<span id="cb580-13"><a href="mobile-pwa.html#cb580-13"></a>  <span class="st">"start_url"</span><span class="op">:</span> <span class="st">"https://whatever-url.com/"</span><span class="op">,</span></span>
<span id="cb580-14"><a href="mobile-pwa.html#cb580-14"></a>  <span class="st">"background_color"</span><span class="op">:</span> <span class="st">"#3367D6"</span><span class="op">,</span></span>
<span id="cb580-15"><a href="mobile-pwa.html#cb580-15"></a>  <span class="st">"display"</span><span class="op">:</span> <span class="st">"standalone"</span><span class="op">,</span></span>
<span id="cb580-16"><a href="mobile-pwa.html#cb580-16"></a>  <span class="st">"scope"</span><span class="op">:</span> <span class="st">"/"</span><span class="op">,</span></span>
<span id="cb580-17"><a href="mobile-pwa.html#cb580-17"></a>  <span class="st">"theme_color"</span><span class="op">:</span> <span class="st">"#3367D6"</span></span>
<span id="cb580-18"><a href="mobile-pwa.html#cb580-18"></a><span class="op">}</span></span></code></pre></div>
<p>This file has to be accessible by the app so best practice is to put it in the <code>/www</code> folder.
and images are hosted in a sub-directory <code>/www/icons</code>.</p>
<p>The <code>create_manifest</code> function is basically writing a JSON file at the provided location:</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">create_manifest</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span>, <span class="va">name</span> <span class="op">=</span> <span class="st">"My Progressive Web App"</span>, <span class="va">shortName</span> <span class="op">=</span> <span class="st">"My App"</span>,
                            <span class="va">description</span> <span class="op">=</span> <span class="st">"What it does!"</span>, <span class="va">lang</span> <span class="op">=</span> <span class="st">"en-US"</span>,
                            <span class="va">startUrl</span> <span class="op">=</span> <span class="st">"/"</span>, <span class="va">display</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"minimal-ui"</span>, <span class="st">"standalone"</span>, <span class="st">"fullscreen"</span>, <span class="st">"browser"</span><span class="op">)</span>,
                            <span class="va">background_color</span> <span class="op">=</span> <span class="st">"#ffffff"</span>, <span class="va">theme_color</span> <span class="op">=</span> <span class="st">"#ffffff"</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">display</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">display</span><span class="op">)</span>

  <span class="va">manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    name <span class="op">=</span> <span class="va">name</span>,
    short_name <span class="op">=</span> <span class="va">shortName</span>,
    description <span class="op">=</span> <span class="va">description</span>,
    lang <span class="op">=</span> <span class="va">lang</span>,
    start_url <span class="op">=</span> <span class="va">startUrl</span>,
    display <span class="op">=</span> <span class="va">display</span>,
    background_color <span class="op">=</span> <span class="va">background_color</span>,
    theme_color <span class="op">=</span> <span class="va">theme_color</span>,
    icons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      src <span class="op">=</span> <span class="st">"icons/icon-144.png"</span>,
      sizes <span class="op">=</span> <span class="st">"144x144"</span>
    <span class="op">)</span>
  <span class="op">)</span>

  <span class="co"># create /www folder if does not exist yet</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"/www"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"/www/icons"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/read_json.html">write_json</a></span><span class="op">(</span>
    <span class="va">manifest</span>, 
    path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="st">"/www/manifest.webmanifest"</span><span class="op">)</span>,
    pretty <span class="op">=</span> <span class="cn">TRUE</span>,
    auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
  
  <span class="fu">ui_done</span><span class="op">(</span><span class="st">"Web manifest successfully created!"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The web manifest and icons have to be included in the <code>head</code> before the Google PWA compatibility
script:</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb582-1"><a href="mobile-pwa.html#cb582-1"></a><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">"manifest"</span><span class="ot"> href=</span><span class="st">"manifest.webmanifest"</span> <span class="kw">/&gt;</span></span>
<span id="cb582-2"><a href="mobile-pwa.html#cb582-2"></a><span class="co">&lt;!-- include icon also from manifest --&gt;</span></span>
<span id="cb582-3"><a href="mobile-pwa.html#cb582-3"></a><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">"icon"</span><span class="ot"> type=</span><span class="st">"image/png"</span><span class="ot"> href=</span><span class="st">"icons/logo-144.png"</span><span class="ot"> sizes=</span><span class="st">"144x144"</span> <span class="kw">/&gt;</span></span></code></pre></div>
<p><code>set_pwa</code> includes a <code>create_pwa_dependency</code> function that creates an HTML dependency
containing all necessary resources:</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#' PWA dependencies utils</span>
<span class="co">#'</span>
<span class="co">#' @description This function attaches PWA manifest and icons to the given tag</span>
<span class="co">#'</span>
<span class="co">#' @param tag Element to attach the dependencies.</span>
<span class="co">#'</span>
<span class="co">#' @importFrom utils packageVersion</span>
<span class="co">#' @importFrom htmltools tagList htmlDependency</span>
<span class="co">#' @export</span>
<span class="va">add_pwa_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
 <span class="va">pwa_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"pwa-utils"</span>,
  version <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"shinyMobile"</span><span class="op">)</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"shinyMobile-0.0.0.9000"</span><span class="op">)</span>,
  head <span class="op">=</span> <span class="st">"&lt;link rel=\"manifest\" href=\"manifest.webmanifest\"  /&gt;
&lt;link rel=\"icon\" type=\"image/png\" href=\"icons/icon-144.png\" sizes=\"144x144\" /&gt;"</span>,
  package <span class="op">=</span> <span class="st">"mypkg2"</span>,
 <span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">pwa_deps</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Importantly, all provided icons must follow the convention <code>icon-&lt;size_in_px&gt;.png</code> like
<code>icon-144.png</code>, which is the default.</p>
</div>
<div id="google-pwa-compatibility" class="section level3">
<h3>
<span class="header-section-number">25.3.2</span> Google PWA compatibility<a class="anchor" aria-label="anchor" href="#google-pwa-compatibility"><i class="fas fa-link"></i></a>
</h3>
<p>As we use the google PWA compatibility script, we have to include at least one icon
like <code>&lt;link rel="icon" type="image/png" href="res/icon-128.png" sizes="128x128" /&gt;</code>.
However, we found some discrepancies between the developer tools recommendations and the
PWA compatibility script. We recommend to follow the developer tools prescriptions, that
is to include at least one icon of size 144x144. All other elements are generated by the script itself,
which is extremely convenient. Indeed, having to handle all possible screen sizes and different OS is particularly
tricky, repetitive and not interesting.</p>
<p>The HTML dependency is downloaded with <code><a href="https://rdrr.io/pkg/charpente/man/create_dependency.html">create_dependency("pwacompat", options = charpente_options(bundle = FALSE))</a></code>.
Don’t forget to update the <code>add_dependencies</code> list by including the two new dependencies:</p>
<div class="sourceCode" id="cb584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f7_page</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span>, <span class="va">navbar</span>, <span class="va">toolbar</span>, <span class="va">title</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">options</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">config_tag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    type <span class="op">=</span> <span class="st">"application/json"</span>,
    `data-for` <span class="op">=</span> <span class="st">"app"</span>,
    <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">options</span>,
      auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>,
      json_verbatim <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span>

  <span class="co"># create body_tag</span>
  <span class="va">body_tag</span> <span class="op">&lt;-</span> <span class="va">tags</span><span class="op">$</span><span class="fu">body</span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
      id <span class="op">=</span> <span class="st">"app"</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
        class <span class="op">=</span> <span class="st">"view view-main"</span>,
        <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
          class <span class="op">=</span> <span class="st">"page"</span>,
          <span class="va">navbar</span>,
          <span class="va">toolbar</span>,
          <span class="va">tags</span><span class="op">$</span><span class="fu">div</span><span class="op">(</span>
            class <span class="op">=</span> <span class="st">"page-content"</span>,
            <span class="va">...</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    <span class="va">config_tag</span>
  <span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span>
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>charset <span class="op">=</span> <span class="st">"utf-8"</span><span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"viewport"</span>,
        content <span class="op">=</span> <span class="st">"width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"apple-mobile-web-app-capable"</span>,
        content <span class="op">=</span> <span class="st">"yes"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">meta</span><span class="op">(</span>
        name <span class="op">=</span> <span class="st">"theme-color"</span>,
        content <span class="op">=</span> <span class="st">"#2196f3"</span>
      <span class="op">)</span>,
      <span class="va">tags</span><span class="op">$</span><span class="fu">title</span><span class="op">(</span><span class="va">title</span><span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rinterface.github.io/shinyMobile/reference/add_dependencies.html">add_dependencies</a></span><span class="op">(</span>
      <span class="va">body_tag</span>,
      deps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"framework7"</span>, <span class="st">"shinyMobile"</span>, <span class="st">"pwa"</span>, <span class="st">"pwacompat"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>If you do <code><a href="https://devtools.r-lib.org//reference/load_all.html">devtools::load_all()</a></code> and run the app again, you should see the new dependencies
in the <code>head</code> (Figure <a href="mobile-pwa.html#fig:mobile-pwa-deps">25.3</a>).</p>
<div class="figure">
<span id="fig:mobile-pwa-deps"></span>
<img src="images/mobile/mobile-pwa-deps.png" alt="New PWA dependencies in the head tag." width="100%"><p class="caption">
FIGURE 25.3: New PWA dependencies in the head tag.
</p>
</div>
<p>Yet, according to Figure <a href="mobile-pwa.html#fig:mobile-pwa-missing-sw">25.4</a>, we still miss the service worker,
as shown in the manifest diagnostic. This shows how powerful are the developer tools and
the end user is always guided step by step.</p>
<div class="figure">
<span id="fig:mobile-pwa-missing-sw"></span>
<img src="images/mobile/mobile-pwa-missing-sw.png" alt="Missing service worker registration." width="100%"><p class="caption">
FIGURE 25.4: Missing service worker registration.
</p>
</div>
</div>
<div id="service-worker-and-offline-page" class="section level3">
<h3>
<span class="header-section-number">25.3.3</span> Service worker and offline page<a class="anchor" aria-label="anchor" href="#service-worker-and-offline-page"><i class="fas fa-link"></i></a>
</h3>
<p>The second mandatory step to make our app installable is the service worker.
We borrowed the code from <a href="https://web.dev/offline-fallback-page/">web.dev</a>. <code>set_pwa</code> copies
this code in the <code>www</code> folder of the provided app:</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb585-1"><a href="mobile-pwa.html#cb585-1"></a><span class="co">/*</span></span>
<span id="cb585-2"><a href="mobile-pwa.html#cb585-2"></a><span class="co">Copyright 2015, 2019, 2020 Google LLC. All Rights Reserved.</span></span>
<span id="cb585-3"><a href="mobile-pwa.html#cb585-3"></a><span class="co"> Licensed under the Apache License, Version 2.0 (the "License");</span></span>
<span id="cb585-4"><a href="mobile-pwa.html#cb585-4"></a><span class="co"> you may not use this file except in compliance with the License.</span></span>
<span id="cb585-5"><a href="mobile-pwa.html#cb585-5"></a><span class="co"> You may obtain a copy of the License at</span></span>
<span id="cb585-6"><a href="mobile-pwa.html#cb585-6"></a><span class="co"> http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span id="cb585-7"><a href="mobile-pwa.html#cb585-7"></a><span class="co"> Unless required by applicable law or agreed to in writing, software</span></span>
<span id="cb585-8"><a href="mobile-pwa.html#cb585-8"></a><span class="co"> distributed under the License is distributed on an "AS IS" BASIS,</span></span>
<span id="cb585-9"><a href="mobile-pwa.html#cb585-9"></a><span class="co"> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span>
<span id="cb585-10"><a href="mobile-pwa.html#cb585-10"></a><span class="co"> See the License for the specific language governing permissions and</span></span>
<span id="cb585-11"><a href="mobile-pwa.html#cb585-11"></a><span class="co"> limitations under the License.</span></span>
<span id="cb585-12"><a href="mobile-pwa.html#cb585-12"></a><span class="co">*/</span></span>
<span id="cb585-13"><a href="mobile-pwa.html#cb585-13"></a></span>
<span id="cb585-14"><a href="mobile-pwa.html#cb585-14"></a><span class="co">// Incrementing OFFLINE_VERSION will kick off the install event and force</span></span>
<span id="cb585-15"><a href="mobile-pwa.html#cb585-15"></a><span class="co">// previously cached resources to be updated from the network.</span></span>
<span id="cb585-16"><a href="mobile-pwa.html#cb585-16"></a><span class="kw">const</span> OFFLINE_VERSION <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb585-17"><a href="mobile-pwa.html#cb585-17"></a><span class="kw">const</span> CACHE_NAME <span class="op">=</span> <span class="st">"offline"</span><span class="op">;</span></span>
<span id="cb585-18"><a href="mobile-pwa.html#cb585-18"></a><span class="co">// Customize this with a different URL if needed.</span></span>
<span id="cb585-19"><a href="mobile-pwa.html#cb585-19"></a><span class="kw">const</span> OFFLINE_URL <span class="op">=</span> <span class="st">"offline.html"</span><span class="op">;</span></span>
<span id="cb585-20"><a href="mobile-pwa.html#cb585-20"></a></span>
<span id="cb585-21"><a href="mobile-pwa.html#cb585-21"></a><span class="va">self</span>.<span class="at">addEventListener</span>(<span class="st">"install"</span><span class="op">,</span> (event) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb585-22"><a href="mobile-pwa.html#cb585-22"></a>  <span class="va">event</span>.<span class="at">waitUntil</span>(</span>
<span id="cb585-23"><a href="mobile-pwa.html#cb585-23"></a>    (<span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb585-24"><a href="mobile-pwa.html#cb585-24"></a>      <span class="kw">const</span> cache <span class="op">=</span> <span class="cf">await</span> <span class="va">caches</span>.<span class="at">open</span>(CACHE_NAME)<span class="op">;</span></span>
<span id="cb585-25"><a href="mobile-pwa.html#cb585-25"></a>      <span class="co">// Setting {cache: 'reload'} in the new request will ensure that the</span></span>
<span id="cb585-26"><a href="mobile-pwa.html#cb585-26"></a>      <span class="co">// response isn't fulfilled from the HTTP cache; i.e., it will be from</span></span>
<span id="cb585-27"><a href="mobile-pwa.html#cb585-27"></a>      <span class="co">// the network.</span></span>
<span id="cb585-28"><a href="mobile-pwa.html#cb585-28"></a>      <span class="cf">await</span> <span class="va">cache</span>.<span class="at">add</span>(<span class="kw">new</span> <span class="at">Request</span>(OFFLINE_URL<span class="op">,</span> <span class="op">{</span> <span class="dt">cache</span><span class="op">:</span> <span class="st">"reload"</span> <span class="op">}</span>))<span class="op">;</span></span>
<span id="cb585-29"><a href="mobile-pwa.html#cb585-29"></a>    <span class="op">}</span>)()</span>
<span id="cb585-30"><a href="mobile-pwa.html#cb585-30"></a>  )<span class="op">;</span></span>
<span id="cb585-31"><a href="mobile-pwa.html#cb585-31"></a>  <span class="co">// Force the waiting service worker to become the active service worker.</span></span>
<span id="cb585-32"><a href="mobile-pwa.html#cb585-32"></a>  <span class="va">self</span>.<span class="at">skipWaiting</span>()<span class="op">;</span></span>
<span id="cb585-33"><a href="mobile-pwa.html#cb585-33"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb585-34"><a href="mobile-pwa.html#cb585-34"></a></span>
<span id="cb585-35"><a href="mobile-pwa.html#cb585-35"></a><span class="va">self</span>.<span class="at">addEventListener</span>(<span class="st">"activate"</span><span class="op">,</span> (event) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb585-36"><a href="mobile-pwa.html#cb585-36"></a>  <span class="va">event</span>.<span class="at">waitUntil</span>(</span>
<span id="cb585-37"><a href="mobile-pwa.html#cb585-37"></a>    (<span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb585-38"><a href="mobile-pwa.html#cb585-38"></a>      <span class="co">// Enable navigation preload if it's supported.</span></span>
<span id="cb585-39"><a href="mobile-pwa.html#cb585-39"></a>      <span class="co">// See https://developers.google.com/web/updates/2017/02/navigation-preload</span></span>
<span id="cb585-40"><a href="mobile-pwa.html#cb585-40"></a>      <span class="cf">if</span> (<span class="st">"navigationPreload"</span> <span class="kw">in</span> <span class="va">self</span>.<span class="at">registration</span>) <span class="op">{</span></span>
<span id="cb585-41"><a href="mobile-pwa.html#cb585-41"></a>        <span class="cf">await</span> <span class="va">self</span>.<span class="va">registration</span>.<span class="va">navigationPreload</span>.<span class="at">enable</span>()<span class="op">;</span></span>
<span id="cb585-42"><a href="mobile-pwa.html#cb585-42"></a>      <span class="op">}</span></span>
<span id="cb585-43"><a href="mobile-pwa.html#cb585-43"></a>    <span class="op">}</span>)()</span>
<span id="cb585-44"><a href="mobile-pwa.html#cb585-44"></a>  )<span class="op">;</span></span>
<span id="cb585-45"><a href="mobile-pwa.html#cb585-45"></a></span>
<span id="cb585-46"><a href="mobile-pwa.html#cb585-46"></a>  <span class="co">// Tell the active service worker to take control of the page immediately.</span></span>
<span id="cb585-47"><a href="mobile-pwa.html#cb585-47"></a>  <span class="va">self</span>.<span class="va">clients</span>.<span class="at">claim</span>()<span class="op">;</span></span>
<span id="cb585-48"><a href="mobile-pwa.html#cb585-48"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb585-49"><a href="mobile-pwa.html#cb585-49"></a></span>
<span id="cb585-50"><a href="mobile-pwa.html#cb585-50"></a><span class="va">self</span>.<span class="at">addEventListener</span>(<span class="st">"fetch"</span><span class="op">,</span> (event) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb585-51"><a href="mobile-pwa.html#cb585-51"></a>  <span class="co">// We only want to call event.respondWith() if this is a navigation request</span></span>
<span id="cb585-52"><a href="mobile-pwa.html#cb585-52"></a>  <span class="co">// for an HTML page.</span></span>
<span id="cb585-53"><a href="mobile-pwa.html#cb585-53"></a>  <span class="cf">if</span> (<span class="va">event</span>.<span class="va">request</span>.<span class="at">mode</span> <span class="op">===</span> <span class="st">"navigate"</span>) <span class="op">{</span></span>
<span id="cb585-54"><a href="mobile-pwa.html#cb585-54"></a>    <span class="va">event</span>.<span class="at">respondWith</span>(</span>
<span id="cb585-55"><a href="mobile-pwa.html#cb585-55"></a>      (<span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb585-56"><a href="mobile-pwa.html#cb585-56"></a>        <span class="cf">try</span> <span class="op">{</span></span>
<span id="cb585-57"><a href="mobile-pwa.html#cb585-57"></a>          <span class="co">// First, try to use the navigation preload response if it's supported.</span></span>
<span id="cb585-58"><a href="mobile-pwa.html#cb585-58"></a>          <span class="kw">const</span> preloadResponse <span class="op">=</span> <span class="cf">await</span> <span class="va">event</span>.<span class="at">preloadResponse</span><span class="op">;</span></span>
<span id="cb585-59"><a href="mobile-pwa.html#cb585-59"></a>          <span class="cf">if</span> (preloadResponse) <span class="op">{</span></span>
<span id="cb585-60"><a href="mobile-pwa.html#cb585-60"></a>            <span class="cf">return</span> preloadResponse<span class="op">;</span></span>
<span id="cb585-61"><a href="mobile-pwa.html#cb585-61"></a>          <span class="op">}</span></span>
<span id="cb585-62"><a href="mobile-pwa.html#cb585-62"></a></span>
<span id="cb585-63"><a href="mobile-pwa.html#cb585-63"></a>          <span class="co">// Always try the network first.</span></span>
<span id="cb585-64"><a href="mobile-pwa.html#cb585-64"></a>          <span class="kw">const</span> networkResponse <span class="op">=</span> <span class="cf">await</span> <span class="at">fetch</span>(<span class="va">event</span>.<span class="at">request</span>)<span class="op">;</span></span>
<span id="cb585-65"><a href="mobile-pwa.html#cb585-65"></a>          <span class="cf">return</span> networkResponse<span class="op">;</span></span>
<span id="cb585-66"><a href="mobile-pwa.html#cb585-66"></a>        <span class="op">}</span> <span class="cf">catch</span> (error) <span class="op">{</span></span>
<span id="cb585-67"><a href="mobile-pwa.html#cb585-67"></a>          <span class="co">// catch is only triggered if an exception is thrown, which is likely</span></span>
<span id="cb585-68"><a href="mobile-pwa.html#cb585-68"></a>          <span class="co">// due to a network error.</span></span>
<span id="cb585-69"><a href="mobile-pwa.html#cb585-69"></a>          <span class="co">// If fetch() returns a valid HTTP response with a response code in</span></span>
<span id="cb585-70"><a href="mobile-pwa.html#cb585-70"></a>          <span class="co">// the 4xx or 5xx range, the catch() will NOT be called.</span></span>
<span id="cb585-71"><a href="mobile-pwa.html#cb585-71"></a>          <span class="va">console</span>.<span class="at">log</span>(<span class="st">"Fetch failed; returning offline page instead."</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb585-72"><a href="mobile-pwa.html#cb585-72"></a></span>
<span id="cb585-73"><a href="mobile-pwa.html#cb585-73"></a>          <span class="kw">const</span> cache <span class="op">=</span> <span class="cf">await</span> <span class="va">caches</span>.<span class="at">open</span>(CACHE_NAME)<span class="op">;</span></span>
<span id="cb585-74"><a href="mobile-pwa.html#cb585-74"></a>          <span class="kw">const</span> cachedResponse <span class="op">=</span> <span class="cf">await</span> <span class="va">cache</span>.<span class="at">match</span>(OFFLINE_URL)<span class="op">;</span></span>
<span id="cb585-75"><a href="mobile-pwa.html#cb585-75"></a>          <span class="cf">return</span> cachedResponse<span class="op">;</span></span>
<span id="cb585-76"><a href="mobile-pwa.html#cb585-76"></a>        <span class="op">}</span></span>
<span id="cb585-77"><a href="mobile-pwa.html#cb585-77"></a>      <span class="op">}</span>)()</span>
<span id="cb585-78"><a href="mobile-pwa.html#cb585-78"></a>    )<span class="op">;</span></span>
<span id="cb585-79"><a href="mobile-pwa.html#cb585-79"></a>  <span class="op">}</span></span>
<span id="cb585-80"><a href="mobile-pwa.html#cb585-80"></a></span>
<span id="cb585-81"><a href="mobile-pwa.html#cb585-81"></a>  <span class="co">// If our if() condition is false, then this fetch handler won't intercept the</span></span>
<span id="cb585-82"><a href="mobile-pwa.html#cb585-82"></a>  <span class="co">// request. If there are any other fetch handlers registered, they will get a</span></span>
<span id="cb585-83"><a href="mobile-pwa.html#cb585-83"></a>  <span class="co">// chance to call event.respondWith(). If no fetch handlers call</span></span>
<span id="cb585-84"><a href="mobile-pwa.html#cb585-84"></a>  <span class="co">// event.respondWith(), the request will be handled by the browser as if there</span></span>
<span id="cb585-85"><a href="mobile-pwa.html#cb585-85"></a>  <span class="co">// were no service worker involvement.</span></span>
<span id="cb585-86"><a href="mobile-pwa.html#cb585-86"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>This service worker redirects the end user to the offline cached page whenever
the app is offline, thereby offering a better user experience. It explicitly
targets an <code>offline.html</code> page. Therefore, we strongly advise to keep the same file names.</p>
<p>The next step is to mention and register the service worker. Framework7 has a dedicated module in the
app configuration. We modify <code>init.js</code> and run <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> to update the minified file:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb586-1"><a href="mobile-pwa.html#cb586-1"></a>serviceWorker<span class="op">:</span> <span class="op">{</span></span>
<span id="cb586-2"><a href="mobile-pwa.html#cb586-2"></a>  <span class="dt">path</span><span class="op">:</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span> <span class="op">+</span> <span class="st">'service-worker.js'</span><span class="op">,</span></span>
<span id="cb586-3"><a href="mobile-pwa.html#cb586-3"></a>  <span class="dt">scope</span><span class="op">:</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span></span>
<span id="cb586-4"><a href="mobile-pwa.html#cb586-4"></a><span class="op">}</span></span></code></pre></div>
<p>If the process is successful, you get the result shown in Figure <a href="mobile-pwa.html#fig:mobile-pwa-registered-sw">25.5</a>.</p>
<div class="figure">
<span id="fig:mobile-pwa-registered-sw"></span>
<img src="images/mobile/mobile-pwa-registered-sw.png" alt="Registered service worker." width="100%"><p class="caption">
FIGURE 25.5: Registered service worker.
</p>
</div>
<p>The new standard imposes to return a valid response when the app is offline. The offline page is
also copied from <a href="https://github.com/RinteRface/charpente">charpente</a>:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb587-1"><a href="mobile-pwa.html#cb587-1"></a><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></span>
<span id="cb587-2"><a href="mobile-pwa.html#cb587-2"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">"en"</span><span class="kw">&gt;</span></span>
<span id="cb587-3"><a href="mobile-pwa.html#cb587-3"></a>  <span class="kw">&lt;head&gt;</span></span>
<span id="cb587-4"><a href="mobile-pwa.html#cb587-4"></a>    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">"utf-8"</span> <span class="kw">/&gt;</span></span>
<span id="cb587-5"><a href="mobile-pwa.html#cb587-5"></a>    <span class="kw">&lt;meta</span><span class="ot"> http-equiv=</span><span class="st">"X-UA-Compatible"</span><span class="ot"> content=</span><span class="st">"IE=edge"</span> <span class="kw">/&gt;</span></span>
<span id="cb587-6"><a href="mobile-pwa.html#cb587-6"></a>    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">"viewport"</span><span class="ot"> content=</span><span class="st">"width=device-width, initial-scale=1"</span> <span class="kw">/&gt;</span></span>
<span id="cb587-7"><a href="mobile-pwa.html#cb587-7"></a></span>
<span id="cb587-8"><a href="mobile-pwa.html#cb587-8"></a>    <span class="kw">&lt;title&gt;</span>You are offline<span class="kw">&lt;/title&gt;</span></span>
<span id="cb587-9"><a href="mobile-pwa.html#cb587-9"></a></span>
<span id="cb587-10"><a href="mobile-pwa.html#cb587-10"></a>    <span class="co">&lt;!-- inline the webpage's stylesheet --&gt;</span></span>
<span id="cb587-11"><a href="mobile-pwa.html#cb587-11"></a>    <span class="kw">&lt;style&gt;</span></span>
<span id="cb587-12"><a href="mobile-pwa.html#cb587-12"></a>      body {</span>
<span id="cb587-13"><a href="mobile-pwa.html#cb587-13"></a>        <span class="kw">font-family</span>: helvetica<span class="op">,</span> arial<span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb587-14"><a href="mobile-pwa.html#cb587-14"></a>        <span class="kw">margin</span>: <span class="dv">2</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb587-15"><a href="mobile-pwa.html#cb587-15"></a>      }</span>
<span id="cb587-16"><a href="mobile-pwa.html#cb587-16"></a></span>
<span id="cb587-17"><a href="mobile-pwa.html#cb587-17"></a>      h1 {</span>
<span id="cb587-18"><a href="mobile-pwa.html#cb587-18"></a>        <span class="kw">font-style</span>: <span class="dv">italic</span><span class="op">;</span></span>
<span id="cb587-19"><a href="mobile-pwa.html#cb587-19"></a>        <span class="kw">color</span>: <span class="cn">#373fff</span><span class="op">;</span></span>
<span id="cb587-20"><a href="mobile-pwa.html#cb587-20"></a>      }</span>
<span id="cb587-21"><a href="mobile-pwa.html#cb587-21"></a></span>
<span id="cb587-22"><a href="mobile-pwa.html#cb587-22"></a>      p {</span>
<span id="cb587-23"><a href="mobile-pwa.html#cb587-23"></a>        <span class="kw">margin-block</span>: <span class="dv">1</span><span class="dt">rem</span><span class="op">;</span></span>
<span id="cb587-24"><a href="mobile-pwa.html#cb587-24"></a>      }</span>
<span id="cb587-25"><a href="mobile-pwa.html#cb587-25"></a></span>
<span id="cb587-26"><a href="mobile-pwa.html#cb587-26"></a>      button {</span>
<span id="cb587-27"><a href="mobile-pwa.html#cb587-27"></a>        <span class="kw">display</span>: <span class="dv">block</span><span class="op">;</span></span>
<span id="cb587-28"><a href="mobile-pwa.html#cb587-28"></a>      }</span>
<span id="cb587-29"><a href="mobile-pwa.html#cb587-29"></a>    <span class="kw">&lt;/style&gt;</span></span>
<span id="cb587-30"><a href="mobile-pwa.html#cb587-30"></a>  <span class="kw">&lt;/head&gt;</span></span>
<span id="cb587-31"><a href="mobile-pwa.html#cb587-31"></a>  <span class="kw">&lt;body&gt;</span></span>
<span id="cb587-32"><a href="mobile-pwa.html#cb587-32"></a>    <span class="kw">&lt;h1&gt;</span>You are offline<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb587-33"><a href="mobile-pwa.html#cb587-33"></a></span>
<span id="cb587-34"><a href="mobile-pwa.html#cb587-34"></a>    <span class="kw">&lt;p&gt;</span>Click the button below to try reloading.<span class="kw">&lt;/p&gt;</span></span>
<span id="cb587-35"><a href="mobile-pwa.html#cb587-35"></a>    <span class="kw">&lt;button</span><span class="ot"> type=</span><span class="st">"button"</span><span class="kw">&gt;</span>⤾ Reload<span class="kw">&lt;/button&gt;</span></span>
<span id="cb587-36"><a href="mobile-pwa.html#cb587-36"></a></span>
<span id="cb587-37"><a href="mobile-pwa.html#cb587-37"></a>    <span class="co">&lt;!-- inline the webpage's javascript file --&gt;</span></span>
<span id="cb587-38"><a href="mobile-pwa.html#cb587-38"></a>    <span class="kw">&lt;script&gt;</span></span>
<span id="cb587-39"><a href="mobile-pwa.html#cb587-39"></a>      <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">"button"</span>).<span class="at">addEventListener</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb587-40"><a href="mobile-pwa.html#cb587-40"></a>        <span class="va">window</span>.<span class="va">location</span>.<span class="at">reload</span>()<span class="op">;</span></span>
<span id="cb587-41"><a href="mobile-pwa.html#cb587-41"></a>      <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb587-42"><a href="mobile-pwa.html#cb587-42"></a>    <span class="kw">&lt;/script&gt;</span></span>
<span id="cb587-43"><a href="mobile-pwa.html#cb587-43"></a>  <span class="kw">&lt;/body&gt;</span></span>
<span id="cb587-44"><a href="mobile-pwa.html#cb587-44"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
<p>Now, let’s audit our app again: congrats! Our app is installable, reliable, although
further PWA optimization may be provided.</p>
<div class="figure">
<span id="fig:mobile-pwa-audit-final"></span>
<img src="images/mobile/mobile-pwa-audit-final.png" alt="Installable shinyMobile app." width="100%"><p class="caption">
FIGURE 25.6: Installable shinyMobile app.
</p>
</div>
</div>
<div id="disable-pwa-for-the-end-user" class="section level3">
<h3>
<span class="header-section-number">25.3.4</span> Disable PWA for the end user<a class="anchor" aria-label="anchor" href="#disable-pwa-for-the-end-user"><i class="fas fa-link"></i></a>
</h3>
<p>With the above approach, <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> will always look for a service worker to register.
Particularly, this raises an error in case no service worker is found on the server.
What if the user don’t want to always create a PWA, let’s say for less important applications?
We may add a parameter to the <code>f7Page</code>, for instance <code>allowPWA</code> that is either <code>TRUE</code> or <code>FALSE</code>,
store its value in the <code>body</code> <code>data-pwa</code> attribute and recover it on the JS side in <code>init.js</code>:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb588-1"><a href="mobile-pwa.html#cb588-1"></a><span class="co">// check if the app is intended to be a PWA</span></span>
<span id="cb588-2"><a href="mobile-pwa.html#cb588-2"></a><span class="kw">var</span> isPWA <span class="op">=</span> <span class="at">$</span>(<span class="st">'body'</span>).<span class="at">attr</span>(<span class="st">'data-pwa'</span>) <span class="op">===</span> <span class="st">"true"</span><span class="op">;</span></span>
<span id="cb588-3"><a href="mobile-pwa.html#cb588-3"></a></span>
<span id="cb588-4"><a href="mobile-pwa.html#cb588-4"></a><span class="cf">if</span> (isPWA) <span class="op">{</span></span>
<span id="cb588-5"><a href="mobile-pwa.html#cb588-5"></a>  <span class="va">config</span>.<span class="at">serviceWorker</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb588-6"><a href="mobile-pwa.html#cb588-6"></a>    <span class="dt">path</span><span class="op">:</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span> <span class="op">+</span> <span class="st">"service-worker.js"</span><span class="op">,</span></span>
<span id="cb588-7"><a href="mobile-pwa.html#cb588-7"></a>    <span class="dt">scope</span><span class="op">:</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span></span>
<span id="cb588-8"><a href="mobile-pwa.html#cb588-8"></a>  <span class="op">};</span></span>
<span id="cb588-9"><a href="mobile-pwa.html#cb588-9"></a><span class="op">}</span></span></code></pre></div>
<p>We then <strong>only</strong> create <code>config.serviceWorker</code> if the user specified <code>allowPWA = TRUE</code>.</p>
</div>
</div>
<div id="handle-the-installation" class="section level2">
<h2>
<span class="header-section-number">25.4</span> Handle the installation<a class="anchor" aria-label="anchor" href="#handle-the-installation"><i class="fas fa-link"></i></a>
</h2>
<p>It is a great opportunity to propose a <a href="https://developers.google.com/web/fundamentals/app-install-banners/native">custom</a>
installation experience.</p>
<p><strong>Note</strong>: To be able to install the app, make sure to replace <code>start_url</code> by the url
where the app is deployed like <code>https://dgranjon.shinyapps.io/installable-pwa-app/</code> for instance.
Missing that step would cause an issue during the service worker registration.
Once the installation criteria are met, the web browser raises the <code>beforeinstallprompt</code> event, except
on iOS platform, that is not yet compatible. To check it, we edit the <code>init.js</code> script and add:</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb589-1"><a href="mobile-pwa.html#cb589-1"></a><span class="kw">let</span> deferredPrompt<span class="op">;</span></span>
<span id="cb589-2"><a href="mobile-pwa.html#cb589-2"></a><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">'beforeinstallprompt'</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb589-3"><a href="mobile-pwa.html#cb589-3"></a>  <span class="co">// Prevent the mini-infobar from appearing on mobile</span></span>
<span id="cb589-4"><a href="mobile-pwa.html#cb589-4"></a>  <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></span>
<span id="cb589-5"><a href="mobile-pwa.html#cb589-5"></a>  <span class="co">// Stash the event so it can be triggered later.</span></span>
<span id="cb589-6"><a href="mobile-pwa.html#cb589-6"></a>  deferredPrompt <span class="op">=</span> e<span class="op">;</span></span>
<span id="cb589-7"><a href="mobile-pwa.html#cb589-7"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>This code adds an event listener to the window, prevents it from showing at start with <code>e.preventDefault</code> and
captures it in an external variable called <code>deferredPrompt</code>. After, we create our custom piece of UI that will
trigger the <code>prompt</code> install. We can benefit from the rich Framework7 interface and display
a <a href="https://framework7.io/docs/toast.html">toast</a> containing an install button. The instantiation
is fairly simple and follows the pattern <code>app.&lt;COMPONENT&gt;.create(parameters)</code>:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb590-1"><a href="mobile-pwa.html#cb590-1"></a><span class="co">// Create custom install UI</span></span>
<span id="cb590-2"><a href="mobile-pwa.html#cb590-2"></a><span class="kw">var</span> installToast <span class="op">=</span> <span class="va">app</span>.<span class="va">toast</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb590-3"><a href="mobile-pwa.html#cb590-3"></a>  <span class="dt">position</span><span class="op">:</span> <span class="st">'center'</span><span class="op">,</span></span>
<span id="cb590-4"><a href="mobile-pwa.html#cb590-4"></a>  <span class="dt">text</span><span class="op">:</span> <span class="st">'&lt;button id="install-button" class="toast-button button color-green"&gt;Install&lt;/button&gt;'</span><span class="op">,</span></span>
<span id="cb590-5"><a href="mobile-pwa.html#cb590-5"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>We give it an id so as to call it later. We edit the <code>beforeinstallprompt</code> event listener to show
the toast:</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb591-1"><a href="mobile-pwa.html#cb591-1"></a><span class="kw">let</span> deferredPrompt<span class="op">;</span></span>
<span id="cb591-2"><a href="mobile-pwa.html#cb591-2"></a><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">'beforeinstallprompt'</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb591-3"><a href="mobile-pwa.html#cb591-3"></a>  <span class="co">// Prevent the mini-infobar from appearing on mobile</span></span>
<span id="cb591-4"><a href="mobile-pwa.html#cb591-4"></a>  <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></span>
<span id="cb591-5"><a href="mobile-pwa.html#cb591-5"></a>  <span class="co">// Stash the event so it can be triggered later.</span></span>
<span id="cb591-6"><a href="mobile-pwa.html#cb591-6"></a>  deferredPrompt <span class="op">=</span> e<span class="op">;</span></span>
<span id="cb591-7"><a href="mobile-pwa.html#cb591-7"></a>  <span class="co">// Show install trigger</span></span>
<span id="cb591-8"><a href="mobile-pwa.html#cb591-8"></a>  <span class="va">installToast</span>.<span class="at">open</span>()<span class="op">;</span></span>
<span id="cb591-9"><a href="mobile-pwa.html#cb591-9"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p><strong>Note</strong>: with jQuery like <code>$(window).on('beforeinstallprompt', ...)</code>,
we would capture the event with <code>e.originalEvent</code>!</p>
<p>Then we register a second event listener, which fires on the toast button click.
We should wait a bit of time so that the toast exists with <code>app.utils.nextTick</code>,
which is, as a reminder, an internal equivalent to <code>setTimeout</code>. We first close the
toast, call the prompt method on the deferred event and log the result:</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb592-1"><a href="mobile-pwa.html#cb592-1"></a><span class="va">app</span>.<span class="va">utils</span>.<span class="at">nextTick</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb592-2"><a href="mobile-pwa.html#cb592-2"></a>  <span class="at">$</span>(<span class="st">'#install-button'</span>).<span class="at">on</span>(<span class="st">'click'</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb592-3"><a href="mobile-pwa.html#cb592-3"></a>    <span class="co">// close install toast</span></span>
<span id="cb592-4"><a href="mobile-pwa.html#cb592-4"></a>    <span class="va">installToast</span>.<span class="at">close</span>()<span class="op">;</span></span>
<span id="cb592-5"><a href="mobile-pwa.html#cb592-5"></a>    <span class="cf">if</span> (<span class="op">!</span>deferredPrompt) <span class="op">{</span></span>
<span id="cb592-6"><a href="mobile-pwa.html#cb592-6"></a>      <span class="co">// The deferred prompt isn't available.</span></span>
<span id="cb592-7"><a href="mobile-pwa.html#cb592-7"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb592-8"><a href="mobile-pwa.html#cb592-8"></a>    <span class="op">}</span></span>
<span id="cb592-9"><a href="mobile-pwa.html#cb592-9"></a>    <span class="co">// Show the install prompt.</span></span>
<span id="cb592-10"><a href="mobile-pwa.html#cb592-10"></a>    <span class="va">deferredPrompt</span>.<span class="at">prompt</span>()<span class="op">;</span></span>
<span id="cb592-11"><a href="mobile-pwa.html#cb592-11"></a>    <span class="co">// Log the result</span></span>
<span id="cb592-12"><a href="mobile-pwa.html#cb592-12"></a>    <span class="va">deferredPrompt</span>.<span class="va">userChoice</span>.<span class="at">then</span>((result) <span class="kw">=&gt;</span> <span class="op">{</span></span>
<span id="cb592-13"><a href="mobile-pwa.html#cb592-13"></a>      <span class="va">console</span>.<span class="at">log</span>(<span class="st">'👍'</span><span class="op">,</span> <span class="st">'userChoice'</span><span class="op">,</span> result)<span class="op">;</span></span>
<span id="cb592-14"><a href="mobile-pwa.html#cb592-14"></a>      <span class="co">// Reset the deferred prompt variable, since</span></span>
<span id="cb592-15"><a href="mobile-pwa.html#cb592-15"></a>      <span class="co">// prompt() can only be called once.</span></span>
<span id="cb592-16"><a href="mobile-pwa.html#cb592-16"></a>      deferredPrompt <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb592-17"><a href="mobile-pwa.html#cb592-17"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb592-18"><a href="mobile-pwa.html#cb592-18"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb592-19"><a href="mobile-pwa.html#cb592-19"></a><span class="op">},</span> <span class="dv">500</span>)<span class="op">;</span></span></code></pre></div>
<p>We run <code><a href="https://rdrr.io/pkg/charpente/man/build_js.html">build_js()</a></code> and deploy the app to shinyapps.io. Figure <a href="mobile-pwa.html#fig:mobile-pwa-installable">25.7</a>
illustrates the install prompt window that appears to install the app. Once installed, the <code>beforeinstallprompt</code>
event does not fire anymore and the app may be launched as a standalone app, for instance on macOSX (Figure <a href="mobile-pwa.html#fig:mobile-pwa-installed">25.8</a>)</p>
<div class="figure">
<span id="fig:mobile-pwa-installable"></span>
<img src="images/mobile/mobile-pwa-installable.png" alt="Install prompt window." width="100%"><p class="caption">
FIGURE 25.7: Install prompt window.
</p>
</div>
<div class="figure">
<span id="fig:mobile-pwa-installed"></span>
<img src="images/mobile/mobile-pwa-installed.png" alt="Installed PWA on macOSX." width="100%"><p class="caption">
FIGURE 25.8: Installed PWA on macOSX.
</p>
</div>
<p>On Figure <a href="mobile-pwa.html#fig:mobile-pwa-installed">25.8</a>, the blue window color corresponds to the <code>tags$meta(name = "theme-color", content = "#2196f3")</code>,
of the <code>f7_page</code> layout element. Whenever the connection is lost, the redirection occurs to
the <code>offline.html</code> page, as shown on Figure <a href="mobile-pwa.html#fig:mobile-pwa-offline">25.9</a>.</p>
<div class="figure">
<span id="fig:mobile-pwa-offline"></span>
<img src="images/mobile/mobile-pwa-offline.png" alt="Offline HTML template." width="100%"><p class="caption">
FIGURE 25.9: Offline HTML template.
</p>
</div>
<p>The <code>installable-pwa-test</code> <a href="https://github.com/DivadNojnarg/installable-pwa-test">repository</a>
contains the final code to reproduce the previous steps.</p>
</div>
<div id="workbox" class="section level2">
<h2>
<span class="header-section-number">25.5</span> Workbox<a class="anchor" aria-label="anchor" href="#workbox"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://developers.google.com/web/tools/workbox">Workbox</a> is a more robust alternative
to the approach described above. Interestingly, Framework7
uses Workbox as a service worker generator by default. It does:</p>
<ul>
<li>pre-caching of dependencies like CSS and JS but also images and Google fonts
to improve performances.</li>
<li>Improve offline experience.</li>
<li>…</li>
</ul>
</div>
<div id="other-resources" class="section level2">
<h2>
<span class="header-section-number">25.6</span> Other resources<a class="anchor" aria-label="anchor" href="#other-resources"><i class="fas fa-link"></i></a>
</h2>
<p>The process described above works perfectly for any Shiny template. Other packages like
<a href="https://github.com/pedrocoutinhosilva/shiny.pwa">{shiny.pwa}</a> create a PWA compatible structure
on the fly.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="mobile-shinyMobile.html"><span class="header-section-number">24</span> Reconstruct {shinyMobile}</a></div>
<div class="next"><a href="mobile-widgets.html"><span class="header-section-number">26</span> Design widgets</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#mobile-pwa"><span class="header-section-number">25</span> {shinyMobile} and PWA</a></li>
<li><a class="nav-link" href="#disclaimers"><span class="header-section-number">25.1</span> Disclaimers</a></li>
<li><a class="nav-link" href="#introduction-5"><span class="header-section-number">25.2</span> Introduction</a></li>
<li>
<a class="nav-link" href="#charpente-and-pwa-tools"><span class="header-section-number">25.3</span> {charpente} and PWA tools</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#create-the-manifest"><span class="header-section-number">25.3.1</span> Create the manifest</a></li>
<li><a class="nav-link" href="#google-pwa-compatibility"><span class="header-section-number">25.3.2</span> Google PWA compatibility</a></li>
<li><a class="nav-link" href="#service-worker-and-offline-page"><span class="header-section-number">25.3.3</span> Service worker and offline page</a></li>
<li><a class="nav-link" href="#disable-pwa-for-the-end-user"><span class="header-section-number">25.3.4</span> Disable PWA for the end user</a></li>
</ul>
</li>
<li><a class="nav-link" href="#handle-the-installation"><span class="header-section-number">25.4</span> Handle the installation</a></li>
<li><a class="nav-link" href="#workbox"><span class="header-section-number">25.5</span> Workbox</a></li>
<li><a class="nav-link" href="#other-resources"><span class="header-section-number">25.6</span> Other resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/mobile-pwa.Rmd">View source</a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/mobile-pwa.Rmd">Edit this page</a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It waslast built on 2021-01-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This website is produced by the <a class="text-light" href="https://bookdown.org">bookdown</a> bs4_book template.</p>
  </div>

</div></div>
</footer>
</body>
</html>
